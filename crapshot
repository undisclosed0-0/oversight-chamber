<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prestige Triumph ‚Äî Oversight Chambers (Hybrid, Restored)</title>

  <style>
    /* Prestige container */
    body {
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top center, #f5f7fa 0%, #e6ecf0 100%);
      color: #333;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: rgba(255,255,255,0.95);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(75,63,114,0.2);
      backdrop-filter: blur(6px);
    }
    .crest-header {
      width: 100px; height: 100px; margin: 0 auto 20px;
      background-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh7Xr0yArKKpo2gvFLpUcm9fMR5CgbrkBYTEChDOnIM59NhDxBVFHChMPQQzeVXKnIsS7FOxP4witstDDBjLciMAM1Tq0g_bM86dXGYMLHYms0KiFJniK_gJS0PjbxhgAE1DhdLHvwpD_Id-B2mtbW7SqgWDX72S05uifuP-Ag_XQQMqJGBBNvzV88OjYc/s1600/An%20abstract%20Masterad.png');
      background-size: cover; background-position: center; border-radius: 50%;
      box-shadow: 0 0 20px rgba(194,167,109,0.6);
    }
    h1, h2, h3 {
      color: #4b3f72;
      text-align: center;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.12);
      margin: 0 0 14px 0;
    }

    /* Verification plaque (outer prestige) */
    .verification-plaque {
      margin-top: 25px; padding: 20px;
      border: 2px solid #c2a76d; border-radius: 12px;
      background: linear-gradient(to bottom, #fdfcfb, #f3e8e2);
      box-shadow: 0 0 15px rgba(194,167,109,0.4);
      text-align: center;
      display: none;
    }
    .verification-plaque textarea {
      width: 100%; height: 120px; margin-top: 10px; padding: 8px;
      border-radius: 8px; border: 1px solid #c2a76d;
      font-family: 'Courier New', monospace; font-size: 0.95em; resize: none;
      background: #fffdf8;
    }
    .verification-plaque button {
      margin-top: 12px; padding: 10px 20px;
      background: linear-gradient(to right, #4b3f72, #6a5acd);
      color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em;
      box-shadow: 0 4px 12px rgba(75,63,114,0.3);
    }
    .verification-plaque button:hover {
      background: linear-gradient(to right, #6a5acd, #4b3f72);
    }

    /* Floating crest (desktop shortcut) */
    .floating-crest {
      position: fixed; width: 60px; height: 60px; bottom: 20px; right: -115px;
      background-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh7Xr0yArKKpo2gvFLpUcm9fMR5CgbrkBYTEChDOnIM59NhDxBVFHChMPQQzeVXKnIsS7FOxP4witstDDBjLciMAM1Tq0g_bM86dXGYMLHYms0KiFJniK_gJS0PjbxhgAE1DhdLHvwpD_Id-B2mtbW7SqgWDX72S05uifuP-Ag_XQQMqJGBBNvzV88OjYc/s1600/An%20abstract%20Masterad.png');
      background-size: cover; background-position: center; border-radius: 50%;
      box-shadow: 0 0 20px rgba(194,167,109,0.6); cursor: pointer; z-index: 101; opacity: 0.95;
    }
    @media (max-width: 860px) { .floating-crest { pointer-events: none; opacity: 0.7; } }

    /* Tap shimmer + zones */
    .tap-zone { position: fixed; width: 64px; height: 64px; top: 0; z-index: 999; }
    #tapTopLeft { left: 0; }
    #tapTopRight { right: 0; }
    .tap-shimmer {
      position: fixed; inset: 0; pointer-events: none; z-index: 998;
      background:
        radial-gradient(120px 120px at 32px 32px, rgba(255,215,0,0.25), transparent 70%),
        radial-gradient(120px 120px at calc(100% - 32px) 32px, rgba(106,90,205,0.22), transparent 70%);
      opacity: 0; transition: opacity 260ms ease;
    }
    .tap-shimmer.active { opacity: 1; }

    /* Ceremonial chambers (inner dark ritual styling) */
    :root {
      --gold:#ffd700; --violet:#6a0dad; --iron:#222;
      --panel-bg: radial-gradient(circle at center, #1a1a1a 0%, #0d0d0d 100%);
    }
    .panel-shell {
      background: var(--panel-bg); border: 3px solid #444; border-radius: 12px;
      box-shadow: inset 0 0 25px rgba(0,0,0,0.8), 0 0 20px rgba(255,215,0,0.18);
      padding: 20px; margin-top: 20px; color: var(--gold);
      font-family: 'Orbitron','Courier New', monospace;
    }
    .panel-shell h2, .panel-shell h3 {
      color: var(--gold); text-transform: uppercase;
      text-shadow: 0 0 8px rgba(255,215,0,0.6);
    }
    .panel-shell label { display: block; margin-top: 12px; font-weight: 700; }
    .panel-shell input, .panel-shell select {
      width: 100%; margin-top: 8px; padding: 10px; border-radius: 6px;
      border: 2px solid #333; background: #111; color: var(--gold); font-weight: bold;
      box-shadow: inset 0 0 6px rgba(0,0,0,0.7);
    }
    .panel-shell button {
      margin-top: 15px; padding: 10px 20px; border-radius: 8px; border: 2px solid var(--iron);
      background: linear-gradient(var(--gold), #b8860b); color: #111; font-weight: bold;
      text-transform: uppercase; cursor: pointer; box-shadow: 0 0 10px rgba(255,215,0,0.5);
      transition: transform 0.15s ease, box-shadow 0.3s ease;
    }
    .panel-shell button:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(255,215,0,0.8); }

    /* Ritual grid buttons */
    #panelButtons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 12px; }
    .panel-btn {
      padding: 16px; border-radius: 12px; border: 2px solid #333;
      background: radial-gradient(circle at 30% 30%, #1a1a1a, #0d0d0d);
      color: var(--gold); font-weight: 700;
      text-shadow: 0 0 6px rgba(255,215,0,0.6);
      box-shadow: inset 0 0 12px rgba(0,0,0,0.8), 0 0 10px rgba(255,215,0,0.25);
      transform: translateY(0);
      transition: transform 0.15s ease, box-shadow 0.3s ease;
      animation: runePulse 3s infinite;
    }
    .panel-btn:hover { transform: translateY(-3px); box-shadow: inset 0 0 12px rgba(0,0,0,0.8), 0 0 18px rgba(255,215,0,0.6); }
    @keyframes runePulse { 0%,100%{ filter:brightness(1); } 50%{ filter:brightness(1.12);} }

    /* Access keypad sigil */
    .panel-sigil {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
      font-size: 6em; color: rgba(255,215,0,0.08);
      text-shadow: 0 0 15px rgba(255,215,0,0.2); pointer-events: none; z-index: 0;
    }
    #superCodePanel .panel-content { position: relative; z-index: 1; }

    /* Cube (Labyrinth) */
    .cube-container {
      width: 340px; height: 340px; perspective: 1100px; margin: 0 auto; display: flex; align-items: center; justify-content: center;
    }
    .cube {
      width: 100%; height: 100%; position: relative; transform-style: preserve-3d;
      transform: translateZ(-120px) rotateX(-15deg) rotateY(20deg);
      transition: transform 0.15s ease-out;
    }
    .cube-face {
      position: absolute; width: 340px; height: 340px;
      background: radial-gradient(120px 120px at 50% 40%, rgba(25,25,25,0.95), rgba(12,12,12,0.95));
      border: 2px solid #555; box-shadow: inset 0 0 40px rgba(0,255,180,0.08);
      display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 14px; color: #fff;
      padding: 0; box-sizing: border-box; overflow: hidden;
    }
    .cube-face .rune { display: none; margin-top: 10px; font-size: 22px; color: #00f5b5; text-shadow: 0 0 8px rgba(0,245,181,0.65); }

    .front  { transform: rotateY(0deg)   translateZ(170px); }
    .back   { transform: rotateY(180deg) translateZ(170px); }
    .right  { transform: rotateY(90deg)  translateZ(170px); }
    .left   { transform: rotateY(-90deg) translateZ(170px); }
    .top    { transform: rotateX(90deg)  translateZ(170px); }
    .bottom { transform: rotateX(-90deg) translateZ(170px); }

    #unlockMessage { display: none; margin-top: 10px; font-size: 18px; color: #00f5b5; letter-spacing: 0.3px; text-align: center; }

    /* Lights Out */
    #lightsGrid { display: grid; grid-template-columns: repeat(3, 60px); gap: 6px; }
    #lightsGrid .light-cell {
      width: 60px; height: 60px; background: #000; border: 1px solid #333; border-radius: 8px; cursor: pointer;
      box-shadow: inset 0 0 6px rgba(0,0,0,0.7); transition: background 140ms ease, box-shadow 140ms ease;
      -webkit-appearance: none; appearance: none;
    }
    #lightsGrid .light-cell.on {
      background: #ffd700;
      box-shadow: 0 0 14px rgba(255,215,0,0.7), inset 0 0 6px rgba(0,0,0,0.4);
    }

    /* Labyrinth Path */
    #labyrinthGrid { display: grid; grid-template-columns: repeat(5,48px); gap: 6px; }
    #labyrinthGrid .cell {
      width: 48px; height: 48px; background: #161616; border: 1px solid #3a3a3a; border-radius: 6px; cursor: pointer;
      transition: background 140ms ease, box-shadow 140ms ease;
    }
    #labyrinthGrid .cell.on { background: #00b8f5; box-shadow: 0 0 14px rgba(0,184,245,0.55); }

    /* Memory */
    #memoryButtons { margin-top: 8px; display: flex; gap: 10px; }
    .mem { width: 64px; height: 64px; border-radius: 10px; font-size: 22px; background: #212121; border: 1px solid #4b4b4b;
      transition: filter 150ms ease, box-shadow 150ms ease; }
    .mem.flash { filter: brightness(1.6); box-shadow: 0 0 14px rgba(255,255,255,0.4); }

    /* Locker dial (replaces dial+word+math) */
    #lockerDial {
      width: 220px; height: 220px; position: relative; margin-top: 8px;
      display: grid; place-items: center;
    }
    #lockerDial .dial-face {
      width: 200px; height: 200px; border-radius: 50%;
      background: radial-gradient(120px 120px at 50% 50%, #0f0f12, #0a0a0d);
      border: 3px solid #666;
      box-shadow: inset 0 0 28px rgba(0,0,0,0.65), 0 0 20px rgba(255,215,0,0.08);
      position: relative;
    }
    #lockerDial .dial-pointer {
      position: absolute; width: 2px; height: 90px; background: #00f5b5; top: 10px; left: 50%;
      transform-origin: bottom center; transform: rotate(0deg);
      box-shadow: 0 0 10px rgba(0,245,181,0.6);
    }
    #lockerDial .dial-center {
      width: 20px; height: 20px; border-radius: 50%; background: #222; border: 2px solid #888; position: absolute; top: calc(50% - 10px); left: calc(50% - 10px);
      box-shadow: inset 0 0 6px rgba(0,0,0,0.7);
    }
    #lockerDial .dial-numbers {
      position: absolute; inset: 0; pointer-events: none; color: #bbb; font-size: 12px; font-weight: 700;
      text-shadow: 0 0 6px rgba(255,215,0,0.25);
    }
    #lockerHint {
      margin-top: 10px; font-size: 0.95em; color: #9fe8ff; text-align: center;
      font-family: "Share Tech Mono", monospace;
    }

    /* Final clearance mini-cube (visual) */
    .glowing-cube {
      width: 120px; height: 120px; margin: 16px auto;
      background: linear-gradient(145deg, #6a0dad, #ffd700);
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(106,13,173,0.8), 0 0 40px rgba(255,215,0,0.6);
      animation: cubeGlow 3s infinite alternate;
    }
    @keyframes cubeGlow {
      0%   { transform: rotateY(0deg) rotateX(0deg); box-shadow: 0 0 20px rgba(106,13,173,0.8); }
      50%  { transform: rotateY(180deg) rotateX(20deg); box-shadow: 0 0 40px rgba(255,215,0,0.8); }
      100% { transform: rotateY(360deg) rotateX(0deg); box-shadow: 0 0 20px rgba(106,13,173,0.8); }
    }

    /* Panel sizing and mobile */
    #puzzleBoxPanel {
      max-width: 480px; margin: 40px auto; padding: 20px; background: var(--panel-bg);
      border: 3px solid #444; border-radius: 12px;
      box-shadow: inset 0 0 25px rgba(0,0,0,0.8), 0 0 20px rgba(255,215,0,0.18);
      color: var(--gold); font-family: 'Orbitron','Courier New', monospace;
    }
    #imgVoidPuzzle {
      width: 100%; max-width: 340px; aspect-ratio: 1/1; margin: 0 auto; padding: 16px;
      background: radial-gradient(600px 400px at 50% 50%, rgba(0,0,0,0.85), #0d0d0d);
      border-radius: 16px;
      box-shadow: inset 0 0 80px rgba(0,0,0,0.95), 0 0 60px rgba(255,215,0,0.08);
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.6s ease, max-width 0.6s ease;
    }
    @media (max-width: 768px) {
      #imgVoidPuzzle.shrunk { max-width: 50%; transform: scale(0.9); margin: 0 auto; padding: 12px; }
    }
    @media (max-width: 480px) {
      body { padding: 10px; }
      .container { padding: 20px; }
      h1 { font-size: 1.4em; }
      .crest-header { width: 80px; height: 80px; }
      #imgVoidPuzzle { max-width: 240px; padding: 12px; }
      .cube-face { font-size: 12px; padding: 8px; }
    }

    /* Mystery Chamber */
    #mysteryBoxChamber {
      max-width: 720px; margin: 48px auto; padding: 32px;
      background: radial-gradient(1200px 600px at 50% -20%, rgba(255, 230, 120, 0.08), transparent 60%),
                  linear-gradient(180deg, #0b0b12 0%, #0e0e18 100%);
      border-radius: 16px;
      box-shadow: 0 0 24px rgba(255, 200, 80, 0.15), inset 0 0 18px rgba(255, 220, 120, 0.06),
                  0 12px 30px rgba(0, 0, 0, 0.6);
      color: #e9e3ff;
      font-family: "Segoe UI", system-ui, sans-serif;
      position: relative;
      overflow: hidden;
    }
    #mysteryBoxChamber .mystery-title {
      font-size: 1.6rem; text-align: center; letter-spacing: 0.06em; color: #f6e27a;
      text-shadow: 0 0 12px rgba(255, 200, 80, 0.35); margin-bottom: 20px;
    }

    /* Admin Chamber */
    #adminForm {
      max-width: 640px; margin: 40px auto; padding: 32px;
      background: linear-gradient(180deg, #2a2b2f 0%, #3a3b42 100%);
      border-radius: 16px; border: 1px solid rgba(212, 184, 106, 0.25);
      box-shadow: 0 0 20px rgba(212, 184, 106, 0.12), inset 0 0 14px rgba(60, 65, 75, 0.6),
                  0 10px 24px rgba(0, 0, 0, 0.55);
      color: #f2f0e9; font-family: "Segoe UI", system-ui, sans-serif; position: relative; overflow: hidden;
    }
    #adminForm h2 {
      font-size: 1.5rem; text-align: center; margin-bottom: 28px; color: #f2f0e9; letter-spacing: 0.05em;
      text-shadow: 0 0 8px rgba(212, 184, 106, 0.25); position: relative; padding-top: 70px;
    }
    #adminForm h2::before {
      content: ""; position: absolute; top: 0; left: 50%; width: 56px; height: 56px; transform: translateX(-50%);
      background: radial-gradient(circle at center, rgba(212,184,106,0.9) 0%, rgba(242,240,233,0.85) 42%, rgba(95,192,181,0.7) 100%);
      border-radius: 50%; box-shadow: 0 0 12px rgba(212, 184, 106, 0.5), 0 0 20px rgba(95, 192, 181, 0.35);
    }
    #adminForm h2::after {
      content: ""; position: absolute; top: 12px; left: 50%; width: 28px; height: 28px; transform: translateX(-50%) rotate(45deg);
      background: linear-gradient(135deg, rgba(242,240,233,0.95), rgba(212,184,106,0.85));
      box-shadow: 0 0 8px rgba(212, 184, 106, 0.4), inset 0 0 6px rgba(95, 192, 181, 0.25);
    }
    #adminForm label { display: block; margin: 14px 0 6px; font-weight: 600; color: #d4b86a; }
    #adminForm input, #adminForm select {
      width: 100%; padding: 12px 14px; background: #2f3036; color: #f2f0e9;
      border: 1px solid rgba(90, 106, 122, 0.45); border-radius: 10px;
      box-shadow: inset 0 0 8px rgba(50, 55, 65, 0.6), 0 1px 6px rgba(0, 0, 0, 0.35);
      transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.12s ease;
    }
    #adminForm input:focus, #adminForm select:focus {
      outline: none; border-color: #d4b86a;
      box-shadow: inset 0 0 10px rgba(212, 184, 106, 0.25), 0 0 10px rgba(212, 184, 106, 0.25);
      transform: translateY(-1px);
    }
    #adminForm #verifyTierBtn {
      margin-top: 22px; width: 100%; padding: 13px 16px; background: linear-gradient(90deg, #4a4b52, #5a6a7a);
      color: #f2f0e9; border: 1px solid rgba(212, 184, 106, 0.35); border-radius: 10px; font-weight: 700; letter-spacing: 0.05em;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5), inset 0 0 6px rgba(212, 184, 106, 0.12);
      cursor: pointer; transition: transform 0.12s ease, box-shadow 0.25s ease, filter 0.2s ease;
    }
    #adminForm #verifyTierBtn:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0, 0, 0, 0.6), 0 0 14px rgba(212, 184, 106, 0.25); filter: brightness(1.05); }
    #adminForm #verifyStatus { margin-top: 14px; font-size: 0.95rem; text-align: center; color: #b0b2bb; }

    /* Color ritual panel */
    #colorPanel {
      max-width: 880px; margin: 48px auto; padding: 28px; border-radius: 18px;
      background: linear-gradient(180deg, #2a2b2f 0%, #3a3b42 100%);
      box-shadow: 0 0 40px rgba(212,184,106,0.12), inset 0 0 24px rgba(30,30,35,0.85);
      border: 1px solid rgba(212,184,106,0.25); color: #f2f0e9;
    }
    #colorPanel .rune-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0; background: #1c1c1c; border: 8px solid #2a2a2a; }
    #colorPanel .rune-btn { display: grid; place-items: center; min-height: 100px; border: 6px solid #3a3a3a; background: #2a2b2f; font-family: "Cinzel", serif; font-weight: 700; cursor: pointer;
      box-shadow: inset 0 2px 6px rgba(255,255,255,0.05), inset 0 -4px 8px rgba(0,0,0,0.9), 0 0 12px rgba(0,0,0,0.6); transition: all 200ms ease; }
    #colorPanel .rune-btn .sigil { font-size: 1.6rem; color: rgba(212,184,106,0.9); text-shadow: 0 0 6px rgba(212,184,106,0.6), 0 0 14px rgba(242,240,233,0.35); }
    #colorPanel .rune-btn small { margin-top: 6px; font-size: 1rem; color: #aaa; text-shadow: 0 0 3px rgba(0,0,0,0.6); }
    #colorPanel .rune-btn.red.active    { background: radial-gradient(circle at 50% 30%, rgba(160,40,40,0.75), #2a2b2f 70%); }
    #colorPanel .rune-btn.blue.active   { background: radial-gradient(circle at 50% 30%, rgba(40,100,180,0.75), #2a2b2f 70%); }
    #colorPanel .rune-btn.green.active  { background: radial-gradient(circle at 50% 30%, rgba(60,150,90,0.75), #2a2b2f 70%); }
    #colorPanel .rune-btn.mustard.active{ background: radial-gradient(circle at 50% 30%, rgba(190,160,60,0.72), #2a2b2f 70%); }
    #colorPanel .rune-btn.violet.active { background: radial-gradient(circle at 50% 30%, rgba(130,80,180,0.75), #2a2b2f 70%); }
    #colorPanel .rune-btn.cyan.active   { background: radial-gradient(circle at 50% 30%, rgba(60,170,190,0.75), #2a2b2f 70%); }
    #colorPanel .rune-btn.deepred.active{ background: radial-gradient(circle at 50% 30%, rgba(160,50,50,0.75), #2a2b2f 70%); }
    #colorPanel .rune-btn.emerald.active{ background: radial-gradient(circle at 50% 30%, rgba(50,170,110,0.75), #2a2b2f 70%); }
    #colorPanel .rune-btn.deepviolet.active{ background: radial-gradient(circle at 50% 30%, rgba(110,60,160,0.75), #2a2b2f 70%); }
    #colorPanel .rune-btn.active .sigil, #colorPanel .rune-btn.active small {
      color: #f2f0e9; text-shadow: 0 0 6px rgba(255,220,120,0.6), 0 0 14px rgba(255,255,180,0.4);
    }
    #colorPanel .indicator-lines { display: flex; justify-content: center; gap: 12px; margin-top: 8px; }
    #colorPanel .indicator-lines span {
      width: 28px; height: 4px; border-radius: 2px; background: rgba(90, 60, 30, 0.4); box-shadow: inset 0 0 4px rgba(0,0,0,0.6); transition: all 200ms ease;
    }
    #colorPanel .indicator-lines span.active { background: rgba(255,140,60,0.9); box-shadow: 0 0 6px rgba(255,140,60,0.65), 0 0 12px rgba(255,200,120,0.45), 0 0 20px rgba(255,160,80,0.35); }
    #colorPanel .ritual-controls { display: flex; gap: 16px; justify-content: center; margin-top: 24px; }
    #sequenceReadout {
      font-family: "Share Tech Mono", monospace; font-size: 1.2rem; color: #9fe8ff; background: rgba(20, 30, 40, 0.85);
      border: 2px inset rgba(120,180,200,0.4); padding: 6px 12px; margin-top: 12px; text-align: center; letter-spacing: 0.1em;
      text-shadow: 0 0 6px rgba(0,255,255,0.4), 0 0 12px rgba(0,180,255,0.25); overflow: hidden; white-space: nowrap;
    }

    /* Mystery Box panel base */
    #mysteryBoxPanel {
      display: none; border: 3px solid var(--violet);
      box-shadow: inset 0 0 25px rgba(0,0,0,0.8), 0 0 20px rgba(138,43,226,0.6);
      color: #e0dfff; text-align: center; position: relative; overflow: hidden;
    }
    .mystery-title { margin-bottom: 12px; }
    .mystery-crest { font-size: 2em; margin-bottom: 16px; text-shadow: 0 0 12px rgba(255,215,0,0.8); }

    /* Aura dance after unlock */
    #imgVoidPuzzle.unlocked {
      box-shadow: inset 0 0 60px rgba(0,0,0,0.9), 0 0 40px rgba(255,215,0,0.6), 0 0 80px rgba(106,13,173,0.6), 0 0 120px rgba(0,245,181,0.4);
      animation: auraDance 6s infinite alternate;
    }
    @keyframes auraDance { 0% { transform: scale(1) rotate(0deg); } 50% { transform: scale(1.05) rotate(2deg); } 100% { transform: scale(1) rotate(-2deg); } }

    /* Cube fade-out */
    #labyrinthCube.fadeOut { animation: fadeOutCube 3s forwards; }
    @keyframes fadeOutCube { from { opacity: 1; transform: scale(1) rotateY(0deg); } to { opacity: 0; transform: scale(0.85) rotateY(15deg); } }

    /* Center ritual buttons */
    #mysteryBoxPanel button, #finalBranchPanel button, #puzzleBoxPanel button, #superCodePanel button {
      display: block; margin: 20px auto; text-align: center;
    }
    #superCodePanel input[type="text"], #superCodePanel input[type="password"] {
      width: 60%; max-width: 280px; margin: 10px auto; display: block;
    }

    /* Tap shimmer feedback on rune grid */
    .rune-btn { position: relative; transition: box-shadow 0.2s ease, background-color 0.2s ease, outline-color 0.2s ease; }
    .rune-btn.glow { box-shadow: 0 0 18px rgba(255,215,0,0.9); }
    .rune-btn.after-correct { outline: 2px solid rgba(106,255,106,0.5); box-shadow: 0 0 12px rgba(106,255,106,0.6); z-index: 1; }
    .rune-btn.after-wrong { outline: 2px solid rgba(255,74,74,0.5); box-shadow: 0 0 12px rgba(255,74,74,0.6); z-index: 1; }

    /* Mobile PuzzleBox notification */
    #puzzleNotice {
      display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      max-width: 90%; background: rgba(0,0,0,0.85); color: #ffd700;
      font-family: 'Orbitron','Courier New', monospace; font-size: 0.95em; padding: 12px 18px; border-radius: 10px;
      box-shadow: 0 0 12px rgba(255,215,0,0.6); z-index: 9999; text-align: center;
    }
    #puzzleNotice.show { display: block; animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateX(-50%) translateY(20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }

    /* Hidden sigil pulse */
    #hiddenSigil {
      display: none; position: absolute; bottom: -40px; left: 50%; transform: translateX(-50%);
      font-size: 22px; color: #ffd700; text-shadow: 0 0 12px rgba(255,215,0,0.8); animation: pulseSigil 2s infinite;
    }
    @keyframes pulseSigil { 0% { opacity: 0.4; transform: translateX(-50%) scale(0.9); } 50% { opacity: 1; transform: translateX(-50%) scale(1.1); } 100% { opacity: 0.4; transform: translateX(-50%) scale(0.9); } }
    #hiddenSigil.fadeOut { animation: fadeOutSigil 2s forwards; }
    @keyframes fadeOutSigil { from { opacity: 1; transform: translateX(-50%) scale(1); } to { opacity: 0; transform: translateX(-50%) scale(0.8); } }
  </style>
</head>
<body>
  <div class="container">
    <div class="crest-header"></div>
    <h1>Prestige Triumph: Oversight Entry</h1>

    <!-- Public form -->
    <form id="love-form" method="POST" class="prestige-form"
      action="https://www.blogger.com/contact-form.do"
      target="hidden_iframe"
      onsubmit="return submitCeremonialForm();"
      style="max-width:600px;margin:40px auto;padding:32px;background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.12);">
      <label for="role">Select Tier</label>
      <select id="role" name="role" required>
        <option value="">Select your role</option>
        <option value="Initiate">Initiate</option>
        <option value="Steward">Steward</option>
        <option value="Neighbor">Neighbor</option>
        <option value="Contributor">Contributor</option>
        <option value="Observer">Observer</option>
        <option value="Supporter">Supporter</option>
        <option value="Archivist">Archivist</option>
      </select>

      <div style="text-align:center; margin:12px 0 18px 0;">
        <button type="button" id="genNameBtn"
                onclick="generateNameFromTier()"
                style="width:70%; max-width:320px; background:#c2a76d; color:#fff;
                       border:none; padding:10px 18px; border-radius:6px;
                       font-size:1em; box-shadow:0 2px 6px rgba(0,0,0,0.2);
                       cursor:pointer;">
          ‚ú® Generate Prestige Name
        </button>
      </div>

      <input type="text" id="name" name="name" placeholder="e.g., Solenne of the Third Tier" required style="width:100%;padding:12px 14px;border:1px solid #b8aee0;border-radius:6px;background:#fafafa;color:#4b3f72;">
      <label for="phone">Contact Number</label>
      <input type="tel" id="phone" name="phone" placeholder="e.g., +1 616-555-1234" required style="width:100%;padding:12px 14px;border:1px solid #b8aee0;border-radius:6px;background:#fafafa;color:#4b3f72;">

      <textarea id="message" name="message" style="display:none;"></textarea>
      <input type="email" name="email" id="bloggerEmail" style="display:none;">
      <button type="submit" style="margin-top:24px;width:100%;padding:14px;background:linear-gradient(to right,#4b3f72,#6a5acd);color:white;border:none;border-radius:8px;font-size:1.1em;cursor:pointer;">Create Account</button>
    </form>

    <!-- Admin chamber -->
    <form id="adminForm" onsubmit="return false;" style="display:none;">
      <h2>Admin Access</h2>
      <label for="adminTier">Tier</label>
      <select id="adminTier" name="adminTier" required>
        <option value="Admin">Admin</option>
        <option value="MasterAdmin">Master Admin</option>
      </select>
      <label for="adminCode">Clearance Code</label>
      <input id="adminCode" name="adminCode" required type="password" />
      <button type="button" id="verifyTierBtn">Verify</button>
      <p id="verifyStatus"></p>
    </form>

    <!-- Ritual Sequence Panel -->
    <div id="colorPanel" class="panel-shell" style="display:none;">
      <div class="ritual-header" style="display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:16px;">
        <div class="runic">·ö†·õá·öª·õú·ö±</div>
        <div class="sigil" aria-hidden="true" style="position:relative;width:72px;height:72px;display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 0 14px rgba(212,184,106,0.45));">
          <span class="sigil-ring" style="position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle, rgba(212,184,106,0.8), rgba(95,192,181,0.7));"></span>
          <span class="sigil-core" style="position:absolute;inset:18px;border-radius:50%;background:radial-gradient(circle, rgba(40,40,45,0.8), rgba(90,106,122,0.6));"></span>
          <span class="sigil-square" style="position:absolute;width:36px;height:36px;transform:rotate(45deg);background:linear-gradient(135deg, rgba(242,240,233,0.95), rgba(212,184,106,0.85));"></span>
        </div>
      </div>

      <p class="designation">Designation: <strong id="nameInRitual"></strong></p>

      <div class="indicator-lines" id="indicatorLines">
        <span></span><span></span><span></span><span></span>
      </div>

      <div id="sequenceReadout" class="sequence">‚Äî ‚Äî ‚Äî</div>
      <div class="rune-grid" id="panelButtons"></div>

      <div class="ritual-controls">
        <button id="verifySequence" class="verify-btn">VERIFY</button>
        <button id="clearSequence" class="clear-btn">CLEAR</button>
      </div>
    </div>

    <!-- Access keypad -->
    <div id="superCodePanel" class="panel-shell" style="display:none; position:relative;">
      <h3>Access Panel</h3>
      <div class="panel-sigil">‚ôõ</div>
      <div class="panel-content">
        <p>Rune keypad unlocked. Enter access code to proceed.</p>
        <input id="accessCodeInput" type="text" placeholder="Enter code (X-719-BOX)">
        <button id="accessCodeBtn">Verify Code</button>
        <p id="accessCodeStatus"></p>
      </div>
    </div>

    <!-- Mystery Box chamber -->
    <div id="mysteryBoxChamber" class="panel-shell" style="display:none;">
      <h2 class="mystery-title">Mystery Box Chamber</h2>
      <div class="mystery-crest">‚ôõ ‚öö ‚üÅ</div>
      <p>The chamber hums with hidden power. Attempt the Puzzle Box?</p>
      <button id="attemptPuzzleBtn">Attempt Puzzle Box</button>
    </div>

    <!-- Puzzle Box ‚Äî Labyrinth Cube -->
    <div id="puzzleBoxPanel" class="panel-shell" style="display:none;">
      <h2 class="mystery-title">Puzzle Box ‚Äî Labyrinth Cube</h2>
      <p>Designation: <strong id="nameInPuzzle"></strong></p>
      <div id="hiddenSigil">‚úß Triumphal Sigil ‚úß</div>

      <div id="imgVoidPuzzle">
        <div class="cube-container">
          <div class="cube" id="labyrinthCube">
            <!-- Face 1: Lights Out -->
            <div class="cube-face front">
              <p>Toggle the pattern</p>
              <div id="lightsGrid">
                <button class="light-cell"></button><button class="light-cell"></button><button class="light-cell"></button>
                <button class="light-cell"></button><button class="light-cell"></button><button class="light-cell"></button>
                <button class="light-cell"></button><button class="light-cell"></button><button class="light-cell"></button>
              </div>
              <div id="runeL" class="rune">Œõ</div>
            </div>

            <!-- Face 2: Locker Dial (replaces dial + word + math) -->
            <div class="cube-face back">
              <p>Locker combination: follow the directions</p>
              <div id="lockerDial">
                <div class="dial-face">
                  <div class="dial-pointer"></div>
                  <div class="dial-center"></div>
                  <div class="dial-numbers"></div>
                </div>
              </div>
              <div id="lockerHint">Turn CW ‚Äî Stage 1</div>
              <!-- Mark all three when combo completes -->
              <div id="runeD" class="rune">‚ú¶</div>
              <div id="runeW" class="rune">Œ®</div>
              <div id="runeN" class="rune">Œ¶</div>
            </div>

            <!-- Face 3: Labyrinth Path -->
            <div class="cube-face left">
              <p>Trace the hidden path</p>
              <div id="labyrinthGrid">
                <!-- 5x5 grid -->
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
              </div>
              <div id="runeM" class="rune">Œ©</div>
            </div>

            <!-- Face 4: Memory -->
            <div class="cube-face top">
              <p>Repeat the sequence</p>
              <button id="startMemory">Start</button>
              <div id="memoryButtons">
                <button class="mem" data-val="0">‚ñ≤</button>
                <button class="mem" data-val="1">‚óÜ</button>
                <button class="mem" data-val="2">‚öô</button>
              </div>
              <div id="runeS" class="rune">Œ£</div>
            </div>

            <!-- Faces 5-6: Status-only to preserve symmetry -->
            <div class="cube-face right">
              <p>Status: Combination stages progress</p>
            </div>
            <div class="cube-face bottom">
              <p>Status: All runes must glow</p>
            </div>
          </div>
        </div>
      </div>

      <p id="unlockMessage" style="display:none;">‚ú® The Labyrinth Cube Unlocks! ‚ú®</p>
    </div>

    <!-- Final Branch -->
    <div id="finalBranchPanel" class="panel-shell" style="display:none;">
      <h2>Final Branch</h2>
      <p>Your final password is: <strong id="revealedPassword">QUBE-ACCESS-777</strong></p>
      <button id="toFinalClearanceBtn">Proceed to Final Clearance Qube</button>
    </div>

    <!-- Final Clearance Chamber -->
    <div id="finalClearancePanel" class="panel-shell" style="display:none;">
      <h2 class="mystery-title">Puzzle Box Mechanism</h2>
      <div class="glowing-cube"></div>
      <p>Enter the final clearance code to unlock the Superform.</p>
      <input id="finalClearanceCode" type="password" placeholder="Re-enter final code" />
      <button id="finalClearanceBtn">Unlock</button>
      <p id="finalClearanceStatus"></p>
    </div>

    <!-- Superform chamber -->
    <div id="mysteryBoxPanel" class="panel-shell" style="display:none; border-color: var(--violet); box-shadow: inset 0 0 25px rgba(0,0,0,0.8), 0 0 20px rgba(138,43,226,0.6);">
      <h2 class="mystery-title">Super Level Access</h2>
      <div class="mystery-crest">‚ôõ ‚öö ‚üÅ</div>
      <div class="cube-aura" aria-hidden="true"></div>
      <form id="superLevelForm" onsubmit="return submitSuperForm();">
        <div class="panel-sigil"></div>
        <div class="frost-overlay"></div>
        <label for="superName">Account Holder</label>
        <input id="superName" name="superName" required type="text" />
        <label for="superTier">Tier</label>
        <select id="superTier" name="superTier" required>
          <option value="Sovereign">Sovereign</option>
          <option value="Luminary">Luminary</option>
          <option value="Legacy">Legacy Tier</option>
        </select>
        <label for="superCode">Clearance Code</label>
        <input id="superCode" name="superCode" required type="password" />
        <button type="submit">Submit Super-Level Form</button>
        <p id="superFormStatus"></p>
      </form>
    </div>

    <!-- Verification plaque -->
    <div class="verification-plaque" id="verificationPlaque">
      <p>Copy this verification text and paste it into the official Prestige Verification Form:</p>
      <textarea id="verificationText" readonly></textarea>
      <button type="button" onclick="copyVerification()">üìã Copy Verification Text</button>
    </div>
  </div>

  <!-- Crest shortcut -->
  <div class="floating-crest" onclick="unlockSuperForm()" title="Unlock Super Form"></div>

  <!-- Blogger iframe target -->
  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <!-- Tap shimmer + zones -->
  <div class="tap-shimmer" id="tapShimmer"></div>
  <div id="tapTopLeft" class="tap-zone" aria-hidden="true"></div>
  <div id="tapTopRight" class="tap-zone" aria-hidden="true"></div>

  <div id="puzzleNotice">üì± For true Puzzle Box engagement, reduce your screen size to 50% on mobile.</div>

  <script>
    /* Helpers: panel show/hide */
    function showPanel(id){ const el = document.getElementById(id); if (el) el.style.display = 'block'; }
    function hidePanel(id){ const el = document.getElementById(id); if (el) el.style.display = 'none'; }

    /* Copy verification */
    function copyVerification() {
      const textArea = document.getElementById("verificationText");
      textArea.select();
      textArea.setSelectionRange(0, 99999);
      document.execCommand("copy");
      alert("Verification text copied. Please paste it into the Google Form field.");
    }

    /* Name generator */
    function generateTieredName(tier) {
      const pools = {
        Initiate: { names:["Lena","Jamal","Sofia","Kai","Maya"], suffixes:["of the Welcome Ledger","of the First Entry","of the Community Fold"] },
        Steward:  { names:["Elias","Priya","Malcolm","Zara","Omar"], suffixes:["of the Civic Watch","of the Shared Archive","of the Stewardship Line"] },
        Neighbor: { names:["Ava","Noah","Grace","Leo","Isla"], suffixes:["of the Local Registry","of the Neighborhood Tier","of the Common Fold"] },
        Contributor:{ names:["Milan","Tessa","Jude","Nina","Arlo"], suffixes:["of the Support Ledger","of the Contributor Line","of the Community Archive"] },
        Observer: { names:["Theo","Luna","Miles","Ivy","Rowan"], suffixes:["of the Quiet Watch","of the Passive Tier","of the Ledger Periphery"] },
        Supporter:{ names:["Elena","Caleb","Raya","Finn","Naomi"], suffixes:["of the Advocacy Fold","of the Support Tier","of the Donor Registry"] },
        Archivist:{ names:["Solenne","Idris","Helena","Lucan","Amara"], suffixes:["of the Memory Vault","of the Archivist Line","of the Tiered Archive"] }
      };
      const pool = pools[tier] || pools.Initiate;
      const name = pool.names[Math.floor(Math.random()*pool.names.length)];
      const suffix = pool.suffixes[Math.floor(Math.random()*pool.suffixes.length)];
      return `${name} ${suffix}`;
    }
    function generateNameFromTier() {
      const tier = document.getElementById('role').value;
      if (!tier) { alert('Please select a tier first.'); return; }
      document.getElementById('name').value = generateTieredName(tier);
    }

    /* Blogger-friendly helpers */
    function generateCardID() { return 'CARD-' + Math.random().toString(36).substr(2, 8).toUpperCase(); }
    function generateAccessCode() { return 'ACCESS-' + Math.floor(100000 + Math.random() * 900000); }

    /* Public form submit */
    function submitCeremonialForm() {
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const role = document.getElementById('role').value;
      const card = generateCardID();
      const accessCode = generateAccessCode();

      const registry = JSON.parse(localStorage.getItem('userRegistry')) || {};
      registry[name] = { role, phone, card, accessCode, created: Date.now(), activated: false };
      localStorage.setItem('userRegistry', JSON.stringify(registry));

      const message = `
ü™î Prestige Triumph Verification
üë§ Name: ${name}
üìû Phone: ${phone}
üéñ Tier: ${role}
üÜî Account ID: ${card}
üîë Access Code: ${accessCode}
      `.trim();

      document.getElementById('message').value = message;
      document.getElementById('bloggerEmail').value = "prestige@triumph.org";
      document.getElementById('verificationText').value = message;
      document.getElementById('verificationPlaque').style.display = "block";

      alert("Your account request has been received.\n\nRedirecting you to the official Prestige Verification Chamber");
      setTimeout(() => {
        window.location.href = `https://mrhim00.blogspot.com/2025/10/issued.html?card=${encodeURIComponent(card)}`;
      }, 10000);

      return false;
    }

    /* Crest unlock shortcut */
    function unlockSuperForm() {
      showPanel('mysteryBoxPanel');
      const name = document.getElementById('name').value.trim();
      if (name) document.getElementById('superName').value = name;
      alert("Super-level access form unlocked.");
    }

    /* Tap shimmer */
    let shimmerTimer;
    function shimmerPulse(){
      const s = document.getElementById('tapShimmer');
      s.classList.add('active');
      clearTimeout(shimmerTimer);
      shimmerTimer = setTimeout(() => s.classList.remove('active'), 260);
    }

    /* Tap unlock (admin): top-left then top-right */
    let adminTapSequence = [];
    let adminTapResetTimer;
    function resetAdminTap(){ adminTapSequence=[]; clearTimeout(adminTapResetTimer); }
    function checkAdminMobileUnlock(){
      const correct = ['tapTopLeft','tapTopRight'];
      if (adminTapSequence.join(',') === correct.join(',')) {
        showPanel('adminForm'); shimmerPulse(); resetAdminTap();
      } else {
        adminTapResetTimer = setTimeout(resetAdminTap, 8000);
      }
    }
    document.getElementById('tapTopLeft').addEventListener('click', ()=>{ adminTapSequence.push('tapTopLeft'); shimmerPulse(); checkAdminMobileUnlock(); });
    document.getElementById('tapTopRight').addEventListener('click', ()=>{ adminTapSequence.push('tapTopRight'); shimmerPulse(); checkAdminMobileUnlock(); });

    /* Codes */
    const TIER_CODES = { Admin: "A-231-GATE", MasterAdmin: "M-Q8/-CROWN" };
    const HIDDEN_CODE = "X-719-BOX";

    let ceremonyName = "";
    let superSequence = [];

    /* Random helpers */
    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    /* Verify ‚Üí ritual panel */
    document.getElementById('verifyTierBtn').addEventListener('click', ()=>{
      const status = document.getElementById('verifyStatus');
      const tierSel = document.getElementById('adminTier').value;
      const code = (document.getElementById('adminCode').value || '').trim();
      if (!code) { status.textContent = "Enter clearance code."; return; }

      // reset downstream panels
      ['colorPanel','superCodePanel','puzzleBoxPanel','finalClearancePanel','mysteryBoxPanel','mysteryBoxChamber','finalBranchPanel'].forEach(hidePanel);

      const ok = (tierSel === 'Admin' && code === TIER_CODES.Admin) ||
                 (tierSel === 'MasterAdmin' && code === TIER_CODES.MasterAdmin) ||
                 (code === HIDDEN_CODE);

      if (ok) {
        const role = document.getElementById('role').value || 'Initiate';
        ceremonyName = generateTieredName(role);
        status.textContent = "‚úÖ Verified. Proceed to the ritual.";
        const nameEl = document.getElementById('nameInRitual'); if (nameEl) nameEl.textContent = ceremonyName;
        superSequence = [];
        showPanel('colorPanel');
        buildRitualGrid();
      } else {
        status.textContent = "‚ùå Invalid clearance for selected tier.";
      }
    });

    /* Ritual grid (color sequence) */
    let requiredSequence = [];

    function buildRitualGrid(){
      const panel = document.getElementById('panelButtons');
      panel.innerHTML = "";

      const colors  = ["red","blue","green","mustard","violet","cyan","deepred","emerald","deepviolet"];
      const glyphs  = ["‚üü","œû","‚üÅ","‚ßñ","·ö†","Œ∂","‚Ç£","‚üä","‚öö","‚ôõ","‚ß´"];
      const numbers = ["231","85/","V2Œ∂","‚Ç£2","77X","9√ò","31Œî","8.98","27$","719"];

      requiredSequence = shuffleArray(colors).slice(0,4);

      colors.forEach(c=>{
        const btn = document.createElement('button');
        btn.type = "button";
        btn.className = "rune-btn " + c;
        const sigil = glyphs[Math.floor(Math.random()*glyphs.length)];
        const num   = numbers[Math.floor(Math.random()*numbers.length)];
        btn.innerHTML = `<span class="sigil">${sigil}</span><small>${num}</small>`;
        btn.addEventListener('click', ()=>handleRitualTap(c, btn));
        panel.appendChild(btn);
      });

      superSequence = [];
      renderSequence();
      updateIndicators();
    }

    let tapLog = [];
    function handleRitualTap(color, btn){
      superSequence.push(color);
      tapLog.push({ color, btn });
      renderSequence();
      btn.classList.toggle('active');
      updateIndicators();
      btn.classList.add('glow');
      setTimeout(() => btn.classList.remove('glow'), 1200);
    }

    function renderSequence(){
      const sequenceReadout = document.getElementById('sequenceReadout');
      const text = superSequence.length ? superSequence.join('~') : '----';
      sequenceReadout.textContent = '';
      let i = 0;
      const interval = setInterval(() => {
        sequenceReadout.textContent += text[i] || '';
        i++;
        if (i >= text.length) clearInterval(interval);
      }, 40);
    }

    function updateIndicators() {
      const indicators = document.querySelectorAll('#indicatorLines span');
      indicators.forEach((bar, i) => {
        if (i < superSequence.length) bar.classList.add('active');
        else bar.classList.remove('active');
      });
    }

    function arraysMatch(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }

    document.getElementById('verifySequence').addEventListener('click', () => {
      const attemptColors = superSequence.slice(0,4);
      const attemptTaps   = tapLog.slice(0,4);
      const correct = arraysMatch(attemptColors, requiredSequence);

      const sequenceReadout = document.getElementById('sequenceReadout');
      if (correct) {
        sequenceReadout.textContent = "ACCESS GRANTED >> ACCESS PANEL";
        sequenceReadout.style.color = "#6aff6a";
        hidePanel('colorPanel');
        showPanel('superCodePanel');
        const nameInPuzzle = document.getElementById('nameInPuzzle');
        const nameInRitual = document.getElementById('nameInRitual');
        if (nameInPuzzle && nameInRitual) nameInPuzzle.textContent = nameInRitual.textContent;
      } else {
        sequenceReadout.textContent = "ACCESS DENIED";
        sequenceReadout.style.color = "#ff4a4a";
      }

      attemptTaps.forEach(({ color, btn }, i) => {
        btn.classList.remove('after-correct','after-wrong');
        if (color === requiredSequence[i]) {
          btn.classList.add('after-correct');
          setTimeout(() => btn.classList.remove('after-correct'), 4000);
        } else {
          btn.classList.add('after-wrong');
          setTimeout(() => btn.classList.remove('after-wrong'), 1200);
        }
      });

      superSequence = [];
      tapLog = [];
      updateIndicators();
    });

    document.getElementById('clearSequence').addEventListener('click', () => {
      superSequence = [];
      tapLog = [];
      renderSequence();
      document.querySelectorAll('.rune-btn').forEach(btn => {
        btn.classList.remove('active','after-correct','after-wrong','glow');
      });
      updateIndicators();
    });

    /* Access Panel ‚Üí Mystery Box Chamber */
    document.getElementById('accessCodeBtn').addEventListener('click', () => {
      const v = document.getElementById('accessCodeInput').value.trim().toUpperCase();
      const s = document.getElementById('accessCodeStatus');
      if (v === 'X-719-BOX') {
        s.textContent = '‚úÖ Code accepted. Proceeding to Mystery Box...';
        setTimeout(() => {
          hidePanel('superCodePanel');
          showPanel('mysteryBoxChamber');
        }, 600);
      } else {
        s.textContent = '‚ùå Incorrect code.';
      }
    });

    document.getElementById('attemptPuzzleBtn').addEventListener('click', () => {
      hidePanel('mysteryBoxChamber');
      showPanel('puzzleBoxPanel');
      initPuzzleBox();
    });

    /* Puzzle Cube logic */
    let puzzleInitDone = false;
    let keys = { L:false, D:false, W:false, M:false, S:false, N:false };
    let cubeUnlocked = false;

    function shrinkPuzzleBox() {
      const panel = document.getElementById('puzzleBoxPanel');
      if (panel && window.innerWidth <= 768) {
        document.getElementById('imgVoidPuzzle').classList.add('shrunk');
        showPuzzleNotice();
      }
    }
    function restorePuzzleBox() {
      const voidEl = document.getElementById('imgVoidPuzzle');
      if (voidEl) voidEl.classList.remove('shrunk');
    }
    function showPuzzleNotice() {
      const notice = document.getElementById('puzzleNotice');
      if (!notice) return;
      if (window.innerWidth <= 768) {
        notice.classList.add('show');
        setTimeout(() => notice.classList.remove('show'), 6000);
      }
    }
    function pulseCube() {
      const cube = document.getElementById('labyrinthCube');
      if (!cube) return;
      cube.style.boxShadow = "0 0 40px rgba(0,245,181,0.6)";
      setTimeout(() => cube.style.boxShadow = "none", 900);
    }
    function checkCubeUnlock() {
      if (Object.values(keys).every(v => v) && !cubeUnlocked) {
        cubeUnlocked = true;
        const msg = document.getElementById('unlockMessage');
        if (msg) msg.style.display = 'block';
        pulseCube();
        const sigil = document.getElementById('hiddenSigil');
        if (sigil) sigil.style.display = 'block';
        const voidEl = document.getElementById('imgVoidPuzzle');
        if (voidEl) voidEl.classList.add('unlocked');

        // Fade sigil + cube, then transition
        setTimeout(() => { if (sigil) sigil.classList.add('fadeOut'); const cube = document.getElementById('labyrinthCube'); if (cube) cube.classList.add('fadeOut'); }, 30000);
        setTimeout(() => {
          hidePanel('puzzleBoxPanel'); showPanel('finalBranchPanel');
          if (sigil) { sigil.style.display = 'none'; sigil.classList.remove('fadeOut'); }
          const cube = document.getElementById('labyrinthCube'); if (cube) cube.classList.remove('fadeOut');
          if (voidEl) voidEl.classList.remove('unlocked');
        }, 60000);
      }
    }
    function resetPuzzleState() {
      keys = { L:false, D:false, W:false, M:false, S:false, N:false };
      cubeUnlocked = false;
      document.querySelectorAll('#lightsGrid .light-cell').forEach(cell => { cell.classList.remove('on'); cell.style.background=''; cell.style.boxShadow=''; });
      document.querySelectorAll('#labyrinthGrid .cell').forEach(c => c.classList.remove('on'));
      document.querySelectorAll('#memoryButtons .mem').forEach(btn => btn.classList.remove('flash'));
      ['runeL','runeD','runeW','runeM','runeS','runeN'].forEach(id=>{ const el = document.getElementById(id); if (el) el.style.display = 'none'; });
      const msg = document.getElementById('unlockMessage'); if (msg) msg.style.display = 'none';
      const hint = document.getElementById('lockerHint'); if (hint) hint.textContent = 'Turn CW ‚Äî Stage 1';
    }

    /* Lights Out wiring */
    function configureLightsOut() {
      const cells = [...document.querySelectorAll('#lightsGrid .light-cell')];
      if (!cells.length) return;
      const targetOn = shuffleArray([...Array(cells.length).keys()]).slice(0,4);
      function isSolved(){ return cells.every((c,i)=> c.classList.contains('on') === targetOn.includes(i)); }
      cells.forEach((cell, idx) => {
        if (cell.dataset.wired) return;
        cell.dataset.wired = '1';
        cell.addEventListener('click', () => {
          [idx, idx-1, idx+1, idx-3, idx+3].forEach(i => { if (cells[i]) cells[i].classList.toggle('on'); });
          if (isSolved()) { keys.L = true; const el = document.getElementById('runeL'); if (el) el.style.display='block'; pulseCube(); checkCubeUnlock(); }
        });
      });
    }

    /* Labyrinth path wiring */
    function generateLabPath(cells, width, length=9){
      const pick = arr => arr[Math.floor(Math.random()*arr.length)];
      let path = []; let current = Math.floor(Math.random()*cells.length); path.push(current);
      while (path.length < length) {
        const r = Math.floor(current/width), c = current%width;
        const neighbors = [];
        if (r > 0) neighbors.push(current - width);
        if (r < width-1) neighbors.push(current + width);
        if (c > 0) neighbors.push(current - 1);
        if (c < width-1) neighbors.push(current + 1);
        current = neighbors.length ? pick(neighbors) : Math.floor(Math.random()*cells.length);
        path.push(current);
      }
      return path;
    }
    function configureLabyrinth() {
      const cells = [...document.querySelectorAll('#labyrinthGrid .cell')];
      if (!cells.length) return;
      const width = Math.sqrt(cells.length)|0;
      const path = generateLabPath(cells, width, 9);
      let progress = 0;
      cells.forEach((cell, idx) => {
        cell.classList.remove('on');
        if (!cell.dataset.wired) {
          cell.dataset.wired = '1';
          cell.addEventListener('click', () => {
            if (idx === path[progress]) {
              cell.classList.add('on'); progress++;
              if (progress === path.length) { keys.M = true; const el = document.getElementById('runeM'); if (el) el.style.display='block'; pulseCube(); checkCubeUnlock(); }
            } else {
              cells.forEach(c => c.classList.remove('on')); progress = 0;
            }
          });
        }
      });
    }

    /* Memory wiring */
    function configureMemory() {
      const memBtns = [...document.querySelectorAll('#memoryButtons .mem')];
      const startBtn = document.getElementById('startMemory');
      if (!memBtns.length || !startBtn) return;
      let memSeq = [], playerSeq = [], playing = false;

      function flash(btn){ btn.classList.add('flash'); setTimeout(()=>btn.classList.remove('flash'), 220); }
      function playSequence() {
        playing = true; let i = 0;
        const interval = setInterval(() => {
          const val = memSeq[i];
          const btn = document.querySelector(`.mem[data-val="${val}"]`);
          if (btn) flash(btn);
          i++;
          if (i >= memSeq.length) { clearInterval(interval); playing = false; playerSeq = []; }
        }, 450);
      }
      function nextRound(){ memSeq.push(Math.floor(Math.random() * memBtns.length)); playSequence(); }

      if (!startBtn.dataset.wired) {
        startBtn.dataset.wired = '1';
        startBtn.addEventListener('click', () => { memSeq = []; playerSeq = []; nextRound(); });
      }
      memBtns.forEach(btn => {
        if (btn.dataset.wired) return;
        btn.dataset.wired = '1';
        btn.addEventListener('click', () => {
          if (playing || memSeq.length === 0) return;
          const val = parseInt(btn.dataset.val, 10);
          playerSeq.push(val); flash(btn);
          for (let i=0;i<playerSeq.length;i++){ if (playerSeq[i] !== memSeq[i]) { playerSeq = []; playSequence(); return; } }
          if (playerSeq.length === memSeq.length) {
            if (memSeq.length >= 4) { keys.S = true; const el = document.getElementById('runeS'); if (el) el.style.display = 'block'; pulseCube(); checkCubeUnlock(); }
            else nextRound();
          }
        });
      });
    }

    /* Locker combination (replaces dial+word+math) */
    function configureLockerDial() {
      const face = document.querySelector('#lockerDial .dial-face');
      const pointer = document.querySelector('#lockerDial .dial-pointer');
      const numbers = document.querySelector('#lockerDial .dial-numbers');
      const hint = document.getElementById('lockerHint');
      if (!face || !pointer || !numbers || !hint) return;

      // Generate numbers around dial (every 5 for clarity)
      numbers.innerHTML = '';
      for (let i=0;i<100;i+=5){
        const span = document.createElement('span');
        span.textContent = i;
        const angle = (i/100)*360;
        span.style.position = 'absolute';
        span.style.left = '50%';
        span.style.top = '50%';
        span.style.transformOrigin = '0 0';
        span.style.transform = `rotate(${angle}deg) translate(90px) rotate(-${angle}deg)`;
        numbers.appendChild(span);
      }

      // Randomized combo with distinct numbers
      const pool = shuffleArray([...Array(100).keys()]);
      const combo = [pool[20], pool[40], pool[60]].map(v => Math.round(v/5)*5 % 100); // snap to 5s for UX
      const directions = ['cw','ccw','cw'];
      let stage = 0, dragging = false, startAngle = 0, dialAngle = 0, lastAngle = 0;
      const tol = 3; // degrees -> ~1 number tolerance

      function angleToValue(angle){
        const normalized = ((angle % 360) + 360) % 360;
        return Math.round(normalized / 3.6); // 0‚Äì100
      }

      function updateHint() {
        if (stage < combo.length) {
          const dirLabel = directions[stage] === 'cw' ? 'CW' : 'CCW';
          hint.textContent = `Stage ${stage+1}/3 ‚Äî turn ${dirLabel} to ${combo[stage]}`;
        } else {
          hint.textContent = `Combo complete! (${combo.join(' ‚Üí ')})`;
        }
      }
      updateHint();

      function checkCombo(val, dir){
        const target = combo[stage];
        if (Math.abs(val - target) <= 2 && dir === directions[stage]) {
          stage++;
          updateHint();
          if (stage === combo.length) {
            // Mark D, W, N together to preserve six-key unlock cadence
            keys.D = true; keys.W = true; keys.N = true;
            ['runeD','runeW','runeN'].forEach(id => { const el = document.getElementById(id); if (el) el.style.display = 'block'; });
            pulseCube(); checkCubeUnlock();
            // Reset for replay if desired
            stage = 0;
          }
        } else if (Math.abs(val - target) <= 2 && dir !== directions[stage]) {
          // Wrong direction resets
          stage = 0;
          hint.textContent = "Wrong direction! Restart combo.";
          setTimeout(updateHint, 1200);
        }
      }

      function handleMove(x,y,cx,cy){
        const angle = Math.atan2(y - cy, x - cx) * 180/Math.PI;
        dialAngle += angle - startAngle;
        startAngle = angle;
        pointer.style.transform = `rotate(${dialAngle}deg)`;
        const val = angleToValue(dialAngle);
        const dir = (dialAngle - lastAngle) > 0 ? 'cw' : 'ccw';
        lastAngle = dialAngle;
        checkCombo(val, dir);
      }

      if (!face.dataset.wired) {
        face.dataset.wired = '1';
        face.addEventListener('mousedown', e => {
          dragging = true;
          const rect = face.getBoundingClientRect();
          const cx = rect.left + rect.width/2;
          const cy = rect.top + rect.height/2;
          startAngle = Math.atan2(e.clientY - cy, e.clientX - cx) * 180/Math.PI;
        });
        document.addEventListener('mousemove', e => {
          if (!dragging) return;
          const rect = face.getBoundingClientRect();
          handleMove(e.clientX, e.clientY, rect.left + rect.width/2, rect.top + rect.height/2);
        });
        document.addEventListener('mouseup', ()=> dragging=false);

        // Touch support
        face.addEventListener('touchstart', e => {
          dragging = true;
          const rect = face.getBoundingClientRect();
          const cx = rect.left + rect.width/2;
          const cy = rect.top + rect.height/2;
          const t = e.touches[0];
          startAngle = Math.atan2(t.clientY - cy, t.clientX - cx) * 180/Math.PI;
        }, { passive: true });
        document.addEventListener('touchmove', e => {
          if (!dragging) return;
          const rect = face.getBoundingClientRect();
          const t = e.touches[0];
          handleMove(t.clientX, t.clientY, rect.left + rect.width/2, rect.top + rect.height/2);
        }, { passive: true });
        document.addEventListener('touchend', ()=> dragging=false, { passive: true });
      }
    }

    /* Initialize on demand */
    function initPuzzleBox() {
      if (!puzzleInitDone) {
        configureLightsOut();
        configureLabyrinth();
        configureMemory();
        configureLockerDial();
        puzzleInitDone = true;
      } else {
        configureLockerDial(); // refresh combo each run
      }
      resetPuzzleState();
      shrinkPuzzleBox();
    }

    // Final clearance ‚Üí Superform
    document.getElementById('toFinalClearanceBtn').addEventListener('click', () => {
      hidePanel('finalBranchPanel');
      showPanel('finalClearancePanel');
    });
    document.getElementById('finalClearanceBtn').addEventListener('click', ()=>{
      const code = document.getElementById('finalClearanceCode').value.trim();
      const revealed = document.getElementById('revealedPassword').textContent.trim();
      const status = document.getElementById('finalClearanceStatus');
      if (code === revealed) {
        status.textContent = "‚úÖ Clearance accepted. Superform unlocked.";
        setTimeout(()=>{ hidePanel('finalClearancePanel'); showPanel('mysteryBoxPanel'); document.getElementById('superName').value = ceremonyName; }, 800);
      } else {
        status.textContent = "‚ùå Incorrect code.";
      }
    });

    // Superform submit (Prestige route)
    function submitSuperForm() {
      const code = document.getElementById("superCode").value.trim();
      if (code !== "TRIUMPH-777") {
        alert("Invalid super-level clearance code.");
        return false;
      }
      const name = document.getElementById("superName").value.trim();
      const tier = document.getElementById("superTier").value;
      const card = generateCardID();
      const accessCode = generateAccessCode();
      const message = `
üëë Super-Level Access Submission
üë§ Name: ${name}
üéñ Tier: ${tier}
üÜî Account ID: ${card}
üîë Clearance Code: ${accessCode}
      `.trim();
      document.getElementById('verificationText').value = message;
      document.getElementById('verificationPlaque').style.display = "block";
      alert("Super-level form submitted. Redirecting...");
      setTimeout(() => {
        window.location.href = `https://mrhim00.blogspot.com/2025/10/Admin-issued.html?card=${encodeURIComponent(card)}`;
      }, 10000);
      return false;
    }

    /* Interactive cube rotation */
    const cubeEl = document.getElementById('labyrinthCube');
    let draggingCube = false, startX = 0, startY = 0, rotX = -15, rotY = 20;
    function updateRotation() { if (cubeEl) cubeEl.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`; }
    if (cubeEl) {
      cubeEl.addEventListener('mousedown', e => { draggingCube = true; startX = e.clientX; startY = e.clientY; });
      window.addEventListener('mousemove', e => {
        if (!draggingCube) return;
        const dx = e.clientX - startX, dy = e.clientY - startY;
        startX = e.clientX; startY = e.clientY;
        rotY += dx * 0.4; rotX -= dy * 0.4; updateRotation();
      });
      window.addEventListener('mouseup', () => draggingCube = false);
      cubeEl.addEventListener('touchstart', e => { draggingCube = true; startX = e.touches[0].clientX; startY = e.touches[0].clientY; }, { passive: true });
      cubeEl.addEventListener('touchmove', e => {
        if (!draggingCube) return;
        const dx = e.touches[0].clientX - startX, dy = e.touches[0].clientY - startY;
        startX = e.touches[0].clientX; startY = e.touches[0].clientY;
        rotY += dx * 0.4; rotX -= dy * 0.4; updateRotation();
      }, { passive: true });
      cubeEl.addEventListener('touchend', () => draggingCube = false, { passive: true });
      updateRotation();
    }

    /* Keyboard unlock shortcuts */
    document.addEventListener("DOMContentLoaded", function () {
      document.addEventListener("keydown", function (e) {
        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === "a") {
          const adminForm = document.getElementById("adminForm");
          if (adminForm) { adminForm.style.display = "block"; alert("Admin access form unlocked."); }
        }
        if (e.ctrlKey && e.altKey && e.key.toLowerCase() === "q") {
          const superPanel = document.getElementById("mysteryBoxPanel");
          if (superPanel) { superPanel.style.display = "block"; alert("Super-level access form unlocked."); }
        }
      });
    });
  </script>
</body>
</html>
