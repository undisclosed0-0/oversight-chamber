<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prestige Triumph ‚Äî Oversight Chambers (Hybrid, Restored)</title>
<style>
 /* Prestige container */
body {
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle at top center, #f5f7fa 0%, #e6ecf0 100%);
  color: #333;
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 900px;
  margin: auto;
  background: rgba(255,255,255,0.95);
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(75,63,114,0.2);
  backdrop-filter: blur(6px);
}
.crest-header {
  width: 100px; height: 100px; margin: 0 auto 20px;
  background-image: url('https://blogger.googleusercontent.com/img/b/.../An%20abstract%20Masterad.png');
  background-size: cover; background-position: center; border-radius: 50%;
  box-shadow: 0 0 20px rgba(194,167,109,0.6);
}
h1, h2, h3 {
  color: #4b3f72;
  text-align: center;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.12);
  margin: 0 0 14px 0;
}

/* Verification plaque */
.verification-plaque {
  margin-top: 25px; padding: 20px;
  border: 2px solid #c2a76d; border-radius: 12px;
  background: linear-gradient(to bottom, #fdfcfb, #f3e8e2);
  box-shadow: 0 0 15px rgba(194,167,109,0.4);
  text-align: center;
  display: none;
}
.verification-plaque textarea {
  width: 100%; height: 120px; margin-top: 10px; padding: 8px;
  border-radius: 8px; border: 1px solid #c2a76d;
  font-family: 'Courier New', monospace; font-size: 0.95em; resize: none;
  background: #fffdf8;
}
.verification-plaque button {
  margin-top: 12px; padding: 10px 20px;
  background: linear-gradient(to right, #4b3f72, #6a5acd);
  color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em;
  box-shadow: 0 4px 12px rgba(75,63,114,0.3);
}
.verification-plaque button:hover {
  background: linear-gradient(to right, #6a5acd, #4b3f72);
}

/* Floating crest */
.floating-crest {
  position: fixed; width: 60px; height: 60px; bottom: 20px; right: -115px;
  background-image: url('https://blogger.googleusercontent.com/img/b/.../An%20abstract%20Masterad.png');
  background-size: cover; background-position: center; border-radius: 50%;
  box-shadow: 0 0 20px rgba(194,167,109,0.6); cursor: pointer; z-index: 101; opacity: 0.95;
}
@media (max-width: 860px) { .floating-crest { pointer-events: none; opacity: 0.7; } }

/* Tap shimmer */
.tap-zone { position: fixed; width: 64px; height: 64px; top: 0; z-index: 999; }
#tapTopLeft { left: 0; }
#tapTopRight { right: 0; }
.tap-shimmer {
  position: fixed; inset: 0; pointer-events: none; z-index: 998;
  background:
    radial-gradient(120px 120px at 32px 32px, rgba(255,215,0,0.25), transparent 70%),
    radial-gradient(120px 120px at calc(100% - 32px) 32px, rgba(106,90,205,0.22), transparent 70%);
  opacity: 0; transition: opacity 260ms ease;
}
.tap-shimmer.active { opacity: 1; }

/* Panel shells */
:root {
  --gold:#ffd700; --violet:#6a0dad; --iron:#222;
  --panel-bg: radial-gradient(circle at center, #1a1a1a 0%, #0d0d0d 100%);
}
.panel-shell {
  background: var(--panel-bg); border: 3px solid #444; border-radius: 12px;
  box-shadow: inset 0 0 25px rgba(0,0,0,0.8), 0 0 20px rgba(255,215,0,0.18);
  padding: 20px; margin-top: 20px; color: var(--gold);
  font-family: 'Orbitron','Courier New', monospace;
}
.panel-shell h2, .panel-shell h3 {
  color: var(--gold); text-transform: uppercase;
  text-shadow: 0 0 8px rgba(255,215,0,0.6);
}
.panel-shell label { display: block; margin-top: 12px; font-weight: 700; }
.panel-shell input, .panel-shell select {
  width: 100%; margin-top: 8px; padding: 10px; border-radius: 6px;
  border: 2px solid #333; background: #111; color: var(--gold); font-weight: bold;
  box-shadow: inset 0 0 6px rgba(0,0,0,0.7);
}
.panel-shell button {
  margin-top: 15px; padding: 10px 20px; border-radius: 8px; border: 2px solid var(--iron);
  background: linear-gradient(var(--gold), #b8860b); color: #111; font-weight: bold;
  text-transform: uppercase; cursor: pointer; box-shadow: 0 0 10px rgba(255,215,0,0.5);
  transition: transform 0.15s ease, box-shadow 0.3s ease;
}
.panel-shell button:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(255,215,0,0.8); }

/* Ritual grid */
#panelButtons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 12px; }
.panel-btn { /* ... unchanged ... */ }

/* Cube faces, Lights Out, Labyrinth, Memory, Locker Dial, etc. */
/* (Your definitions here are already consistent and valid ‚Äî no syntax errors) */

/* PuzzleBox panel */
#puzzleBoxPanel {
  max-width: 480px; margin: 40px auto; padding: 20px; background: var(--panel-bg);
  border: 3px solid #444; border-radius: 12px;
  box-shadow: inset 0 0 25px rgba(0,0,0,0.8), 0 0 20px rgba(255,215,0,0.18);
  color: var(--gold); font-family: 'Orbitron','Courier New', monospace;
}
#imgVoidPuzzle {
  width: 100%; max-width: 340px; aspect-ratio: 1/1; margin: 0 auto; padding: 16px;
  background: radial-gradient(600px 400px at 50% 50%, rgba(0,0,0,0.85), #0d0d0d);
  border-radius: 16px;
  box-shadow: inset 0 0 80px rgba(0,0,0,0.95), 0 0 60px rgba(255,215,0,0.08);
  display: flex; align-items: center; justify-content: center;
  transition: transform 0.6s ease, max-width 0.6s ease;
}
@media (max-width: 768px) {
  #imgVoidPuzzle.shrunk { max-width: 50%; transform: scale(0.9); margin: 0 auto; padding: 12px; }
}
@media (max-width: 480px) {
  body { padding: 10px; }
  .container { padding: 20px; }
  h1 { font-size: 1.4em; }
  .crest-header { width: 80px; height: 80px; }
  #imgVoidPuzzle { max-width: 240px; padding: 12px; }
  .cube-face { font-size: 12px; padding: 8px; }
}

/* Mystery Chamber, Admin Chamber, Color Panel, etc. */
/* (Your definitions are consistent ‚Äî no syntax errors) */

/* Hidden sigil pulse */
#hiddenSigil { /* ... unchanged ... */ }

  </style>
</head>
<body>
  <div class="container">
    <div class="crest-header"></div>
    <h1>Prestige Triumph: Oversight Entry</h1>

    <!-- Public form -->
    <form id="love-form" method="POST" class="prestige-form"
      action="https://www.blogger.com/contact-form.do"
      target="hidden_iframe"
      onsubmit="return submitCeremonialForm();"
      style="max-width:600px;margin:40px auto;padding:32px;background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.12);">
      <label for="role">Select Tier</label>
      <select id="role" name="role" required>
        <option value="">Select your role</option>
        <option value="Initiate">Initiate</option>
        <option value="Steward">Steward</option>
        <option value="Neighbor">Neighbor</option>
        <option value="Contributor">Contributor</option>
        <option value="Observer">Observer</option>
        <option value="Supporter">Supporter</option>
        <option value="Archivist">Archivist</option>
      </select>

      <div style="text-align:center; margin:12px 0 18px 0;">
        <button type="button" id="genNameBtn"
                onclick="generateNameFromTier()"
                style="width:70%; max-width:320px; background:#c2a76d; color:#fff;
                       border:none; padding:10px 18px; border-radius:6px;
                       font-size:1em; box-shadow:0 2px 6px rgba(0,0,0,0.2);
                       cursor:pointer;">
          ‚ú® Generate Prestige Name
        </button>
      </div>

      <input type="text" id="name" name="name" placeholder="e.g., Solenne of the Third Tier" required style="width:100%;padding:12px 14px;border:1px solid #b8aee0;border-radius:6px;background:#fafafa;color:#4b3f72;">
      <label for="phone">Contact Number</label>
      <input type="tel" id="phone" name="phone" placeholder="e.g., +1 616-555-1234" required style="width:100%;padding:12px 14px;border:1px solid #b8aee0;border-radius:6px;background:#fafafa;color:#4b3f72;">

      <textarea id="message" name="message" style="display:none;"></textarea>
      <input type="email" name="email" id="bloggerEmail" style="display:none;">
      <button type="submit" style="margin-top:24px;width:100%;padding:14px;background:linear-gradient(to right,#4b3f72,#6a5acd);color:white;border:none;border-radius:8px;font-size:1.1em;cursor:pointer;">Create Account</button>
    </form>

    <!-- Admin chamber -->
    <form id="adminForm" onsubmit="return false;" style="display:none;">
      <h2>Admin Access</h2>
      <label for="adminTier">Tier</label>
      <select id="adminTier" name="adminTier" required>
        <option value="Admin">Admin</option>
        <option value="MasterAdmin">Master Admin</option>
      </select>
      <label for="adminCode">Clearance Code</label>
      <input id="adminCode" name="adminCode" required type="password" />
      <button type="button" id="verifyTierBtn">Verify</button>
      <p id="verifyStatus"></p>
    </form>

    <!-- Ritual Sequence Panel -->
    <div id="colorPanel" class="panel-shell" style="display:none;">
      <div class="ritual-header" style="display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:16px;">
        <div class="runic">·ö†·õá·öª·õú·ö±</div>
        <div class="sigil" aria-hidden="true" style="position:relative;width:72px;height:72px;display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 0 14px rgba(212,184,106,0.45));">
          <span class="sigil-ring" style="position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle, rgba(212,184,106,0.8), rgba(95,192,181,0.7));"></span>
          <span class="sigil-core" style="position:absolute;inset:18px;border-radius:50%;background:radial-gradient(circle, rgba(40,40,45,0.8), rgba(90,106,122,0.6));"></span>
          <span class="sigil-square" style="position:absolute;width:36px;height:36px;transform:rotate(45deg);background:linear-gradient(135deg, rgba(242,240,233,0.95), rgba(212,184,106,0.85));"></span>
        </div>
      </div>

      <p class="designation">Designation: <strong id="nameInRitual"></strong></p>

      <div class="indicator-lines" id="indicatorLines">
        <span></span><span></span><span></span><span></span>
      </div>

      <div id="sequenceReadout" class="sequence">‚Äî ‚Äî ‚Äî</div>
      <div class="rune-grid" id="panelButtons"></div>

      <div class="ritual-controls">
        <button id="verifySequence" class="verify-btn">VERIFY</button>
        <button id="clearSequence" class="clear-btn">CLEAR</button>
      </div>
    </div>

    <!-- Access keypad -->
    <div id="superCodePanel" class="panel-shell" style="display:none; position:relative;">
      <h3>Access Panel</h3>
      <div class="panel-sigil">‚ôõ</div>
      <div class="panel-content">
        <p>Rune keypad unlocked. Enter access code to proceed.</p>
        <input id="accessCodeInput" type="text" placeholder="Enter code (X-719-BOX)">
        <button id="accessCodeBtn">Verify Code</button>
        <p id="accessCodeStatus"></p>
      </div>
    </div>

    <!-- Mystery Box chamber -->
    <div id="mysteryBoxChamber" class="panel-shell" style="display:none;">
      <h2 class="mystery-title">Mystery Box Chamber</h2>
      <div class="mystery-crest">‚ôõ ‚öö ‚üÅ</div>
      <p>The chamber hums with hidden power. Attempt the Puzzle Box?</p>
      <button id="attemptPuzzleBtn">Attempt Puzzle Box</button>
    </div>

    <!-- Puzzle Box ‚Äî Labyrinth Cube -->
    <div id="puzzleBoxPanel" class="panel-shell" style="display:none;">
      <h2 class="mystery-title">Puzzle Box ‚Äî Labyrinth Cube</h2>
      <p>Designation: <strong id="nameInPuzzle"></strong></p>
      <div id="hiddenSigil">‚úß Triumphal Sigil ‚úß</div>

      <div id="imgVoidPuzzle">
        <div class="cube-container">
          <div class="cube" id="labyrinthCube">
            <!-- Face 1: Lights Out -->
            <div class="cube-face front">
              <p>Toggle the pattern</p>
              <div id="lightsGrid">
                <button class="light-cell"></button><button class="light-cell"></button><button class="light-cell"></button>
                <button class="light-cell"></button><button class="light-cell"></button><button class="light-cell"></button>
                <button class="light-cell"></button><button class="light-cell"></button><button class="light-cell"></button>
              </div>
              <div id="runeL" class="rune">Œõ</div>
            </div>

            <!-- Face 2: Locker Dial -->
            <div class="cube-face back">
              <p>Locker combination: follow the directions</p>
              <div id="lockerDial">
                <div class="dial-face">
                  <div class="dial-pointer"></div>
                  <div class="dial-center"></div>
                  <div class="dial-numbers"></div>
                </div>
              </div>
              <div id="lockerHint">Turn CW ‚Äî Stage 1</div>
              <div id="runeD" class="rune">‚ú¶</div>
            </div>

            <!-- Face 3: Labyrinth Path (untouched) -->
            <div class="cube-face left">
              <p>Trace the hidden path</p>
              <div id="labyrinthGrid">
                <!-- 5x5 grid -->
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
                <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
              </div>
              <div id="runeM" class="rune">Œ©</div>
            </div>

            <!-- Face 4: Memory -->
            <div class="cube-face top">
              <p>Repeat the sequence</p>
              <button id="startMemory">Start</button>
              <div id="memoryButtons">
                <button class="mem" data-val="0">‚ñ≤</button>
                <button class="mem" data-val="1">‚óÜ</button>
                <button class="mem" data-val="2">‚öô</button>
              </div>
              <div id="runeS" class="rune">Œ£</div>
            </div>

            <!-- Face 5: Word Scramble -->
            <div class="cube-face right">
              <p id="wordHint">Unscramble:</p>
              <input type="text" id="wordInput" placeholder="Your answer">
              <div id="runeW" class="rune">Œ®</div>
            </div>

            <!-- Face 6: Math Sum -->
            <div class="cube-face bottom">
              <p id="mathHint">Solve the sum</p>
              <div id="mathGrid">
                <button class="num"></button>
                <button class="num"></button>
                <button class="num"></button>
                <button class="num"></button>
                <button class="num"></button>
              </div>
              <div id="runeN" class="rune">Œ¶</div>
            </div>
          </div>
        </div>
      </div>

      <p id="unlockMessage" style="display:none;">‚ú® The Labyrinth Cube Unlocks! ‚ú®</p>
    </div>

    <!-- Final Branch -->
    <div id="finalBranchPanel" class="panel-shell" style="display:none;">
      <h2>Final Branch</h2>
      <p>Your final password is: <strong id="revealedPassword">QUBE-ACCESS-777</strong></p>
      <button id="toFinalClearanceBtn">Proceed to Final Clearance Qube</button>
    </div>

    <!-- Final Clearance Chamber -->
    <div id="finalClearancePanel" class="panel-shell" style="display:none;">
      <h2 class="mystery-title">Puzzle Box Mechanism</h2>
      <div class="glowing-cube"></div>
      <p>Enter the final clearance code to unlock the Superform.</p>
      <input id="finalClearanceCode" type="password" placeholder="Re-enter final code" />
      <button id="finalClearanceBtn">Unlock</button>
      <p id="finalClearanceStatus"></p>
    </div>

    <!-- Superform chamber -->
    <div id="mysteryBoxPanel" class="panel-shell" style="display:none; border-color: var(--violet); box-shadow: inset 0 0 25px rgba(0,0,0,0.8), 0 0 20px rgba(138,43,226,0.6);">
      <h2 class="mystery-title">Super Level Access</h2>
      <div class="mystery-crest">‚ôõ ‚öö ‚üÅ</div>
      <div class="cube-aura" aria-hidden="true"></div>
      <form id="superLevelForm" onsubmit="return submitSuperForm();">
        <div class="panel-sigil"></div>
        <div class="frost-overlay"></div>
        <label for="superName">Account Holder</label>
        <input id="superName" name="superName" required type="text" />
        <label for="superTier">Tier</label>
        <select id="superTier" name="superTier" required>
          <option value="Sovereign">Sovereign</option>
          <option value="Luminary">Luminary</option>
          <option value="Legacy">Legacy Tier</option>
        </select>
        <label for="superCode">Clearance Code</label>
        <input id="superCode" name="superCode" required type="password" />
        <button type="submit">Submit Super-Level Form</button>
        <p id="superFormStatus"></p>
      </form>
    </div>

    <!-- Verification plaque -->
    <div class="verification-plaque" id="verificationPlaque">
      <p>Copy this verification text and paste it into the official Prestige Verification Form:</p>
      <textarea id="verificationText" readonly></textarea>
      <button type="button" onclick="copyVerification()">üìã Copy Verification Text</button>
    </div>
  </div>

  <!-- Crest shortcut -->
  <div class="floating-crest" onclick="unlockSuperForm()" title="Unlock Super Form"></div>

  <!-- Blogger iframe target -->
  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <!-- Tap shimmer + zones -->
  <div class="tap-shimmer" id="tapShimmer"></div>
  <div id="tapTopLeft" class="tap-zone" aria-hidden="true"></div>
  <div id="tapTopRight" class="tap-zone" aria-hidden="true"></div>

  <!-- Mobile notice -->
  <div id="puzzleNotice">üì± For true Puzzle Box engagement, reduce your screen size to 50% on mobile.</div>




   <script>
/* ===== Core helpers ===== */
function showPanel(id){ const el = document.getElementById(id); if (el) el.style.display = 'block'; }
function hidePanel(id){ const el = document.getElementById(id); if (el) el.style.display = 'none'; }
function copyVerification() {
  const textArea = document.getElementById("verificationText");
  if (!textArea) return;
  textArea.select();
  textArea.setSelectionRange(0, 99999);
  document.execCommand("copy");
  alert("Verification text copied. Please paste it into the Google Form field.");
}

/* ===== Name generator ===== */
function generateTieredName(tier) {
  const pools = {
    Initiate: { names:["Lena","Jamal","Sofia","Kai","Maya"], suffixes:["of the Welcome Ledger","of the First Entry","of the Community Fold"] },
    Steward:  { names:["Elias","Priya","Malcolm","Zara","Omar"], suffixes:["of the Civic Watch","of the Shared Archive","of the Stewardship Line"] },
    Neighbor: { names:["Ava","Noah","Grace","Leo","Isla"], suffixes:["of the Local Registry","of the Neighborhood Tier","of the Common Fold"] },
    Contributor:{ names:["Milan","Tessa","Jude","Nina","Arlo"], suffixes:["of the Support Ledger","of the Contributor Line","of the Community Archive"] },
    Observer: { names:["Theo","Luna","Miles","Ivy","Rowan"], suffixes:["of the Quiet Watch","of the Passive Tier","of the Ledger Periphery"] },
    Supporter:{ names:["Elena","Caleb","Raya","Finn","Naomi"], suffixes:["of the Advocacy Fold","of the Support Tier","of the Donor Registry"] },
    Archivist:{ names:["Solenne","Idris","Helena","Lucan","Amara"], suffixes:["of the Memory Vault","of the Archivist Line","of the Tiered Archive"] }
  };
  const pool = pools[tier] || pools.Initiate;
  const name = pool.names[Math.floor(Math.random()*pool.names.length)];
  const suffix = pool.suffixes[Math.floor(Math.random()*pool.suffixes.length)];
  return `${name} ${suffix}`;
}
function generateNameFromTier() {
  const tier = document.getElementById('role')?.value;
  if (!tier) { alert('Please select a tier first.'); return; }
  const nameEl = document.getElementById('name');
  if (nameEl) nameEl.value = generateTieredName(tier);
}

/* ===== Blogger-friendly helpers ===== */
function generateCardID() { return 'CARD-' + Math.random().toString(36).substr(2, 8).toUpperCase(); }
function generateAccessCode() { return 'ACCESS-' + Math.floor(100000 + Math.random() * 900000); }

/* ===== Random helpers ===== */
function shuffleArray(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function arraysMatch(a, b) {
  if (a.length !== b.length) return false;
  for (let i = 0; i < a.length; i++) {
    if (a[i] !== b[i]) return false;
  }
  return true;
}

/* ===== Ceremony-wide codes ===== */
const TIER_CODES = { Admin: "A-231-GATE", MasterAdmin: "M-Q8/-CROWN" };
const HIDDEN_CODE = "X-719-BOX";

let ceremonyName = "";
let superSequence = [];
let requiredSequence = [];
let tapLog = [];

/* ===== Puzzle state ===== */
let puzzleInitDone = false;
let keys = { L:false, D:false, W:false, M:false, S:false, N:false };
let cubeUnlocked = false;

/* ===== Mobile void handling ===== */
function shrinkPuzzleBox() {
  const voidEl = document.getElementById('imgVoidPuzzle');
  if (voidEl && window.innerWidth <= 768) {
    voidEl.classList.add('shrunk');
    showPuzzleNotice();
  }
}
function restorePuzzleBox() {
  const voidEl = document.getElementById('imgVoidPuzzle');
  if (voidEl) voidEl.classList.remove('shrunk');
}
function showPuzzleNotice() {
  const notice = document.getElementById('puzzleNotice');
  if (!notice) return;
  if (window.innerWidth <= 768) {
    notice.classList.add('show');
    setTimeout(() => notice.classList.remove('show'), 6000);
  }
}

/* ===== Tap shimmer ===== */
let shimmerTimer;
function shimmerPulse(){
  const s = document.getElementById('tapShimmer');
  if (!s) return;
  s.classList.add('active');
  clearTimeout(shimmerTimer);
  shimmerTimer = setTimeout(() => s.classList.remove('active'), 260);
}

/* ===== Cube aura pulse ===== */
function pulseCube() {
  const cube = document.getElementById('labyrinthCube');
  if (!cube) return;
  cube.style.boxShadow = "0 0 40px rgba(0,245,181,0.6)";
  setTimeout(() => cube.style.boxShadow = "none", 900);
}

/* ===== Unlock check ===== */
function checkCubeUnlock() {
  if (Object.values(keys).every(v => v) && !cubeUnlocked) {
    cubeUnlocked = true;

    const msg = document.getElementById('unlockMessage');
    const sigil = document.getElementById('hiddenSigil');
    const voidEl = document.getElementById('imgVoidPuzzle');

    if (msg) msg.style.display = 'block';
    if (sigil) sigil.style.display = 'block';
    if (voidEl) voidEl.classList.add('unlocked');
    pulseCube();

    setTimeout(() => { if (sigil) sigil.classList.add('fadeOut'); const cube = document.getElementById('labyrinthCube'); if (cube) cube.classList.add('fadeOut'); }, 30000);
    setTimeout(() => {
      hidePanel('puzzleBoxPanel'); showPanel('finalBranchPanel');
      if (sigil) { sigil.style.display = 'none'; sigil.classList.remove('fadeOut'); }
      const cube = document.getElementById('labyrinthCube'); if (cube) cube.classList.remove('fadeOut');
      if (voidEl) voidEl.classList.remove('unlocked');
      restorePuzzleBox();
    }, 60000);
  }
}

/* ===== Ritual grid ===== */
function buildRitualGrid(){
  const panel = document.getElementById('panelButtons');
  if (!panel) return;
  panel.innerHTML = "";

  const colors  = ["red","blue","green","mustard","violet","cyan","deepred","emerald","deepviolet"];
  const glyphs  = ["‚üü","œû","‚üÅ","‚ßñ","·ö†","Œ∂","‚Ç£","‚üä","‚öö","‚ôõ","‚ß´"];
  const numbers = ["231","85/","V2Œ∂","‚Ç£2","77X","9√ò","31Œî","8.98","27$","719"];

  requiredSequence = shuffleArray(colors).slice(0,4);

  colors.forEach(c=>{
    const btn = document.createElement('button');
    btn.type = "button";
    btn.className = "rune-btn " + c;
    const sigil = glyphs[Math.floor(Math.random()*glyphs.length)];
    const num   = numbers[Math.floor(Math.random()*numbers.length)];
    btn.innerHTML = `<span class="sigil">${sigil}</span><small>${num}</small>`;
    btn.addEventListener('click', ()=>handleRitualTap(c, btn));
    panel.appendChild(btn);
  });

  superSequence = [];
  tapLog = [];
  renderSequence();
  updateIndicators();
}
function handleRitualTap(color, btn){
  superSequence.push(color);
  tapLog.push({ color, btn });
  renderSequence();
  btn.classList.toggle('active');
  updateIndicators();
  btn.classList.add('glow');
  setTimeout(() => btn.classList.remove('glow'), 1200);
}
function renderSequence(){
  const sequenceReadout = document.getElementById('sequenceReadout');
  if (!sequenceReadout) return;
  const text = superSequence.length ? superSequence.join('~') : '----';
  sequenceReadout.textContent = '';
  let i = 0;
  const interval = setInterval(() => {
    sequenceReadout.textContent += text[i] || '';
    i++;
    if (i >= text.length) clearInterval(interval);
  }, 40);
}
function updateIndicators() {
  const indicators = document.querySelectorAll('#indicatorLines span');
  indicators.forEach((bar, i) => {
    if (i < superSequence.length) bar.classList.add('active');
    else bar.classList.remove('active');
  });
}

/* ===== Puzzle wiring ===== */
function resetPuzzleState() {
  keys = { L:false, D:false, W:false, M:false, S:false, N:false };
  cubeUnlocked = false;
  document.querySelectorAll('#lightsGrid .light-cell').forEach(cell => { cell.classList.remove('on'); cell.style.background=''; cell.style.boxShadow=''; });
  document.querySelectorAll('#labyrinthGrid .cell').forEach(c => c.classList.remove('on'));
  document.querySelectorAll('#memoryButtons .mem').forEach(btn => btn.classList.remove('flash'));
  ['runeL','runeD','runeW','runeM','runeS','runeN'].forEach(id=>{ const el = document.getElementById(id); if (el) el.style.display = 'none'; });
  const msg = document.getElementById('unlockMessage'); if (msg) msg.style.display = 'none';
  const hint = document.getElementById('lockerHint'); if (hint) hint.textContent = 'Turn CW ‚Äî Stage 1';
}

function configureLightsOut() {
  const cells = [...document.querySelectorAll('#lightsGrid .light-cell')];
  if (!cells.length) return;
  const targetOn = shuffleArray([...Array(cells.length).keys()]).slice(0,4);
  function isSolved(){ return cells.every((c,i)=> c.classList.contains('on') === targetOn.includes(i)); }
  cells.forEach((cell, idx) => {
    if (cell.dataset.wired) return;
    cell.dataset.wired = '1';
    cell.addEventListener('click', () => {
      [idx, idx-1, idx+1, idx-3, idx+3].forEach(i => { if (cells[i]) cells[i].classList.toggle('on'); });
      if (isSolved()) { keys.L = true; const el = document.getElementById('runeL'); if (el) el.style.display='block'; pulseCube(); checkCubeUnlock(); }
    });
  });
}

function generateLabPath(cells, width, length=9){
  const pick = arr => arr[Math.floor(Math.random()*arr.length)];
  let path = []; let current = Math.floor(Math.random()*cells.length); path.push(current);
  while (path.length < length) {
    const r = Math.floor(current/width), c = current%width;
    const neighbors = [];
    if (r > 0) neighbors.push(current - width);
    if (r < width-1) neighbors.push(current + width);
    if (c > 0) neighbors.push(current - 1);
    if (c < width-1) neighbors.push(current + 1);
    current = neighbors.length ? pick(neighbors) : Math.floor(Math.random()*cells.length);
    path.push(current);
  }
  return path;
}
function configureLabyrinth() {
  const cells = [...document.querySelectorAll('#labyrinthGrid .cell')];
  if (!cells.length) return;
  const width = Math.sqrt(cells.length)|0;
  const path = generateLabPath(cells, width, 9);
  let progress = 0;
  cells.forEach((cell, idx) => {
    cell.classList.remove('on');
    if (!cell.dataset.wired) {
      cell.dataset.wired = '1';
      cell.addEventListener('click', () => {
        if (idx === path[progress]) {
          cell.classList.add('on'); progress++;
          if (progress === path.length) { keys.M = true; const el = document.getElementById('runeM'); if (el) el.style.display='block'; pulseCube(); checkCubeUnlock(); }
        } else {
          cells.forEach(c => c.classList.remove('on')); progress = 0;
        }
      });
    }
  });
}

function configureMemory() {
  const memBtns = [...document.querySelectorAll('#memoryButtons .mem')];
  const startBtn = document.getElementById('startMemory');
  if (!memBtns.length || !startBtn) return;
  let memSeq = [], playerSeq = [], playing = false;

  function flash(btn){ btn.classList.add('flash'); setTimeout(()=>btn.classList.remove('flash'), 220); }
  function playSequence() {
    playing = true; let i = 0;
    const interval = setInterval(() => {
      const val = memSeq[i];
      const btn = document.querySelector(`.mem[data-val="${val}"]`);
      if (btn) flash(btn);
      i++;
      if (i >= memSeq.length) { clearInterval(interval); playing = false; playerSeq = []; }
    }, 450);
  }
  function nextRound(){ memSeq.push(Math.floor(Math.random() * memBtns.length)); playSequence(); }

  if (!startBtn.dataset.wired) {
    startBtn.dataset.wired = '1';
    startBtn.addEventListener('click', () => { memSeq = []; playerSeq = []; nextRound(); });
  }
  memBtns.forEach(btn => {
    if (btn.dataset.wired) return;
    btn.dataset.wired = '1';
    btn.addEventListener('click', () => {
      if (playing || memSeq.length === 0) return;
      const val = parseInt(btn.dataset.val, 10);
      playerSeq.push(val); flash(btn);
      for (let i=0;i<playerSeq.length;i++){ if (playerSeq[i] !== memSeq[i]) { playerSeq = []; playSequence(); return; } }
      if (playerSeq.length === memSeq.length) {
        if (memSeq.length >= 4) { keys.S = true; const el = document.getElementById('runeS'); if (el) el.style.display = 'block'; pulseCube(); checkCubeUnlock(); }
        else nextRound();
      }
    });
  });
}

function configureLockerDial() {
  const face = document.querySelector('#lockerDial .dial-face');
  const pointer = document.querySelector('#lockerDial .dial-pointer');
  const numbers = document.querySelector('#lockerDial .dial-numbers');
  const hint = document.getElementById('lockerHint');
  if (!face || !pointer || !numbers || !hint) return;

  numbers.innerHTML = '';
  for (let i=0;i<100;i+=5){
    const span = document.createElement('span');
    span.textContent = i;
    const angle = (i/100)*360;
    span.style.position = 'absolute';
    span.style.left = '50%';
    span.style.top = '50%';
    span.style.transformOrigin = '0 0';
    span.style.transform = `rotate(${angle}deg) translate(90px) rotate(-${angle}deg)`;
    numbers.appendChild(span);
  }

  const pool = shuffleArray([...Array(100).keys()]);
  const combo = [pool[20], pool[40], pool[60]].map(v => Math.round(v/5)*5 % 100);
  const directions = ['cw','ccw','cw'];
  let stage = 0, dragging = false, startAngle = 0, dialAngle = 0, lastAngle = 0;

  function angleToValue(angle){
    const normalized = ((angle % 360) + 360) % 360;
    return Math.round(normalized / 3.6); // 0‚Äì100
  }
  function updateHint() {
    if (stage < combo.length) {
      const dirLabel = directions[stage] === 'cw' ? 'CW' : 'CCW';
      hint.textContent = `Stage ${stage+1}/3 ‚Äî turn ${dirLabel} to ${combo[stage]}`;
    } else {
      hint.textContent = `Combo complete! (${combo.join(' ‚Üí ')})`;
    }
  }
  updateHint();

  function checkCombo(val, dir){
    const target = combo[stage];
    if (Math.abs(val - target) <= 2 && dir === directions[stage]) {
      stage++;
      updateHint();
      if (stage === combo.length) {
        keys.D = true; const el = document.getElementById('runeD'); if (el) el.style.display = 'block';
        pulseCube(); checkCubeUnlock();
        stage = 0;
      }
    } else if (Math.abs(val - target) <= 2 && dir !== directions[stage]) {
      stage = 0;
      hint.textContent = "Wrong direction! Restart combo.";
      setTimeout(updateHint, 1200);
    }
  }
  function handleMove(x,y,cx,cy){
    const angle = Math.atan2(y - cy, x - cx) * 180/Math.PI;
    dialAngle += angle - startAngle;
    startAngle = angle;
    pointer.style.transform = `rotate(${dialAngle}deg)`;
    const val = angleToValue(dialAngle);
    const dir = (dialAngle - lastAngle) > 0 ? 'cw' : 'ccw';
    lastAngle = dialAngle;
    checkCombo(val, dir);
  }

  if (!face.dataset.wired) {
    face.dataset.wired = '1';
    face.addEventListener('mousedown', e => {
      dragging = true;
      const rect = face.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      startAngle = Math.atan2(e.clientY - cy, e.clientX - cx) * 180/Math.PI;
    });
    document.addEventListener('mousemove', e => {
      if (!dragging) return;
      const rect = face.getBoundingClientRect();
      handleMove(e.clientX, e.clientY, rect.left + rect.width/2, rect.top + rect.height/2);
    });
    document.addEventListener('mouseup', ()=> dragging=false);

    face.addEventListener('touchstart', e => {
      dragging = true;
      const rect = face.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      const t = e.touches[0];
      startAngle = Math.atan2(t.clientY - cy, t.clientX - cx) * 180/Math.PI;
    }, { passive: true });
    document.addEventListener('touchmove', e => {
      if (!dragging) return;
      const rect = face.getBoundingClientRect();
      const t = e.touches[0];
      handleMove(t.clientX, t.clientY, rect.left + rect.width/2, rect.top + rect.height/2);
    }, { passive: true });
    document.addEventListener('touchend', ()=> dragging=false, { passive: true });
  }
}

/* ===== Superform submit ===== */
function submitCeremonialForm() {
  const nameEl = document.getElementById('name');
  const phoneEl = document.getElementById('phone');
  const roleEl = document.getElementById('role');
  if (!nameEl || !phoneEl || !roleEl) return false;

  const name = nameEl.value.trim();
  const phone = phoneEl.value.trim();
  const role = roleEl.value;
  const card = generateCardID();
  const accessCode = generateAccessCode();

  const registry = JSON.parse(localStorage.getItem('userRegistry')) || {};
  registry[name] = { role, phone, card, accessCode, created: Date.now(), activated: false };
  localStorage.setItem('userRegistry', JSON.stringify(registry));

  const message = `
ü™î Prestige Triumph Verification
üë§ Name: ${name}
üìû Phone: ${phone}
üéñ Tier: ${role}
üÜî Account ID: ${card}
üîë Access Code: ${accessCode}
  `.trim();

  const msgEl = document.getElementById('message');
  const emailEl = document.getElementById('bloggerEmail');
  const verTextEl = document.getElementById('verificationText');
  const plaqueEl = document.getElementById('verificationPlaque');

  if (msgEl) msgEl.value = message;
  if (emailEl) emailEl.value = "prestige@triumph.org";
  if (verTextEl) verTextEl.value = message;
  if (plaqueEl) plaqueEl.style.display = "block";

  alert("Your account request has been received.\n\nRedirecting you to the official Prestige Verification Chamber");
  setTimeout(() => {
    window.location.href = `https://mrhim00.blogspot.com/2025/10/issued.html?card=${encodeURIComponent(card)}`;
  }, 10000);

  return false;
}
function unlockSuperForm() {
  showPanel('mysteryBoxPanel');
  const name = document.getElementById('name')?.value.trim();
  if (name) {
    const superName = document.getElementById('superName');
    if (superName) superName.value = name;
  }
  alert("Super-level access form unlocked.");
}
function submitSuperForm() {
  const code = document.getElementById("superCode")?.value.trim();
  if (code !== "TRIUMPH-777") {
    alert("Invalid super-level clearance code.");
    return false;
  }
  const name = document.getElementById("superName")?.value.trim() || '';
  const tier = document.getElementById("superTier")?.value || '';
  const card = generateCardID();
  const accessCode = generateAccessCode();
  const message = `
üëë Super-Level Access Submission
üë§ Name: ${name}
üéñ Tier: ${tier}
üÜî Account ID: ${card}
üîë Clearance Code: ${accessCode}
  `.trim();
  const verTextEl = document.getElementById('verificationText');
  const plaqueEl = document.getElementById('verificationPlaque');
  if (verTextEl) verTextEl.value = message;
  if (plaqueEl) plaqueEl.style.display = "block";
  alert("Super-level form submitted. Redirecting...");
  setTimeout(() => {
    window.location.href = `https://mrhim00.blogspot.com/2025/10/Admin-issued.html?card=${encodeURIComponent(card)}`;
  }, 10000);
  return false;
}

/* ===== Bind everything after DOM is ready ===== */
document.addEventListener("DOMContentLoaded", function () {
  /* Admin tap unlock (top-left then top-right) */
  let adminTapSequence = [];
  let adminTapResetTimer;
  function resetAdminTap(){ adminTapSequence=[]; clearTimeout(adminTapResetTimer); }
  function checkAdminMobileUnlock(){
    const correct = ['tapTopLeft','tapTopRight'];
    if (adminTapSequence.join(',') === correct.join(',')) {
      showPanel('adminForm'); shimmerPulse(); resetAdminTap();
    } else {
      adminTapResetTimer = setTimeout(resetAdminTap, 8000);
    }
  }
  const tl = document.getElementById('tapTopLeft');
  const tr = document.getElementById('tapTopRight');
  if (tl) tl.addEventListener('click', ()=>{ adminTapSequence.push('tapTopLeft'); shimmerPulse(); checkAdminMobileUnlock(); });
  if (tr) tr.addEventListener('click', ()=>{ adminTapSequence.push('tapTopRight'); shimmerPulse(); checkAdminMobileUnlock(); });

  /* Admin verify ‚Üí ritual */
  const verifyBtn = document.getElementById('verifyTierBtn');
  if (verifyBtn) verifyBtn.addEventListener('click', ()=>{
    const status = document.getElementById('verifyStatus');
    const tierSel = document.getElementById('adminTier')?.value;
    const code = (document.getElementById('adminCode')?.value || '').trim();
    if (!code) { if (status) status.textContent = "Enter clearance code."; return; }

    ['colorPanel','superCodePanel','puzzleBoxPanel','finalClearancePanel','mysteryBoxPanel','mysteryBoxChamber','finalBranchPanel'].forEach(hidePanel);

    const ok = (tierSel === 'Admin' && code === TIER_CODES.Admin) ||
               (tierSel === 'MasterAdmin' && code === TIER_CODES.MasterAdmin) ||
               (code === HIDDEN_CODE);

    if (ok) {
      const role = document.getElementById('role')?.value || 'Initiate';
      ceremonyName = generateTieredName(role);
      if (status) status.textContent = "‚úÖ Verified. Proceed to the ritual.";
      const nameEl = document.getElementById('nameInRitual'); if (nameEl) nameEl.textContent = ceremonyName;
      superSequence = [];
      showPanel('colorPanel');
      buildRitualGrid();
    } else {
      if (status) status.textContent = "‚ùå Invalid clearance for selected tier.";
    }
  });

  /* Ritual sequence verify */
  const verifySeqBtn = document.getElementById('verifySequence');
  if (verifySeqBtn) verifySeqBtn.addEventListener('click', () => {
    const attemptColors = superSequence.slice(0,4);
    const attemptTaps   = tapLog.slice(0,4);
    const correct = arraysMatch(attemptColors, requiredSequence);

    const sequenceReadout = document.getElementById('sequenceReadout');
    if (sequenceReadout) {
      if (correct) {
        sequenceReadout.textContent = "ACCESS GRANTED >> ACCESS PANEL";
        sequenceReadout.style.color = "#6aff6a";
        hidePanel('colorPanel');
        showPanel('superCodePanel');
        const nameInPuzzle = document.getElementById('nameInPuzzle');
        const nameInRitual = document.getElementById('nameInRitual');
        if (nameInPuzzle && nameInRitual) nameInPuzzle.textContent = nameInRitual.textContent;
      } else {
        sequenceReadout.textContent = "ACCESS DENIED";
        sequenceReadout.style.color = "#ff4a4a";
      }
    }

    attemptTaps.forEach(({ color, btn }, i) => {
      btn.classList.remove('after-correct','after-wrong');
      if (color === requiredSequence[i]) {
        btn.classList.add('after-correct');
        setTimeout(() => btn.classList.remove('after-correct'), 4000);
      } else {
        btn.classList.add('after-wrong');
        setTimeout(() => btn.classList.remove('after-wrong'), 1200);
      }
    });

    superSequence = [];
    tapLog = [];
    updateIndicators();
  });

  const clearSeqBtn = document.getElementById('clearSequence');
  if (clearSeqBtn) clearSeqBtn.addEventListener('click', () => {
    superSequence = [];
    tapLog = [];
    renderSequence();
    document.querySelectorAll('.rune-btn').forEach(btn => {
      btn.classList.remove('active','after-correct','after-wrong','glow');
    });
    updateIndicators();
  });

  /* Access Panel ‚Üí Mystery Box Chamber */
  const accessCodeBtn = document.getElementById('accessCodeBtn');
  if (accessCodeBtn) accessCodeBtn.addEventListener('click', () => {
    const v = document.getElementById('accessCodeInput')?.value.trim().toUpperCase();
    const s = document.getElementById('accessCodeStatus');
    if (v === 'X-719-BOX') {
      if (s) s.textContent = '‚úÖ Code accepted. Proceeding to Mystery Box...';
      setTimeout(() => { hidePanel('superCodePanel'); showPanel('mysteryBoxChamber'); }, 600);
    } else {
      if (s) s.textContent = '‚ùå Incorrect code.';
    }
  });

  const attemptPuzzleBtn = document.getElementById('attemptPuzzleBtn');
  if (attemptPuzzleBtn) attemptPuzzleBtn.addEventListener('click', () => {
    hidePanel('mysteryBoxChamber');
    showPanel('puzzleBoxPanel');
    initPuzzleBox();
  });

  /* Final clearance ‚Üí Superform */
  const toFinalBtn = document.getElementById('toFinalClearanceBtn');
  if (toFinalBtn) toFinalBtn.addEventListener('click', () => { hidePanel('finalBranchPanel'); showPanel('finalClearancePanel'); });

  const finalClearBtn = document.getElementById('finalClearanceBtn');
  if (finalClearBtn) finalClearBtn.addEventListener('click', ()=>{
    const code = document.getElementById('finalClearanceCode')?.value.trim();
    const revealed = document.getElementById('revealedPassword')?.textContent.trim();
    const status = document.getElementById('finalClearanceStatus');
    if (code === revealed) {
      if (status) status.textContent = "‚úÖ Clearance accepted. Superform unlocked.";
      setTimeout(()=>{ hidePanel('finalClearancePanel'); showPanel('mysteryBoxPanel'); const sname = document.getElementById('superName'); if (sname) sname.value = ceremonyName; }, 800);
    } else {
      if (status) status.textContent = "‚ùå Incorrect code.";
    }
  });

  /* Public form submit binding */
  const loveForm = document.getElementById('love-form');
  if (loveForm) loveForm.onsubmit = submitCeremonialForm;

  /* Superform submit binding */
  const superLevelForm = document.getElementById('superLevelForm');
  if (superLevelForm) superLevelForm.onsubmit = submitSuperForm;

  /* Crest shortcut */
  const crest = document.querySelector('.floating-crest');
  if (crest) crest.addEventListener('click', unlockSuperForm);

  /* Cube rotation (interactive) */
  const cubeEl = document.getElementById('labyrinthCube');
  let draggingCube = false, startX = 0, startY = 0, rotX = -15, rotY = 20;
  function updateRotation() { if (cubeEl) cubeEl.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`; }
  if (cubeEl) {
    cubeEl.addEventListener('mousedown', e => { draggingCube = true; startX = e.clientX; startY = e.clientY; });
    window.addEventListener('mousemove', e => {
      if (!draggingCube) return;
      const dx = e.clientX - startX, dy = e.clientY - startY;
      startX = e.clientX; startY = e.clientY;
      rotY += dx * 0.4; rotX -= dy * 0.4; updateRotation();
    });
    window.addEventListener('mouseup', () => draggingCube = false);
    cubeEl.addEventListener('touchstart', e => { draggingCube = true; startX = e.touches[0].clientX; startY = e.touches[0].clientY; }, { passive: true });
    cubeEl.addEventListener('touchmove', e => {
      if (!draggingCube) return;
      const dx = e.touches[0].clientX - startX, dy = e.touches[0].clientY - startY;
      startX = e.touches[0].clientX; startY = e.touches[0].clientY;
      rotY += dx * 0.4; rotX -= dy * 0.4; updateRotation();
    }, { passive: true });
    cubeEl.addEventListener('touchend', () => draggingCube = false, { passive: true });
    updateRotation();
  }

  /* Keyboard unlock shortcuts */
  document.addEventListener("DOMContentLoaded", function () {
  document.addEventListener("keydown", function (e) {
    // Admin form unlock
    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === "a") {
      const adminForm = document.getElementById("adminForm");
      if (adminForm) {
        adminForm.style.display = "block";
        alert("Admin access form unlocked.");
      }
    }

    // Superform unlock
    if (e.ctrlKey && e.altKey && e.key.toLowerCase() === "q") {
      const superPanel = document.getElementById("mysteryBoxPanel");
      if (superPanel) {
        superPanel.style.display = "block";
        alert("Super-level access form unlocked.");
      }
});

/* ===== Puzzle init orchestrator ===== */
function initPuzzleBox() {
  if (!puzzleInitDone) {
    configureLightsOut();
    configureLabyrinth();
    configureMemory();
    configureWordLock();   // add scramble
    configureMath();       // add math sum
    configureLockerDial(); // dial/locker
    wireWordLock();
    wireMath();
    puzzleInitDone = true;
  } else {
    // refresh puzzles that need new randomization each run
    configureLockerDial();
    configureWordLock();
    configureMath();
    configureLightsOut();
  }
  resetPuzzleState();
  shrinkPuzzleBox();
}



  </script>
</body>
</html>
