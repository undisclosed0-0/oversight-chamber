<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Prestige Hybrid Storefront</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
      --ink:#eaf3ff; --muted:#a8bfd6;
      --blue:#88ccff; --blueDim:#69b9ff;
      --silver:#c0cbd6; --gold:#ffd87a;
      --panel: rgba(30,30,40,0.88);
      --glass: rgba(255,255,255,0.08);
      --radius:14px;
      --shadow:0 18px 40px rgba(0,0,0,0.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); font-family:'Cinzel Decorative', serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
    }
    .wrap{ max-width:1160px; margin:0 auto; padding:18px }

    /* Header crest + fa√ßade */
    header.site {
      padding:22px 16px; text-align:center; position:relative;
      background: radial-gradient(640px 280px at 10% 0%, rgba(136,204,255,0.18), transparent);
      box-shadow: 0 0 30px rgba(136,204,255,0.15) inset;
    }
    .brand-title{
      font-size:2.6rem; margin:0;
      color:var(--ink);
      text-shadow: 0 0 20px var(--blue), 0 0 6px var(--blueDim);
    }
    .crest-mark{
      width:56px; height:56px; border-radius:50%; margin:0 auto 8px;
      background: conic-gradient(from 190deg, var(--blue), #aee3ff, var(--blueDim), var(--blue));
      box-shadow: 0 0 26px var(--blue);
    }

    /* Verse + token box + cart */
    .token-box{
      margin:16px auto; max-width:860px; padding:14px 16px;
      border:1px solid var(--blue); border-radius:12px;
      background: var(--glass); text-align:center;
      box-shadow: 0 0 24px rgba(136,204,255,0.25);
    }
    .verse{ font-style:italic; color:var(--ink); margin-bottom:10px }
    .counters{ display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-top:8px }
    .counter{
      padding:8px 12px; border-radius:10px; border:1px solid var(--blue);
      background: var(--glass); box-shadow: 0 0 14px rgba(136,204,255,0.25);
    }
    .counter.gold{ border-color: var(--gold); box-shadow: 0 0 16px rgba(255,216,122,0.35); color: var(--gold) }
    .counter.silver{ border-color: var(--silver); box-shadow: 0 0 16px rgba(192,203,214,0.35); color: var(--silver) }
    .cart-btn{
      all:unset; display:inline-block; margin-top:10px; cursor:pointer;
      background:linear-gradient(180deg, #152535, #0f1b29);
      border:1px solid var(--blue); color:var(--ink);
      padding:8px 12px; border-radius:10px;
      box-shadow: 0 0 14px rgba(136,204,255,0.25);
    }

    /* Farce-style first windows row (live/manual submission look) */
    .windows{
      display:grid; grid-template-columns:repeat(4,1fr); gap:12px;
      margin-top:18px;
    }
    .window{
      min-height:150px; position:relative; overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
      border:1px solid #28435a; border-radius:12px; box-shadow: var(--shadow);
    }
    .window::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:3px;
      background:linear-gradient(90deg, var(--blue), #aee3ff, var(--blueDim));
      opacity:0.75;
    }
    .tile{
      position:absolute; inset:0; display:flex; align-items:center; gap:12px; padding:12px;
    }
    .tile-art{
      width:70px; height:70px; border-radius:12px;
      background:linear-gradient(135deg, #7a1bd1, #ff2d6b);
      box-shadow:0 10px 26px rgba(122,27,209,0.35);
    }
    .tile-meta{ display:flex; flex-direction:column; gap:6px }
    .tile-title{ font-weight:700 }
    .tile-sub{ color:var(--muted); font-size:13px }
    .badge{
      display:inline-flex; align-items:center; gap:6px; font-size:12px; color:#04131f;
      background:linear-gradient(180deg, var(--blue), #bfe8ff); padding:4px 8px; border-radius:999px; font-weight:700;
    }

    /* Second windows row: chamber directory */
    .windows-dir{ margin-top:16px }
    .dir-card{ padding:12px; text-align:center; border:1px solid #28435a; border-radius:12px; background:var(--glass) }
    .dir-card h3{ margin:6px 0; text-shadow:0 0 8px var(--blue) }
    .dir-card p{ margin:0; color:var(--muted) }
    .dir-card .open{
      display:inline-block; margin-top:8px; padding:6px 10px; border-radius:10px;
      border:1px solid var(--blue); color:#04131f; background:linear-gradient(180deg, var(--blue), #bfe8ff);
      text-decoration:none; font-weight:700;
    }

    /* Chambers (dual panels: left info image/desc, right store) */
    .chamber{
      display:none; margin-top:18px; padding:18px;
      border:2px solid var(--blue); border-radius:var(--radius);
      background:var(--panel); box-shadow: 0 0 24px var(--blue);
    }
    .chamber.active{ display:block }
    .chamber-grid{
      display:grid; grid-template-columns: 1fr 1fr; gap:16px;
    }
    .info-panel, .store-panel{
      border:1px solid #2c4b64; border-radius:12px; background: var(--glass);
      padding:14px;
    }
    .info-img{
      width:100%; height:180px; border-radius:10px; margin-bottom:10px;
      background:linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      border:1px solid #325875;
    }
    .store-panel h4{ margin:0 0 10px; text-shadow:0 0 8px var(--blue) }
    .product-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:12px }
    .product-card{ border:1px solid var(--blue); border-radius:10px; padding:12px; background:#333a; box-shadow:0 0 12px var(--blue) }
    .price{ opacity:.9; margin:6px 0 }
    .status{ font-style:italic; min-height:22px }
    .status.pending{ color:var(--silver); text-shadow:0 0 6px var(--silver) }
    .status.finalized{ color:var(--gold); text-shadow:0 0 6px var(--gold) }

    /* Payment rails (inside Commerce checkout) */
    .checkout{
      margin-top:12px; display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:10px;
    }
    .rail{ border:1px dashed rgba(136,204,255,0.35); border-radius:10px; padding:12px; background:rgba(46,52,70,0.6) }
    .rail strong{ display:block; margin-bottom:6px }

    /* Live feed + reflection + community ad (timers are hook-ready) */
    .lower{
      margin-top:20px; display:grid; grid-template-columns: 2fr 1fr; gap:14px;
    }
    .panel-lite{
      border:1px solid #2c4b64; border-radius:12px; background: var(--glass);
      padding:12px;
    }
    .feed{ display:grid; gap:8px }
    .feed-item{ padding:10px; border-radius:10px; border:1px solid #325875; background:linear-gradient(180deg, rgba(20,26,34,0.9), rgba(12,17,23,0.9)) }
    .ad{ min-height:80px; display:flex; align-items:center; justify-content:center; text-align:center }

    /* Animations */
    @keyframes frostFade{ from{ opacity:0; transform:scale(0.98) } to{ opacity:1; transform:scale(1) } }
    @keyframes voidGlow{
      0%{ box-shadow:0 0 22px rgba(255,216,122,0.24) }
      50%{ box-shadow:0 0 44px rgba(255,238,200,0.5) }
      100%{ box-shadow:0 0 22px rgba(255,216,122,0.24) }
    }
    .frost{ animation:frostFade .8s ease forwards }
    .void{ animation:voidGlow 8s ease-in-out infinite }

    /* Controls */
    .controls{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px }
    .btn{
      all:unset; display:inline-block; cursor:pointer;
      background:linear-gradient(180deg,#152535,#0f1b29); color:var(--ink);
      border:1px solid var(--blue); border-radius:10px; padding:8px 12px; font-weight:700;
      box-shadow:0 0 14px rgba(136,204,255,0.25);
    }

    /* Responsive */
    @media (max-width:960px){ .windows{grid-template-columns:repeat(2,1fr)} .chamber-grid{grid-template-columns:1fr} .lower{grid-template-columns:1fr} }
    @media (max-width:560px){ .windows{grid-template-columns:1fr} .brand-title{font-size:2.2rem} }
 
  .feed-item {
  background: linear-gradient(180deg, rgba(20,26,34,0.9), rgba(12,17,23,0.9));
  border: 1px solid #273242;
  border-radius: 10px;
  padding: 10px 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  animation: fadeSlide 0.6s ease;
}
@keyframes fadeSlide {
  from { opacity: 0; transform: translateY(-6px); }
  to   { opacity: 1; transform: translateY(0); }
}

  .billboard-row {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 16px;
  margin-top: 20px;
}

.billboard-article {
  background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
  border: 1px solid #28435a;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(136,204,255,0.15);
  padding: 14px;
  animation: fadeSlide 0.6s ease;
}

.billboard-image {
  width: 100%;
  height: 140px;
  border-radius: 10px;
  background: #444;
  margin-bottom: 10px;
}

.billboard-title {
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 4px;
}

.billboard-sub {
  font-size: 0.9rem;
  color: #a8bfd6;
  margin-bottom: 6px;
}

.badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: bold;
  background: linear-gradient(180deg, #88ccff, #bfe8ff);
  color: #04131f;
}

@keyframes fadeSlide {
  from { opacity: 0; transform: translateY(-10px); }
  to   { opacity: 1; transform: translateY(0); }
}
.emblem-sigil {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin-bottom: 8px;
  background: radial-gradient(circle at center, rgba(255,255,255,0.08), rgba(136,204,255,0.15));
  box-shadow: 0 0 12px rgba(136,204,255,0.25);
}

/* Unique shading per method */
.prestige-pay {
  background: linear-gradient(135deg, #ffd87a, #fff2c2);
}
.cod {
  background: linear-gradient(135deg, #88ccff, #d0ecff);
}
.money-order {
  background: linear-gradient(135deg, #c0cbd6, #e2e8f0);
}
.checkout-cart {
  background: linear-gradient(135deg, #aee3ff, #eaf6ff);
}

 .cart-list { display: grid; gap: 12px; margin-top: 12px }
.cart-item {
  padding: 12px;
  border-radius: 10px;
  background: linear-gradient(90deg, #2a2a2a 0%, #3a3a3a 50%, #2a2a2a 100%);
  background-size: 200% 100%;
  animation: shimmerSoft 3s infinite linear;
  color: #e0e0e0;
}

@keyframes shimmerSoft {
  0%   { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
.cart-item {
  border: 1px solid rgba(255,255,255,0.06);
}

.cart-item.finalized {
  background: linear-gradient(135deg, #4a3a1a, #6a4a2a);
  color: #ffd87a;
  border: 1px solid #d6b36a;
  box-shadow: 0 0 12px rgba(255,216,122,0.35);
}

.receipt-confirm {
  font-size: 1.2rem;
  font-weight: bold;
  text-align: center;
  background: linear-gradient(135deg, #4a3a1a, #6a4a2a);
  padding: 12px;
  border-radius: 10px;
  box-shadow: 0 0 18px rgba(255,216,122,0.3);
}inear-gradient(135deg, #ffd87a, #fff2c2);
  border-radius: 12px;
  box-shadow: 0 0 24px rgba(255,216,122,0.35);
}
.info-img.glow {
  background: radial-gradient(circle at center, rgba(255,216,122,0.15), transparent);
  box-shadow: 0 0 30px rgba(255,216,122,0.45);
  border: 2px solid #d6b36a;
  border-radius: 12px;
  padding: 16px;
  color: #ffd87a;
}
.cart-btn {
  position: relative;
  font-size: 1rem;
  padding: 8px 14px;
}

.cart-count {
  position: absolute;
  top: -6px;
  right: 160px;
  background: crimson;
  color: white;
  font-size: 0.8rem;
  font-weight: bold;
  border-radius: 50%;
  padding: 2px 6px;
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
}
.product-card {
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.product-card:active {
  transform: scale(0.96); /* slight shrink to simulate press */
  box-shadow: 0 0 6px rgba(0,0,0,0.4) inset; /* inner shadow for depth */
}
.product-card {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  background: #1a1a1a;
  border: 1px solid #444;
  border-radius: 12px;
  padding: 16px;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  cursor: pointer;
}

.product-card:hover {
  transform: scale(1.02);
  box-shadow: 0 0 12px rgba(136,204,255,0.5);
}

.product-card:active {
  transform: scale(0.96);
  box-shadow: 0 0 6px rgba(0,0,0,0.4) inset;
}

.product-icon {
  height: 80px;
  width: 80px;
  margin: 0 auto 12px;
  background-size: cover;
  background-position: center;
  border-radius: 50%;
  box-shadow: 0 0 8px rgba(255,255,255,0.1);
}
.ring-crest { background-image: url('/assets/ring.png'); } /* example icon class */

.product-meta {
  text-align: center;
  margin-bottom: 8px;
}

.product-title {
  font-weight: bold;
  font-size: 1.1rem;
  margin-bottom: 4px;
}

.product-cost {
  color: #ccc;
  font-size: 0.95rem;
}

.product-status {
  font-size: 0.85rem;
  font-style: italic;
  color: #aaa;
}

.product-action {
  text-align: center;
  font-size: 0.9rem;
  color: #88ccff;
  margin-top: 8px;
}
.product-grid {
  display: flex;
  flex-direction: column;
  gap: 0; /* remove default spacing */
}

.product-card {
  padding: 16px;
  border-bottom: 1px solid rgba(255,255,255,0.08); /* subtle divider */
}

.product-card:last-child {
  border-bottom: none; /* no divider after last card */
}
.feed-item .badge {
  display:inline-block;
  background:#3b82f6; /* blue aura */
  color:#fff;
  font-size:0.75em;
  padding:2px 6px;
  border-radius:6px;
  margin-top:4px;
}
.floating-cart {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(20,26,34,0.85);
  border: 1px solid #28435a;
  border-radius: 12px;
  padding: 10px 16px;
  color: var(--ink);
  font-weight: bold;
  box-shadow: 0 0 18px rgba(136,204,255,0.25);
  z-index: 999;
  animation: frostFade 0.6s ease;
}
.ghost-btn {
  all: unset;
  margin-left: 12px;
  padding: 6px 10px;
  border-radius: 8px;
  background: linear-gradient(180deg, var(--blue), #bfe8ff);
  color: #04131f;
  font-weight: bold;
  cursor: pointer;
}
@keyframes frostFade {
  from { opacity: 0; transform: scale(0.98); }
  to   { opacity: 1; transform: scale(1); }
}
.frost {
  animation: frostFade 0.8s ease forwards;
}
.dir-controls {
  display: flex;
  justify-content: flex-end; /* push buttons to right edge */
  gap: 12px;
  margin-top: 12px;
}

.cer-btn {
  padding: 10px 20px;
  background: linear-gradient(180deg, #4b3f72, #6a5acd);
  color: #fff;
  font-family: 'Cinzel', serif;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(75, 63, 114, 0.3);
  cursor: pointer;
  transition: transform 0.2s ease;
}

.cer-btn:hover {
  transform: scale(1.05);
}

.logout-btn {
  background: linear-gradient(180deg, #a83232, #d94f4f); /* red aura */
  box-shadow: 0 4px 12px rgba(168, 50, 50, 0.4);
}
/* Match rectangular panel dimensions */
#loginPanel {
  background: rgba(30, 30, 30, 0.6);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 30px;
  width: 480px;       /* match other rectangular panels */
  min-height: 240px;  /* consistent vertical rhythm */
  margin: 40px auto;
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
  text-align: center;
  animation: fadeSlide 0.6s ease-out;
}

/* Inputs stretch to panel width */
#loginPanel input {
  width: 90%;
  max-width: 420px;   /* keep inside panel frame */
  padding: 12px;
  margin: 12px 0;
  border: none;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  font-size: 15px;
  outline: none;
  transition: background 0.3s;
}

#loginPanel input:focus {
  background: rgba(255, 255, 255, 0.2);
  box-shadow: 0 0 8px #ffd700;
}

/* Buttons aligned and consistent */
#loginPanel button {
  margin: 10px;
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, #ffd700, #ff8c00);
  color: #222;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

#loginPanel button:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 12px #ffd700;
}
/* Container with depth */
.frost-container {
  position: relative;
  width: 100%;
  max-width: 540px;
  height: 300px;
  margin: 0 auto;
  background: radial-gradient(circle at 50% 30%, #0d1117 0%, #0a0d12 40%, #06080b 100%);
  border: 1px solid rgba(140,160,200,0.18);
  box-shadow: 0 10px 28px rgba(0,0,0,0.45), inset 0 1px 18px rgba(120,150,200,0.12);
  border-radius: 16px;
  overflow: hidden;
  perspective: 900px;
}

/* Frost overlay */
.frost-overlay {
  position: absolute;
  inset: 0;
  backdrop-filter: blur(14px) saturate(1.05);
  background: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, rgba(180,210,255,0.07) 100%);
  border-radius: 16px;
  pointer-events: none;
  z-index: 3;
  animation: frostPulse 4.5s ease-in-out infinite;
}

@keyframes frostPulse {
  0%,100% { opacity: 0.9; }
  50%     { opacity: 0.75; }
}

/* 3D object wrapper */
.object-3d {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  z-index: 1;
}

/* Container perspective */
.frost-container {
  perspective: 1200px;
}

/* Ring stack: float, rotate, stretch */
.ring-stack {
  position: absolute;
  left: 50%;
  top: 52%;
  width: 240px;
  height: 240px;
  transform-style: preserve-3d;
  filter: drop-shadow(0 16px 22px rgba(0,0,0,0.45));
  animation:
    floatY 4.2s ease-in-out infinite,
    rotateAndStretch 14s linear infinite;
}

@keyframes floatY {
  0%,100% { transform: translate(-50%, -50%) translateY(0); }
  50%     { transform: translate(-50%, -50%) translateY(-10px); }
}

@keyframes rotateAndStretch {
  0%   { transform: translate(-50%, -50%) rotateY(0deg) scaleX(1.0); }
  25%  { transform: translate(-50%, -50%) rotateY(90deg) scaleX(1.18); }
  50%  { transform: translate(-50%, -50%) rotateY(180deg) scaleX(1.0); }
  75%  { transform: translate(-50%, -50%) rotateY(270deg) scaleX(1.18); }
  100% { transform: translate(-50%, -50%) rotateY(360deg) scaleX(1.0); }
}

/* SVG layers with depth */
.ring-layer {
  position: absolute;
  left: 0; top: 0;
  width: 100%; height: 100%;
  transform-style: preserve-3d;
}

.layer-front { transform: translateZ(36px) rotateX(2deg); }
.layer-mid   { transform: translateZ(18px) rotateX(1deg); }
.layer-back  { transform: translateZ(-18px) rotateX(-1deg); }

.ring-layer circle {
  stroke-width: 28;
  fill: none;
  filter: drop-shadow(0 0 6px rgba(0,0,0,0.3));
}

/* Inner rim */
.inner-rim {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 160px;
  height: 160px;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  box-shadow: inset 0 0 18px rgba(0,0,0,0.4);
  background: radial-gradient(circle, rgba(255,255,255,0.05), rgba(0,0,0,0.2));
  z-index: 0;
}

/* Facets */
.facets {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
}

.facet {
  position: absolute;
  width: 36px; height: 36px;
  background: linear-gradient(135deg, rgba(255,255,255,0.6), rgba(180,225,255,0.15));
  border: 1px solid rgba(190,220,255,0.35);
  backdrop-filter: blur(1px);
  box-shadow: 0 3px 9px rgba(0,0,0,0.25);
  transform: translateZ(20px) rotateX(18deg) scaleX(1.4);
  opacity: 0.65;
  border-radius: 8px;
  animation: facetShimmer 3.6s ease-in-out infinite;
}

@keyframes facetShimmer {
  0%,100% { opacity: 0.55; }
  50%     { opacity: 0.85; }
}

/* Side facets */
.side-facets {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  z-index: 0;
}

.side {
  position: absolute;
  width: 14px;
  height: 140px;
  background: linear-gradient(90deg, rgba(180,220,255,0.2), rgba(255,255,255,0.05));
  border-radius: 6px;
  transform-origin: center;
  opacity: 0.5;
  backdrop-filter: blur(1px);
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
  transform: translate(-50%, 0) rotateY(90deg) scaleX(1.4);
}

.s1 { left: 50%; top: 0%; }
.s2 { left: 50%; top: 25%; }
.s3 { left: 50%; top: 50%; }
.s4 { left: 50%; top: 75%; }

/* Status */
.object-status {
  position: absolute;
  bottom: 12px;
  left: 12px;
  padding: 6px 10px;
  font-size: 14px;
  border-radius: 10px;
  z-index: 4;
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(120,140,180,0.25);
}

.object-status.pending {
  color: #cdd4e0;
  font-style: italic;
  text-shadow: 0 0 4px rgba(190,190,220,0.5);
}

.object-status.finalized {
  color: goldenrod;
  font-weight: bold;
  text-shadow: 0 0 6px rgba(255,215,0,0.6);
}

.frost-container.finalized .ring-stack {
  filter: drop-shadow(0 20px 26px rgba(0,0,0,0.5)) saturate(1.1);
}
.chamber-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  padding: 12px;
}

@media (min-width: 600px) {
  .chamber-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 900px) {
  .chamber-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}
#imgVoid {
  width: 100%;
  max-width: 360px;
  margin: 0 auto;
  aspect-ratio: 3 / 2;
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  background: linear-gradient(to bottom, #0a0f1c, #1c2738);
}
.store-card {
  padding: 12px;
  border-radius: 10px;
  background: #1e2a38;
  color: #fff;
  font-size: 0.95rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: transform 0.2s ease;
}

.store-card:active {
  transform: scale(0.98);
}
.chamber-panel {
  display: none;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.chamber-panel.active {
  display: block;
  opacity: 1;
}
.mobile-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #0f172a;
  display: flex;
  justify-content: space-around;
  padding: 8px 0;
  z-index: 1000;
}

/* Hide sticky nav on tablet/desktop */
@media (min-width: 768px) {
  .mobile-nav {
    display: none !important;
  }
}

.checkout-btn {
  position: fixed;
  bottom: 60px;   /* above sticky bar */
  right: 12px;
  background: #2ed573;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 16px;
  font-size: 0.9rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}
.cart-btn {
  margin-bottom: 60px; /* lifts cart above sticky nav */
}

/* Hide on larger screens */
@media (min-width: 768px) {
  .checkout-btn {
    display: none;
  }
}
.user-login {
  width: 100%;      /* default full width */
  max-width: 400px; /* desktop size */
  margin: 0 auto;
}

/* Mobile half size */
@media (max-width: 480px) {
  .user-login {
    width: 50%;     /* half screen width */
    margin: 0 auto;
  }
}
/* Desktop checkout button */
.checkout-btn-desktop {
  display: inline-block;
}

/* Hide desktop checkout on mobile */
@media (max-width: 767px) {
  .checkout-btn-desktop {
    display: none;
  }
}

/* Mobile checkout button */
.checkout-btn-mobile {
  display: none;
  position: fixed;
  bottom: 60px;   /* above sticky bar */
  right: 12px;
  background: #2ed573;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 16px;
  font-size: 0.9rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}

/* Show mobile checkout only on small screens */
@media (max-width: 767px) {
  .checkout-btn-mobile {
    display: block;
  }
}
.billboard-container {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;       /* horizontal scroll on mobile */
  gap: 12px;
  scroll-snap-type: x mandatory; /* smooth snapping */
}

.billboard {
  flex: 0 0 auto;
  width: 240px;
  height: 140px;
  background: #1e2a38;
  border-radius: 8px;
  opacity: 0;
  transform: translateX(40px);
  animation: fadeSlide 0.8s ease forwards;
  scroll-snap-align: start;
}

@keyframes fadeSlide {
  from {
    opacity: 0;
    transform: translateX(40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
.billboard-container {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
}

.billboard {
  flex: 0 0 100%;        /* take full width of screen */
  height: 160px;
  background: #1e2a38;
  border-radius: 8px;
  scroll-snap-align: center;
}

/* On larger screens, show multiple side by side */
@media (min-width: 768px) {
  .billboard {
    flex: 0 0 240px;     /* fixed size per billboard */
    margin-right: 12px;
  }
}


  </style>
<!-- Paste this entire block into the Console -->
<!-- Unified Prestige: HTML hooks, CSS, and JS (paste once before </body>) -->
<style>
  /* Core UI */
  .prestige-slot-final { display:flex; flex-direction:column; gap:8px; align-items:center; padding:8px; box-sizing:border-box; min-width:220px; }
  .prestige-buzzer { width:56px; height:56px; border-radius:50%; border:none; cursor:pointer; background: radial-gradient(circle at 30% 30%, #ffd87a, #ffb84d 60%); box-shadow:0 8px 24px rgba(255,184,77,0.18); display:inline-flex; align-items:center; justify-content:center; font-weight:800; color:#04131f; font-size:20px; }
  .prestige-buzzer-label-final { color:#eaf3ff; font-weight:700; font-size:0.92rem; text-align:center; margin-top:6px; }
  .prestige-widget-final { width:100%; max-width:360px; padding:10px; border-radius:10px; background:linear-gradient(180deg,#071428,#0f2a3a); color:#eaf3ff; box-shadow:0 8px 24px rgba(0,0,0,0.35); display:flex; flex-direction:column; gap:8px; }
  .prestige-widget-final .input { width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:rgba(255,255,255,0.02); color:inherit; box-sizing:border-box; }
  .prestige-send { padding:8px 10px; border-radius:8px; background:linear-gradient(180deg,#ffd87a,#ffb84d); color:#04131f; font-weight:700; border:none; cursor:pointer; }
  .prestige-send.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:#88ccff; }
  .prestige-hidden { display:none !important; }
  .prestige-small { font-size:0.88rem; color:#a8bfd6; }

  /* Modal */
  .prestige-modal { position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:10010; width:min(720px,92%); max-width:720px; background:#071428; color:#eaf3ff; border-radius:12px; padding:16px; box-shadow:0 20px 60px rgba(0,0,0,0.6); display:none; }
  .prestige-modal textarea { width:100%; height:160px; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:rgba(255,255,255,0.02); color:inherit; resize:vertical; box-sizing:border-box; }
  .prestige-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
  .prestige-btn { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
  .prestige-btn.primary { background:linear-gradient(180deg,#ffd87a,#ffb84d); color:#04131f; }
  .prestige-btn.ghost { background:transparent; color:#88ccff; border:1px solid rgba(136,204,255,0.12); }

  /* Positioning helper (keeps your manual inline --x/--y) */
  .prestige-buzzer.center-over-tap { display:inline-block; transform: translateX(var(--x, 0px)) translateY(var(--y, 0px)); transition: transform .12s ease; z-index:9999; will-change: transform; }
  
  /* Modal sizing: limit width and keep it centered like native modal */
.prestige-modal,
.prestige-modal.show,
.prestige-modal[style] {
  max-width: 720px !important;     /* adjust to desired modal width */
  width: calc(100% - 48px) !important;
  box-sizing: border-box !important;
  margin: 24px auto !important;
  padding: 18px !important;
}

/* Make injected controls visually consistent with common modal button styles */
.prestige-injected-controls .prestige-proceed,
.prestige-injected-controls .prestige-cancel {
  min-width: 88px;
  padding: 8px 14px;
  border-radius: 6px;
  border: 1px solid transparent;
  font-size: 14px;
  line-height: 1;
  cursor: pointer;
  transition: background-color .12s ease, color .12s ease, transform .06s ease;
}

/* Primary look for Proceed */
.prestige-injected-controls .prestige-proceed {
  background: var(--btn-primary-bg, #0b74de);
  color: var(--btn-primary-color, #fff);
  box-shadow: var(--btn-primary-shadow, 0 1px 0 rgba(0,0,0,0.05));
  border-color: rgba(0,0,0,0.06);
}

/* Secondary look for Cancel */
.prestige-injected-controls .prestige-cancel {
  background: var(--btn-secondary-bg, #fff);
  color: var(--btn-secondary-color, #111);
  border: 1px solid var(--btn-secondary-border, #d1d5db);
}

/* Hover/focus states */
.prestige-injected-controls .prestige-proceed:hover,
.prestige-injected-controls .prestige-proceed:focus { filter: brightness(.95); transform: translateY(-1px); }
.prestige-injected-controls .prestige-cancel:hover,
.prestige-injected-controls .prestige-cancel:focus { background: #f7f7f8; }

/* If the site uses a dark modal, invert injected controls automatically */
.prestige-modal.dark .prestige-injected-controls .prestige-proceed {
  background: var(--btn-primary-bg-dark, #2563eb);
  color: #fff;
}
.prestige-modal.dark .prestige-injected-controls .prestige-cancel {
  background: transparent;
  color: #e5e7eb;
  border-color: rgba(255,255,255,0.08);
}

/* Small responsive tweak */
@media (max-width:420px){
  .prestige-injected-controls .prestige-proceed,
  .prestige-injected-controls .prestige-cancel { flex: 1 1 auto; min-width: 0; }
  .prestige-injected-controls { flex-direction: column-reverse; gap: 8px; }
}

/* Frosted ledger style for purchase history */
#purchaseHistory {
  margin-top: 18px;
  padding: 12px;
  background: rgba(255,255,255,0.08);
  border-radius: 8px;
  backdrop-filter: blur(6px);
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}

#purchaseHistory h4 {
  font-weight: 700;
  margin-bottom: 10px;
  color: var(--accent, #ffd700); /* gold accent */
}

#purchaseHistory .prestige-sheet {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.95rem;
  color: #eee;
}

#purchaseHistory .prestige-sheet th {
  text-align: left;
  padding: 6px 10px;
  background: rgba(255,255,255,0.12);
  font-weight: 600;
  letter-spacing: 0.5px;
}

#purchaseHistory .prestige-sheet td {
  padding: 6px 10px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

#purchaseHistory .prestige-sheet tr:hover {
  background: rgba(255,255,255,0.06);
}

#purchaseHistory .glow-gold {
  color: #ffd700;
  font-weight: 600;
  text-shadow: 0 0 6px #ffd700;
}

#purchaseHistory .glow-silver {
  color: #c0c0c0;
  font-weight: 600;
  text-shadow: 0 0 6px #c0c0c0;
}

/* Modal: centered, inert by default, no margin that shifts it down */
/* Center the modal in the viewport (replace the #prestigeModal block) */
#prestigeModal {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%); /* true center */
  z-index: 11000;
  width: min(720px, calc(100% - 48px)); /* responsive, wider if space allows */
  max-width: 480px;                      /* keep your desired max width */
  box-sizing: border-box;
  padding: 18px;
  background: var(--modal-bg, #fff);
  color: var(--modal-text, #04131f);
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.25);
  max-height: 80vh;
  overflow: auto;
  display: block;
  visibility: hidden;    /* inert until .open */
  opacity: 0;
  pointer-events: none;
  transition: opacity .16s ease, transform .16s ease, visibility .16s;
}

/* Visible state (keep this so .open shows the modal) */
#prestigeModal.open {
  visibility: visible;
  opacity: 1;
  pointer-events: auto;
  transform: translate(-50%, -50%);
}

/* Ensure SMS preview text remains readable (keep or append to your rules) */
#prestigeSmsText {
  color: var(--preview-text, #04131f) !important;
  background: var(--preview-bg, #f9f9f9) !important;
  font-family: var(--mono, monospace);
  white-space: pre-wrap;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid var(--border-muted, #ccc);
  height: 240px;
  overflow-y: auto;
  font-size: 0.95rem;
  line-height: 1.45;
  word-break: break-word;
  caret-color: transparent;
}

/* Center the action buttons horizontally and keep spacing */
.prestige-actions {
  display: flex;
  gap: 10px;
  justify-content: center;   /* center buttons horizontally */
  align-items: center;
  margin-top: 12px;
  flex-wrap: wrap;           /* keep responsive behavior on small screens */
}

/* Keep button contrast rules intact */
.prestige-actions .prestige-btn {
  color: var(--btn-text, #111) !important;
  background: var(--btn-bg, #eee) !important;
  border-color: rgba(0,0,0,0.06);
}


/* Make CartID prominent if present */
#prestigeModal .cart-id,
.prestige-modal .cart-id {
  font-weight: 800;
  color: #ffd87a;
  margin-bottom: 8px;
  font-size: 0.95rem;
  letter-spacing: 0.4px;
  text-shadow: 0 0 6px rgba(255,215,0,0.08);
}


/* Buttons and actions: ensure contrast on light modal */
.prestige-actions .prestige-btn {
  color: var(--btn-text, #111) !important;
  background: var(--btn-bg, #eee) !important;
  border-color: rgba(0,0,0,0.06);
}


/* Dark mode fallback */
@media (prefers-color-scheme: dark) {
  #prestigeSmsText {
    color: var(--preview-text-dark, #eaf3ff);
    background: var(--preview-bg-dark, rgba(255,255,255,0.03));
    border-color: rgba(255,255,255,0.06);
  }
}
/* Increase vertical separation between top actions and confirm row inside the modal */
#prestigeModal .prestige-actions { margin-bottom: 36px; }
#prestigeModal .prestige-confirm,
#prestigeModal #prestigeConfirm { margin-top: 36px; }

</style>
</head>
<body>
  <div class="wrap">

    <!-- Fa√ßade header -->
    <header class="site">
      <div class="crest-mark" aria-hidden="true"></div>
      <h1 class="brand-title"> PRESTIGE HYBRID STORE</h1>
    </header>

    <!-- Verse + token + cart -->
    <section class="token-box frost">
      <div class="verse" id="dailyVerse">‚ÄúLet all that you do be done in love.‚Äù ‚Äî 1 Corinthians 16:14</div>
      <div class="counters">
        <div class="counter gold"><strong>Purchased:ü™ô</strong> <span id="purchasedCount">0</span></div>
        <div class="counter silver"><strong>Symbolic:‚ô¶Ô∏è</strong> <span id="symbolicCount">0</span></div>
      </div>
      <button class="cart-btn" id="cartBtn" onclick="showChamber('checkoutPanel')">
    üõí Cart & Checkout 
    <span id="cartCount" class="cart-count">0</span></button>
    </section>

<section id="userDirectory" class="chamber frost">
  <h4>üë• User Directory</h4>
  <div class="user-grid"></div>
  <div id="purchaseHistory" class="purchase-history-panel"></div>
  <div class="dir-controls">
    <button id="retrieveBtn" class="cer-btn">Retrieve Account Information</button>
    <button id="logoutBtn" class="cer-btn logout-btn">Log Out</button>
  </div>
</section>



<section id="loginPanel" class="chamber frost">

  <h4>üîë User Login</h4>
  <div class="controls">
    <input type="text" id="loginUser" placeholder="Enter Username" />
   <div id="accessCodeWrapper" style="display: none;">
    <input type="password" id="loginCode" placeholder="Enter Access Code" />
    <button id="toggleCodeBtn">üëÅ Reveal</button>
  </div>

  <button id="revealCodeBtn">Reveal Access Code Field</button>
  <button id="loginBtn">Log In</button>
  <div id="loginStatus" class="status pending" style="margin-top:8px"></div>
  
</section>

    <!-- First windows row (Farce-style live/manual submission look) -->
    <section class="windows" aria-label="Live submissions">
      <article class="window">
        <div class="tile">
          <div class="tile-art" aria-hidden="true"></div>
          <div class="tile-meta">
            <div class="tile-title">Midnight Static</div>
            <div class="tile-sub">Nova & The Wires</div>
            <span class="badge">New</span>
          </div>
        </div>
      </article>
      <article class="window">
        <div class="tile">
          <div class="tile-art" style="background:linear-gradient(135deg,#ff2d6b,#ffd87a)"></div>
          <div class="tile-meta">
            <div class="tile-title">Glass Rituals</div>
            <div class="tile-sub">Vera K.</div>
            <span class="badge">Live</span>
          </div>
        </div>
      </article>
      <article class="window">
        <div class="tile">
          <div class="tile-art" style="background:linear-gradient(135deg,#00e5ff,#0077ff)"></div>
          <div class="tile-meta">
            <div class="tile-title">Concrete Lullaby</div>
            <div class="tile-sub">Brutalist Choir</div>
            <span class="badge">Trending</span>
          </div>
        </div>
      </article>
      <article class="window">
        <div class="tile">
          <div class="tile-art" style="background:linear-gradient(135deg,#9bff5e,#2ed573)"></div>
          <div class="tile-meta">
            <div class="tile-title">Green Room Echoes</div>
            <div class="tile-sub">Staff Ensemble</div>
            <span class="badge">Exclusive</span>
          </div>
        </div>
      </article>
    </section>
<section id="billboard" class="billboard-row">
  <!-- Articles will be injected here -->
</section>

    <!-- Second windows row: chamber directory -->
    <section class="windows windows-dir" aria-label="Chamber directory">
      <article class="dir-card">
        <h3>üèõ Commerce</h3>
        <p>Purchased items, token logic, payment rails.</p>
        <a class="open" href="#commerce">Open chamber</a>
      </article>
      <article class="dir-card">
        <h3>‚öîÔ∏è Gamified</h3>
        <p>Quest rewards, symbolic tokens.</p>
        <a class="open" href="#gamified">Open chamber</a>
      </article>
      <article class="dir-card">
        <h3>ü§ù Community</h3>
        <p>Pooled contributions, generosity artifacts.</p>
        <a class="open" href="#community">Open chamber</a>
      </article>
      <article class="dir-card">
        <h3>‚úùÔ∏è Faith</h3>
        <p>Spiritual-only, prayer submission.</p>
        <a class="open" href="#faith">Open chamber</a>
      </article>
    </section>

    <!-- Chambers -->
    <section id="commerce" class="chamber frost">
      
      <div class="chamber-grid">
        <div class="info-panel">
          <div id="imgVoid" class="info-img frost-container">
  <!-- Frost overlay: visible until unlocked -->
  <div class="frost-overlay"></div>

  <!-- 3D Crystal Ring -->
  <div class="object-3d" aria-label="Crystal Ring">
    <div class="inner-rim"></div>

    <div class="ring-stack">
      <!-- Layer 1 (front) -->
      <svg viewBox="0 0 200 200" class="ring-layer layer-front" aria-hidden="true">
        <defs>
          <linearGradient id="gradFront" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#bdf2ff"/>
            <stop offset="35%"  stop-color="#9fe3ff"/>
            <stop offset="65%"  stop-color="#c8f7ff"/>
            <stop offset="100%" stop-color="#8bd7ff"/>
          </linearGradient>
          <radialGradient id="shineFront" cx="30%" cy="30%" r="70%">
            <stop offset="0%"   stop-color="rgba(255,255,255,0.9)"/>
            <stop offset="60%"  stop-color="rgba(255,255,255,0.15)"/>
            <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
          </radialGradient>
        </defs>
        <!-- ring via stroke width -->
        <circle cx="100" cy="100" r="60" stroke="url(#gradFront)" stroke-width="28" fill="none" stroke-linecap="round"/>
        <!-- soft shine overlay -->
        <circle cx="100" cy="100" r="62" fill="url(#shineFront)"/>
      </svg>

      <!-- Layer 2 (mid) -->
      <svg viewBox="0 0 200 200" class="ring-layer layer-mid" aria-hidden="true">
        <defs>
          <linearGradient id="gradMid" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#a4e9ff"/>
            <stop offset="35%"  stop-color="#c6f7ff"/>
            <stop offset="65%"  stop-color="#90ddff"/>
            <stop offset="100%" stop-color="#d6fbff"/>
          </linearGradient>
        </defs>
        <circle cx="100" cy="100" r="60" stroke="url(#gradMid)" stroke-width="26" fill="none" stroke-linecap="round" opacity="0.7"/>
      </svg>

      <!-- Layer 3 (back) -->
      <svg viewBox="0 0 200 200" class="ring-layer layer-back" aria-hidden="true">
        <defs>
          <linearGradient id="gradBack" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#7ccfff"/>
            <stop offset="50%"  stop-color="#aee8ff"/>
            <stop offset="100%" stop-color="#6dc6ff"/>
          </linearGradient>
        </defs>
        <circle cx="100" cy="100" r="60" stroke="url(#gradBack)" stroke-width="24" fill="none" stroke-linecap="round" opacity="0.55"/>
      </svg>

      <!-- Facets: subtle crystalline segments -->
      <div class="facets">
        <span class="facet f1"></span>
        <span class="facet f2"></span>
        <span class="facet f3"></span>
        <span class="facet f4"></span>
        <span class="facet f5"></span>
      </div>
    </div>
  </div>
<div class="side-facets">
  <span class="side s1"></span>
  <span class="side s2"></span>
  <span class="side s3"></span>
  <span class="side s4"></span>
</div>

  <!-- Status -->
  <div class="object-status pending">Pending ~ Awaiting Prestige verification</div>
</div>

          <h4>üèõ Commerce Chamber</h4>
          <p>Pending credits shimmer silver until a Prestige member finalizes them to gold.</p>
          <p>Cart lists all available purchases, including token-related offerings.</p>
                  
        </div>
        <div class="chamber-grid">
        <div class="store-panel">
          <h4>Store</h4><div class="status pending">Pending verification</div><br>
          <div class="product-grid">
           <div class="product-card" onclick="addToCart('Crystal Ring', 20, 50, 'hybrid')">
  <div class="product-icon ring-crest"></div>
  <div class="product-meta">
    <div class="product-title">Crystal Ring</div>
    <div class="product-cost">üí∞ 20 purchased tokens</div>
    <div class="product-cost">‚ô¶Ô∏è 50 symbolic crystals</div>
    <div class="product-status pending">Pending Verification</div>
  </div>
  <div class="product-action">Click to add to cart</div>
</div>




              
            </div><br>
          
        <div class="chamber-grid">
            <div class="product-card" onclick="addToCart('Silver Necklace', 20)">
              <div class="product-title">Silver Necklace</div>
              <div class="price">üí∞ 30 purchased tokens</div><div class="status pending">Click to add to cart</div>
              
            </div>
            <div class="chamber-grid">
            <div class="product-card" onclick="addToCart('Braided Bracelet', 20)">
              <div class="product-title">Braided Bracelet</div>
              <div class="price">üí∞ 15 purchased tokens</div><div class="status pending">Click to add to cart</div>
              
            </div>
             <div class="chamber-grid"> 
           <div class="product-card" onclick="addToCart('Crest Charm', 20)">
              <div class="product-title">Crest Charm</div>
         <div class="price">üí∞ 10 purchased tokens</div>
              <div class="status pending">Click to add to cart</div>
              
            </div>
          </div>

 
</section>

    <section id="gamified" class="chamber frost">
  
      <div class="chamber-grid">
        <div class="info-panel">
          <div class="info-img" aria-hidden="true"></div>
          <h4>‚öîÔ∏è Gamified Chamber</h4>
          <p>Symbolic tokens are earned through quests and community actions (distinct from purchased tokens).</p>
        </div>
        <div class="store-panel">
          <h4>Rewards</h4>
          <div class="product-grid">
            <div class="product-card" onclick="addToCart('Quest Badge', 20, 5, 'hybrid')">
  <div class="product-icon Quest-Badge"></div>
  <div class="product-meta">
    <div class="product-title">Quest Badge</div>
    <div class="product-cost">üí∞ 20 purchased tokens</div>
    <div class="product-cost">‚ô¶Ô∏è 5 symbolic crystals</div>
    <div class="product-status pending">Pending Verification</div>
  </div>
  <div class="product-action">Click to add to cart</div>
</div>
            <div class="product-card">
              <div class="product-title">Mini‚Äëgame Medal</div>
              <div class="price">Cost: 8 symbolic tokens</div>
               <div class="price">Earns: 3 symbolic</div>
              <div class="status pending">Pending verification</div>
            </div>
            <div class="product-card">
              <div class="product-title">Challenge Scroll</div>
              <div class="price">Cost: 10 symbolic tokens</div>
              <div class="status pending">Pending verification</div>
            </div>
            <div class="product-card" data-task-id="habit-drink-water" data-type="habit" data-symbolic-reward="3" data-token-reward="1" data-habit-cooldown-ms="43200000">
  <div class="product-title">Drink Water</div>
  <div class="product-desc">Drink 8oz of water</div>
  <div class="price">Earns: 3 symbolic</div>
  <div class="status pending">Pending verification</div>
</div>


<div class="product-card" data-task-id="task-declutter" data-type="task" data-token-reward="8">
  <div class="product-title">Declutter Desk</div>
</div>

<div class="product-card" data-task-id="job-volunteer" data-type="job" data-token-reward="0">
  <div class="product-title">Volunteer Role</div>
</div>


          </div>
        </div>
      </div>
    </section>

    <section id="community" class="chamber frost">
     
      <div class="chamber-grid">
        <div class="info-panel">
          <div class="info-img" aria-hidden="true"></div>
          <h4>ü§ù Community Chamber</h4>
          <p>Pooled contributions and generosity artifacts are honored with symbolic tokens.</p>
          <ul style="margin:8px 0">
            <li>Volunteer hours (+6 symbolic)</li>
            <li>Smoke‚Äëfree challenge (+6 symbolic)</li>
            <li>Help a neighbor (+6 symbolic)</li>
            <li>Pooled contribution (+2 symbolic)</li>
          </ul>
        </div>
        <div class="store-panel">
          <h4>Artifacts</h4>
          <div class="product-grid">
            <div class="product-card">
              <div class="product-title">Community Crest</div>
              <div class="price">Cost: 6 symbolic tokens</div>
              <div class="status pending">Pending verification</div>
            </div>
            <div class="product-card">
              <div class="product-title">Generosity Ribbon</div>
              <div class="price">Cost: 7 symbolic tokens</div>
              <div class="status pending">Pending verification</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="faith" class="chamber frost">
      
      <div class="chamber-grid">
        <div class="info-panel">
          <div class="info-img" aria-hidden="true"></div>
          <h4>‚úùÔ∏è Faith Chamber</h4>
          <p>Spiritual‚Äëonly; submit prayer requests‚Äîno tokens are used here.</p>
          <div class="verse">Be kind to one another tenderhearted ‚Äî Ephesians 4:32</div>
        </div>
        <div class="store-panel">
          <h4>Prayer submission</h4>
          <input type="text" id="prayerInput" placeholder="Type your prayer here‚Ä¶" />
          <div class="controls" style="margin-top:8px">
            <button class="btn" id="submitPrayer">Submit prayer</button>
          </div>
          <div id="prayerLog" class="feed" style="margin-top:12px"></div>
        </div>
      </div>
    </section>

      
      
          
<!-- Cart Chamber -->
<section id="checkoutPanel" class="chamber frost" >
  <button class="checkout-btn">Checkout</button>
  <div class="chamber-grid">
    
    <!-- LEFT: Receipt viewer -->
    <div class="info-panel">
      <div class="info-img void" id="receiptViewer" aria-hidden="true"></div>
      <h4>üßæ Receipt Viewer</h4>
      <p>Finalized purchases glow gold. Pending shimmer silver until ledger confirmation.</p>
      <div id="receiptTotal">Total: 0 ü™ô + 0 ‚ô¶ </div>
      </div>
    
    

    <!-- RIGHT: Cart list -->
    <div class="store-panel">
      <h4>Cart & Checkout</h4>
      <div id="cartList" class="cart-list"></div>
      <button class="btn ghost-btn" onclick="emptyCart()">Empty Cart</button>
<br><br>
      <button class="btn finalize-btn" onclick="finalizeCart()">Finalize Purchases</button>
      <br><br>
    <button id="handoffBtn" class="btn">Send to Ledger</button><br></div>
 <!-- Payment rails and ritual flow -->
         <div class="checkout">
  
            
  <!-- HTML hooks (keep these where you already placed them) -->
<div class="prestige-slot-final" data-for-cod="true" id="prestigeSlotFinal">
  <div class="prestige-buzzer-wrap">
    <button class="prestige-buzzer center-over-tap" id="prestigeBuzzer" aria-label="Hail Prestige" title="Hail Prestige" style="--x:76px; --y:-10px">üîî</button>
    <div class="prestige-buzzer-label-final">Need help? Tap the buzzer</div>
  </div>

  <div class="prestige-widget-final prestige-hidden" id="prestigeWidgetFinal">
    <div style="font-weight:800">Hail Prestige ‚Äî Prefilled</div>
    <div class="row" style="margin-top:6px">
      <input id="pfName" class="input" placeholder="Your name (optional)" />
    </div>
    <div class="row">
      <input id="pfPhone" class="input" placeholder="Phone (optional)" />
    </div>
    <div>
      <input id="pfIssue" class="input" placeholder="Short issue description (optional)" />
    </div>
    <div class="prestige-small">You will confirm creation of a one‚Äëtime Jitsi room; Prestige members may take 15‚Äì30 minutes to respond.</div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="pfSendSms" class="send prestige-send">SMS</button>
      <button id="pfSendEmail" class="send prestige-send ghost">Email</button>
    </div>
  </div>
</div>

<!-- Hidden staff reply and modal/confirm (kept once in DOM) -->
<textarea id="prestigeHiddenStaffReply" style="display:none"></textarea>

<div class="prestige-modal" id="prestigeModal" aria-hidden="true">
  <div class="prestige-modal-header">
  <span class="prestige-crest" aria-hidden="true">
    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
      <circle cx="12" cy="12" r="11" fill="#ffd87a"/>
      <path d="M12 6l2.6 3.8L18 11l-3 2.2L15.6 18 12 15.6 8.4 18 9 13.2 6 11l3.4-1.2L12 6z" fill="#0b2a3a"/>
    </svg>
  </span>
  <div class="prestige-modal-title">PREFILLED SMS TEXT</div>
</div>

  <textarea id="prestigeSmsText" readonly></textarea>
  <div class="prestige-actions">
    <button id="copySms" class="prestige-btn ghost">Copy SMS</button>
    <button id="modalSendEmail" class="prestige-btn primary">Send Email</button>
    <button id="closeModal" class="prestige-btn ghost">Close</button>
  </div>
</div>

<div class="prestige-confirm" id="prestigeConfirm" style="display:none" aria-hidden="true">
  <div style="font-weight:800;margin-bottom:8px">Create one‚Äëtime Jitsi room?</div>
  <div class="prestige-small" style="margin-bottom:12px">This will create a one‚Äëtime Jitsi room and notify Prestige members by phone/email. Proceed?</div>
  <div style="display:flex;gap:8px;justify-content:flex-end">
    <button id="confirmCancel" class="prestige-btn ghost">Cancel</button>
    <button id="confirmProceed" class="prestige-btn primary">Proceed</button>
  </div>
</div>
           
           
</div>
    <br>
    <div class="rail">
    <div class="emblem-sigil prestige-pay"></div>
    <strong>Prestige Pay</strong>
    <p>Friendly flow. Finalization confirmed by ledger glow. Requires ceremonial desk approval.</p>
  </div>
   
  <div class="rail">
    <div class="emblem-sigil cod"></div>
    <strong>Cash on Delivery</strong>
    <p>Verified post-receipt. Status shimmer appears after member confirmation.</p>
  </div>
    <br>
  <div class="rail">
    <div class="emblem-sigil money-order"></div>
    <strong>Money Order</strong>
    <p>Accepted with pacing. Ledger updates once received and verified.</p>
  </div>
  <div class="rail">
    <div class="emblem-sigil chckout-cart"></div>
    <strong>Checkout Cart</strong>
    <p>View all pending purchases. Shimmer silver until finalized by Prestige member.</p>
  </div>
  </div>
</section>
      
     
    
          
          
    <form id="loveform" style="display:none" method="POST" target="hidden_iframe" action="">
  <textarea id="loveform_items_list" name="items_list"></textarea>
  <textarea id="loveform_receipt_text" name="receipt_text"></textarea>
  <input type="hidden" id="loveform_items_json" name="items_json" value="" />
  <input type="hidden" id="loveform_username" name="username" value="" />
  <input type="hidden" id="loveform_email" name="email" value="" />
  <input type="hidden" id="loveform_accessCode" name="accessCode" value="" />
</form>

<iframe name="hidden_iframe" style="display:none" aria-hidden="true"></iframe>


      
      
      
    <!-- Live feed + reflection + community ad -->
    <section class="lower">
      <div class="panel-lite">
        <h4 style="margin:6px 0 10px">Live updates</h4>
        <div id="liveFeed" class="feed">
          <div class="feed-item">üõç Crystal Ring purchase requested (Commerce) ‚Äî pending shimmer</div>
          <div class="feed-item">‚öîÔ∏è Quest completed: Submit grades (+5 symbolic)</div>
          <div class="feed-item">‚úùÔ∏è Prayer submitted: ‚ÄúGuide me in patience.‚Äù</div>
        </div>
      </div>
      <div class="panel-lite">
        <h4 style="margin:6px 0 10px">Reflection</h4>
        <div id="reflectionBox" class="ad">What effort today felt honest and steady?</div>
        <h4 style="margin:14px 0 10px">Community ad</h4>
        <div id="communityAd" class="ad">Neighbors Helping Neighbors ‚Äî pledge board rotates every 6 hours.</div>
      </div>
    </section>

      
      
  
      
      
      
      
    <!-- Directory back controls -->
    <section class="controls" style="margin-top:16px">
      <a class="btn" href="#">Back to top</a>
      <button class="btn" onclick="showChamber('')">Reset chambers</button>
    </section>

      
    <!-- Cart button already in token-box -->



      
      
  </div>

 
      
<nav class="mobile-nav">
  <button onclick="showPanel('commerce')">Commerce</button>
  <button onclick="showPanel('gamified')">Gamified</button>
  <button onclick="showPanel('community')">Community</button>
  <button onclick="showPanel('faith')">Faith</button>
</nav>


<div id="userCard"></div>
<div id="ledger"></div>
<div id="purchaseHistory"></div>


   
      
  <script>
    // Static reveal via class toggling (.active). Anchors also work.
    function showChamber(id){
      const ids = ['commerce','gamified','community','faith','checkoutPanel'];
      ids.forEach(x => {
        const el = document.getElementById(x);
        if(!el) return;
        if (id === x) { el.classList.add('active'); location.hash = '#' + id; }
        else { el.classList.remove('active'); }
      });
      if (!id) { history.pushState('', document.title, window.location.pathname + window.location.search); }
    }

    // Verse rotation every 30s (placeholder-ready for live JSON)
    const verses = [
  "Let all that you do be done in love ~ 1 Corinthians 16:14",
  "Be kind to one another ~ tenderhearted ~ Ephesians 4:32",
  "Walk by faith not by sight ~ 2 Corinthians 5:7",
  "The Lord is my shepherd I shall not want ~ Psalm 23:1",
  "I can do all things through Christ who strengthens me ~ Philippians 4:13",
  "Trust in the Lord with all your heart ~ Proverbs 3:5",
  "Do not be anxious about anything ~ Philippians 4:6",
  "Love your neighbor as yourself ~ Matthew 22:39",
  "Rejoice always ~ pray without ceasing ~ 1 Thessalonians 5:16-17",
  "The joy of the Lord is your strength ~ Nehemiah 8:10",
  "Create in me a clean heart ~ Psalm 51:10",
  "Blessed are the peacemakers ~ Matthew 5:9",
  "Your word is a lamp to my feet ~ Psalm 119:105",
  "He has made everything beautiful in its time ~ Ecclesiastes 3:11",
  "Be still and know that I am God ~ Psalm 46:10",
  "Let your light shine before others ~ Matthew 5:16",
  "Cast all your cares on Him ~ 1 Peter 5:7",
  "The Lord is my strength and my shield ~ Psalm 28:7",
  "In everything give thanks ~ 1 Thessalonians 5:18",
  "The steadfast love of the Lord never ceases ~ Lamentations 3:22"
];
    let v = 0;
    setInterval(() => {
      v = (v + 1) % verses.length;
      const box = document.getElementById('dailyVerse');
      if (box) box.textContent = verses[v];
    }, 30000);

    // Reflection rotation every 45s
    const reflections = [
  "Where can you slow down and show care?",
  "Does this purchase align with your values right now?",
  "Would gifting this bring someone meaningful joy?",
  "What patience do you want to practice today?",
  "What effort today felt honest and steady? ~",
  "Who have you checked in on this week? ~",
  "Is there a small kindness you‚Äôve overlooked? ~",
  "What are you grateful for in this moment? ~",
  "What intention do you want to carry forward? ~",
  "Where did you feel most present today? ~",
  "What would generosity look like right now? ~",
  "Is there someone who needs your quiet support? ~",
  "What part of your day felt sacred? ~",
  "What are you resisting that might deserve grace? ~",
  "How can you honor your limits with kindness? ~",
  "What gesture could restore someone‚Äôs peace? ~",
  "Where did you notice beauty today? ~",
  "What truth are you ready to speak gently? ~",
  "What does integrity look like in this moment? ~",
  "How can you soften your pace without losing purpose? ~",
  "What would it mean to lead with compassion today? ~"
];

    setInterval(() => {
      const idx = Math.floor(Math.random() * reflections.length);
      const el = document.getElementById('reflectionBox');
      if (el) el.textContent = reflections[idx];
    }, 45000);

    // Community ad placeholder rotation every 6 hours
    const ads = [
  "Neighbors Helping Neighbors ~ pledge board updates at dusk.",
  "Community Crest Night ~ shared table, shared honor.",
  "Volunteer Circle ~ add your hour, lift someone‚Äôs week.",
  "Quiet Generosity ~ small acts, steady light.",
  "Token Harvest ~ every kindness counts toward the collective bloom.",
  "Prestige Pledge Hour ~ log your vow, light the chamber.",
  "Shared Lantern Walk ~ one step, one glow, one bond.",
  "Kindness Ledger ~ record your ripple, honor the wave.",
  "Crest Exchange ~ trade tokens for warmth and witness.",
  "Silent Sigil Drop ~ anonymous gifts, visible impact.",
  "Unity Scroll ~ sign your name, seal the moment.",
  "Generosity Pulse ~ chamber lights shift with each act.",
  "Echo Chamber ~ your kindness echoes through the grid.",
  "Prestige Pantry ~ contribute quietly, receive openly.",
  "Civic Bloom ~ every gesture grows the shared garden.",
  "Token Tribute ~ honor someone with symbolic light.",
  "Community Weave ~ threads of care form the tapestry.",
  "Midnight Offering ~ late pledges shimmer with extra grace.",
  "Shared Ember ~ one spark passed, many warmed.",
  "Crest Reflection ~ review your impact, renew your vow.",
  "Kindness Relay ~ pass the gesture, extend the glow.",
  "Prestige Beacon ~ top contributors light the chamber crest."
];

    setInterval(() => {
      const idx = Math.floor(Math.random() * ads.length);
      const el = document.getElementById('communityAd');
      if (el) el.textContent = ads[idx];
    }, 6 * 60 * 60 * 1000);

    // Prayer submission (front-end only; hook to Sheets JSON in production)
    document.getElementById('submitPrayer')?.addEventListener('click', () => {
      const input = document.getElementById('prayerInput');
      const log = document.getElementById('prayerLog');
      const text = (input?.value || '').trim();
      if (!text) return;
      const ts = new Date().toLocaleString();
      const item = document.createElement('div');
      item.className = 'feed-item';
      item.textContent = `üïä ${text} ‚Äî ${ts}`;
      log?.prepend(item);
      input.value = '';
      // In production: POST to Google Apps Script ‚Üí Sheet; live feed pulls JSON
    });

    // Token counters: JSON hooks (no local placeholders in prod)
    async function loadLedger(){
      // Replace with your Apps Script JSON endpoint(s)
      // Example: const url = 'https://script.google.com/macros/s/XXXX/exec';
      // const res = await fetch(url, {cache:'no-store'}); const data = await res.json();
      // document.getElementById('purchasedCount').textContent = data.purchased;
      // document.getElementById('symbolicCount').textContent = data.symbolic;
    }
    // Call on load (disabled until endpoints provided)
    // loadLedger();

    // Cart button ‚Üí opens Commerce chamber
    document.getElementById('cartBtn')?.addEventListener('click', () => showChamber('checkoutPanel'));

    // On anchor navigation, ensure class toggling matches :target
    window.addEventListener('hashchange', () => {
      const id = (location.hash || '').replace('#','');
      if (['commerce','gamified','community','faith','checkoutPanel'].includes(id)) showChamber(id);
    });

    // Initial hash activation if present
    (function initFromHash(){
      const id = (location.hash || '').replace('','');
      if (['commerce','gamified','community','faith','checkoutPanel'].includes(id)) showChamber(id);
    })();
    
    
   </script><script>

(function(){
  const feed = document.getElementById('liveFeed');
  const samples = [
    'üèõ Purchase finalized: Silver Necklace',
    '‚öîÔ∏è Quest completed: Birthday bonus (+5 symbolic)',
    'ü§ù Contribution added: Help a neighbor (+2 symbolic)',
    '‚úùÔ∏è Prayer submitted: ‚ÄúStrength for tomorrow.‚Äù'
  ];
  let s = 0;

  setInterval(()=>{
    const item = document.createElement('div');
    item.className = 'feed-item';

    // Generate timestamp
    const now = new Date();
    const ts = now.toLocaleString(); // e.g. "11/13/2025, 6:45:12 PM"

    item.innerHTML = `<span>${samples[s % samples.length]}</span><small>${ts}</small>`;
    feed.prepend(item); // keep feed tidy
    if(feed.children.length > 6) feed.lastElementChild.remove();

    // cycle sample index
    s++;
  }, 60000); // every 1 minute
})();
</script>

   
<script>
(function(){
  const billboard = document.getElementById('billboard');
  const entries = [
    {
      title: "Midnight Static",
      sub: "Nova & The Wires",
      badge: "NEW",
      image: "#1a1a1a"
    },
    {
      title: "Glass Rituals",
      sub: "V√©ra K.",
      badge: "LIVE",
      image: "#ff2d6b"
    },
    {
      title: "Concrete Lullaby",
      sub: "Brutalist Choir",
      badge: "TRENDING",
      image: "#0077ff"
    },
    {
      title: "Green Room Echoes",
      sub: "Staff Ensemble",
      badge: "EXCLUSIVE",
      image: "#2ed573"
    }
  ];
  let i = 0;

  setInterval(() => {
    const e = entries[i % entries.length];
    const article = document.createElement('article');
    article.className = 'billboard-article';
    article.innerHTML = `
      <div class="billboard-image" style="background:${e.image}"></div>
      <div class="billboard-title">${e.title}</div>
      <div class="billboard-sub">${e.sub}</div>
      <span class="badge">${e.badge}</span>
    `;
    billboard.prepend(article);
    if (billboard.children.length > 4) billboard.lastElementChild.remove();
    i++;
  }, 15000); // every 8 seconds
})();
</script>
<script>
function unlockItem(id, className, cost){
  const card = document.getElementById(id);
  if (!card) return;

  card.classList.remove('locked');
  card.classList.add('unlocked');

  const veil = card.querySelector('.frost-veil');
  if (veil) veil.style.display = 'none';

  const status = card.querySelector('.object-status');
  if (status){
    status.textContent = 'Unlocked ~ Awaiting member finalization';
    status.classList.remove('pending');
    status.classList.add('finalized');
  }

  card.setAttribute('onclick', `displayInViewer('${className}', '${card.querySelector('.object-title').textContent}')`);
}
function displayInViewer(className, title){
  const viewer = document.querySelector('#commerce .info-img');
  viewer.className = 'info-img ' + className;
  viewer.setAttribute('aria-label', title);
}
  
  
</script>



<script>
// --- Shared counters ---
let cartTokenTotal = 0, cartCrystalTotal = 0, cartItems = 0;

// --- Generic sheet fetcher ---
async function fetchSheet(gid, mapper){
  const url = `https://docs.google.com/spreadsheets/d/1eskbyxg5KOvTyOb68_Zdt5W1YeyfOuvBABqnMBN79xM/gviz/tq?tqx=out:json&gid=${gid}`;
  const res = await fetch(url);
  const text = await res.text();
  const json = JSON.parse(text.substring(47).slice(0, -2));
  const rows = json.table.rows || [];
  return rows.map(mapper);
}

// --- Specific sheet helpers ---
async function fetchUserDirectory(){
  return fetchSheet(0, r => ({
    user:        r.c[0]?.v ?? "",
    accessCode:  r.c[1]?.v ?? "",
    card:        r.c[2]?.v ?? "",
    purchased:   r.c[3]?.v ?? "0",
    symbolic:    r.c[4]?.v ?? "0",
    status:      r.c[5]?.v ?? "Pending"
  }));
}

async function fetchPurchaseHistory(){
  return fetchSheet(238239380, r => ({
    user:        r.c[0]?.v ?? "",   // Column A
    transaction: r.c[1]?.v ?? "",   // Column B
    status:      r.c[2]?.v ?? "Pending", // Column C
    verifiedBy:  r.c[3]?.v ?? "",   // Column D
    date:        r.c[4]?.v ?? "",   // Column E
    notes:       r.c[5]?.v ?? ""    // Column F
  }));
}

async function fetchFinalizedLedger(){
  return fetchSheet(1547074840, r => ({
    user:          r.c[0]?.v ?? "",
    transaction:   r.c[1]?.v ?? "",
    verifiedBy:    r.c[2]?.v ?? "",
    status:        r.c[3]?.v ?? "Pending",
    finalizeCode:  r.c[4]?.v ?? "",
    finalizeExpiry:r.c[5]?.v ?? "",
    purchased:     r.c[6]?.v ?? "0",
    symbolic:      r.c[7]?.v ?? "0"
  }));
}

// --- Cart functions ---
function addToCart(name, tokenCost, crystalCost, type){
  const cart = document.getElementById('cartList');
  const item = document.createElement('div');
  item.className = 'cart-item shimmer';

  // Attach lookup keys for ledger matching
  const user = sessionStorage.getItem("username") || "Guest";
  item.setAttribute('data-user', user);
  item.setAttribute('data-transaction', name);

  item.innerHTML = `
    <div class="cart-title">${name}</div>
    ${type !== 'crystal' ? `<div class="cost-row token"><span class="cost-value">${tokenCost}</span> ü™ô purchased tokens</div>` : ''}
    ${type !== 'token' ? `<div class="cost-row crystal"><span class="cost-value">${crystalCost}</span> ‚ô¶Ô∏è symbolic crystals</div>` : ''}
    <div class="cart-status">Pending ‚Ä¢ Awaiting Prestige verification</div>
  `;
  cart.appendChild(item);

  if (type !== 'crystal') cartTokenTotal += tokenCost;
  if (type !== 'token') cartCrystalTotal += crystalCost;

  cartItems += 1;
  updateCartDisplay();
}

function updateCartDisplay(){
  const badge = document.getElementById('cartCount');
  const floatBadge = document.getElementById('floatingCartCount');
  const total = document.getElementById('receiptTotal');

  if (badge) badge.textContent = cartItems;
  if (floatBadge) floatBadge.textContent = cartItems;
  if (total) total.textContent = `Total: ${cartTokenTotal} ü™ô + ${cartCrystalTotal} ‚ô¶Ô∏è`;
}

function finalizeCart(){
  const viewer = document.getElementById('receiptViewer');
  if (viewer) {
    viewer.className = 'info-img shimmer';
    viewer.innerHTML = `<div class="receipt-confirm">üßæ Submitted ‚Ä¢ ${cartTokenTotal} ü™ô + ${cartCrystalTotal} ‚ô¶Ô∏è<br>Awaiting Prestige verification</div>`;
  }

  (document.getElementById('confirmFinalizeBtn')
   || document.querySelector('.finalize-btn')
   || document.querySelector('[data-finalize-btn]')
   || document.querySelector('button.finalize-btn'))
  ?.addEventListener('click', ()=>window.promptAndConsumeAccessCode());

  document.querySelectorAll('.cart-item').forEach(item => {
    item.classList.add('shimmer');
    item.classList.remove('finalized');
    const s = item.querySelector('.cart-status');
    if (s) s.textContent = 'Pending ~ Awaiting Prestige verification';
  });

  // Reset counters AFTER snapshot
  cartTokenTotal = 0;
  cartCrystalTotal = 0;
  cartItems = 0;
  updateCartDisplay();

  // Sync with ledger
  updateCartFromLedger();
}

function emptyCart(){
  const cart = document.getElementById('cartList');
  if (cart) cart.innerHTML = '';
  cartTokenTotal = 0;
  cartCrystalTotal = 0;
  cartItems = 0;
  updateCartDisplay();

  const viewer = document.getElementById('receiptViewer');
  if (viewer){
    viewer.className = 'info-img void';
    viewer.innerHTML = '';
  }

  const total = document.getElementById('receiptTotal');
  if (total) total.textContent = `Total: 0 ü™ô + 0 ‚ô¶Ô∏è`;
}

// --- Shimmer sync against ledger ---
async function updateCartFromLedger(){
  const ledger = await fetchFinalizedLedger();

  document.querySelectorAll('.cart-item').forEach(item => {
    const user = item.getAttribute('data-user');
    const transaction = item.getAttribute('data-transaction');

    const match = ledger.find(l =>
      String(l.user).trim() === String(user).trim() &&
      String(l.transaction).trim() === String(transaction).trim()
    );

    if (match && String(match.status).toLowerCase() === "finalized") {
      item.classList.remove('shimmer','pending','glow-silver');
      item.classList.add('finalized','glow-gold');
      const s = item.querySelector('.cart-status');
      if (s) s.textContent = ` Finalized by ${match.verifiedBy || "Prestige Member"}`;
    } else {
      item.classList.remove('glow-gold');
      item.classList.add('shimmer','glow-silver');
      const s = item.querySelector('.cart-status');
      if (s) s.textContent = 'Pending ~ Awaiting Prestige verification';
    }
  });
}

</script>
<script>
// --- Utility: parse Google Sheets GViz JSON ---
async function loadSheet(sheetName){
  const url = `https://docs.google.com/spreadsheets/d/1Gppnlp80FqgOzeUERsSmLp5pZ4E9tvhfbt22NKtUbk8/gviz/tq?sheet=${sheetName}&tqx=out:json`;
  const res = await fetch(url);
  const text = await res.text();
  const json = JSON.parse(text.substr(47).slice(0, -2));
  return json.table.rows.map(r => r.c.map(c => c ? c.v : ""));
}

// --- COMMUNITY drip feed ---
let communityRows = [], communityIndex = 0;
async function initCommunityFeed(){
  communityRows = await loadSheet("Community");
  communityIndex = 0;
  revealNextCommunity();
  setInterval(revealNextCommunity, 60000); // one every 60s
}
function revealNextCommunity(){
  if (communityIndex >= communityRows.length) return;
  const r = communityRows[communityIndex];
  const box = document.getElementById("liveFeed");
  if (!box) return;
  const el = document.createElement("div");
  el.className = "feed-item fadeSlide"; // fade-in refinement
  el.textContent = `ü§ù ${r[0]}  ${r[1]} ${r[2] ? "(" + r[2] + ")" : ""}`;
  box.prepend(el);
  // keep last 6 visible
  while (box.children.length > 6) box.removeChild(box.lastChild);
  communityIndex++;
}

// --- ADS drip feed ---
let adsRows = [], adsIndex = 0;
async function initAdsFeed(){
  adsRows = await loadSheet("Ads");
  adsIndex = 0;
  revealNextAd();
  setInterval(revealNextAd, 45000); // one every 45s
}
function revealNextAd(){
  if (adsRows.length === 0) return;
  const r = adsRows[adsIndex % adsRows.length]; // loop refinement
  const board = document.getElementById("billboard");
  if (!board) return;
  const article = document.createElement("article");
  article.className = "billboard-article fadeSlide";
  article.innerHTML = `
    <div class="billboard-image"></div>
    <div class="billboard-title">${r[0]}</div>
    <div class="billboard-sub">${r[1]} ${r[2] ? "(" + r[2] + ")" : ""}</div>
    <span class="badge">AD</span>
  `;
  board.prepend(article);
  while (board.children.length > 4) board.removeChild(board.lastChild);
  adsIndex++;
}

// --- FAITH drip feed ---
let faithRows = [], faithIndex = 0;

async function initFaithFeed(){
  faithRows = await loadSheet("Faith");
  faithIndex = 0;
  revealNextFaith();
  setInterval(revealNextFaith, 45000); // one every 45s
}

function revealNextFaith(){
  if (faithRows.length === 0) return;
  const r = faithRows[faithIndex % faithRows.length];
  const log = document.getElementById("prayerLog");
  if (!log) return;

  const el = document.createElement("div");
  el.className = "feed-item fadeSlide";

  // richer markup with badge
  el.innerHTML = `
    <div class="faith-title">üïä ${r[0]}</div>
    <div class="faith-message">${r[1]} ${r[2] ? "(" + r[2] + ")" : ""}</div>
    <span class="badge">FAITH</span>
  `;

  log.prepend(el);

  // keep only last 6 prayers visible
  while (log.children.length > 6) {
    log.removeChild(log.lastChild);
  }

  faithIndex++;
}

  
  
  
  
  
  
  // --- Master controller ---
async function renderController(action, options = {}){
  switch(action){
    case "login":
      await renderUserCard();
      if (options.userName) {
        await renderPurchaseHistory(options.userName);
      }
      break;
    case "logout":
      await renderLedger();
      break;
    case "finalize":
      await renderLedger();
      if (options.userName) {
        await renderPurchaseHistory(options.userName);
      }
      break;
    case "viewHistory":
      if (options.userName) {
        await renderPurchaseHistory(options.userName);
      }
      break;
    case "refreshAll":
      await Promise.all([
        renderUserCard(),
        renderLedger(),
        options.userName ? renderPurchaseHistory(options.userName) : Promise.resolve()
      ]);
      break;
    default:
      console.warn("Unknown render action:", action);
  }
}

// --- Initialize all feeds ---
document.addEventListener("DOMContentLoaded", () => {
  initCommunityFeed();
  initAdsFeed();
  initFaithFeed();
});
</script>
<script>
// Attach hover preview + cart logic to all product cards
document.addEventListener("DOMContentLoaded", () => {
  const info = document.getElementById("infoImg"); // the void preview panel
  const cartCountEl = document.getElementById("cartCount");
  const cartLog = document.getElementById("cartLog");

  let cartCount = 0;

  document.querySelectorAll(".product-card").forEach(card => {
    const titleEl = card.querySelector(".product-title");
    const title = titleEl ? titleEl.textContent : "Item";

    // Hover preview
    card.addEventListener("mouseenter", () => {
      if (info){
        info.style.backgroundImage = "url('/assets/" + title.toLowerCase().replace(/\s+/g,'-') + ".png')";
        info.style.backgroundSize = "cover";
        info.style.backgroundPosition = "center";
        info.classList.add("glow");
      }
    });
    card.addEventListener("mouseleave", () => {
      if (info){
        info.style.backgroundImage = "";
        info.classList.remove("glow");
      }
    });

    
  
  
</script>
<div id="floatingCart" class="floating-cart frost">
  üõí <span id="floatingCartCount">0</span> items
  <button class="ghost-btn" onclick="showChamber('checkoutPanel')">Checkout</button>
</div>
</script><script>
function getCurrentCartItems(){
  return Array.from(document.querySelectorAll('.cart-item')).map(el => {
    return {
      name: el.querySelector('.cart-name')?.textContent || "Unknown",
      tokenCost: Number(el.querySelector('.cart-tokens')?.textContent || 0),
      crystalCost: Number(el.querySelector('.cart-crystals')?.textContent || 0),
      finalized: el.classList.contains('finalized'),
      verifiedBy: el.getAttribute('data-verified-by') || null
    };
  });
}



// --- Cart sync helper ---
function syncCartFromUser(u, opts = { resetCartCountOnLogin: false }){
  if(!u) return;
  sessionStorage.setItem('activeAccountId', u.accessCode || u.card || u.user);
  window.currentUserId = sessionStorage.getItem('activeAccountId');

  
  const purchasedEl = document.getElementById('purchasedCount');
  const symbolicEl  = document.getElementById('symbolicCount');
  if(purchasedEl) purchasedEl.textContent = Number(u.purchased || 0);
  if(symbolicEl)  symbolicEl.textContent  = Number(u.symbolic || 0);

  document.querySelectorAll('.floating-cart, .checkout-cart').forEach(container => {
    let row = container.querySelector('.cart-balance-row');
    if(!row){
      row = document.createElement('div');
      row.className = 'cart-balance-row';
      row.style.marginTop = '6px';
      row.style.fontSize = '0.95rem';
      row.style.color = 'var(--muted)';
      row.style.display = 'flex';
      row.style.gap = '10px';
      container.appendChild(row);
    }
    row.innerHTML = `<div><strong>Purchased</strong>: <span class="cart-bal-tokens">${Number(u.purchased||0)}</span></div>
                     <div><strong>Symbolic</strong>: <span class="cart-bal-symbolic">${Number(u.symbolic||0)}</span></div>`;
  });

  if(opts.resetCartCountOnLogin){
    const cartCount = document.getElementById('cartCount');
    const floatBadge = document.getElementById('floatingCartCount');
    if(cartCount) cartCount.textContent = '0';
    if(floatBadge) floatBadge.textContent = '0';
  }
}

// --- Validate login ---
          
// --- Validate login ---
async function loginUser(e){
  e?.preventDefault?.();
  const username = document.getElementById("loginUser").value.trim();
  const code = document.getElementById("loginCode").value.trim();
  const statusEl = document.getElementById("loginStatus");

  statusEl.textContent = "‚Ä¶ Checking access code";
  statusEl.className = "status pending";

  const accounts = await fetchUserDirectory();   // <-- use User Directory
  const match = accounts.find(r => r.accessCode === code && r.user === username);

  if (match){
    sessionStorage.setItem("username", match.user);
    sessionStorage.setItem("accessCode", match.accessCode);

    statusEl.textContent = "Login successful";
    statusEl.className = "status finalized";

    document.getElementById("userDirectory")?.classList.add("active");
    document.getElementById("loginPanel")?.classList.remove("active");

    await renderUserCard();
    syncCartFromUser(match, { resetCartCountOnLogin: true });
  } else {
    statusEl.textContent = "‚úó INVALID USERNAME OR ACCESS CODE";
    statusEl.className = "status pending";
  }
}

// --- Lookup user by access code ---
async function getUserByAccessCode(code){
  const accounts = await fetchUserDirectory();   // <-- use User Directory
  return accounts.find(acc => String(acc.accessCode).trim() === String(code).trim()) || null;
}


// --- Render user card ---
async function renderUserCard(){
  const username = sessionStorage.getItem("username");
  const code = sessionStorage.getItem("accessCode");
  if (!username || !code) return;

  // Pull user basics from User Directory
  const accounts = await fetchUserDirectory();
  const u = accounts.find(acc => String(acc.accessCode).trim() === String(code).trim());
  if (!u) return;

  // Pull current finalized status from Finalized Ledger (truth source)
const ledger = await fetchFinalizedLedger();
const finalizedRow = ledger.find(row => String(row.user).trim() === String(u.user).trim());
const status = finalizedRow ? finalizedRow.status : "Pending";
const glowClass = String(status).toLowerCase() === "finalized" ? "glow-gold" : "glow-silver";

const grid = document.querySelector("#userDirectory .user-grid");
if (!grid) return;

grid.innerHTML = `
  <div class="user-card frost" data-user-id="${u.card || u.user}">
    <div class="crest-avatar"></div>
    <div class="user-meta">
      <div class="account-name">${u.user}</div>
      <div class="card-id">PrestigePayCard: ${u.card}</div>
      <div class="verified-by">
        Verified by: ${finalizedRow ? (finalizedRow.verifiedBy || "Prestige Member") : "‚Äî"}
      </div>
      <div class="token-balance">ü™ô ${u.purchased} | ‚ô¶Ô∏è ${u.symbolic}</div>
      <div class="status ${glowClass}"></div>
    </div>
  </div>
`;


  // Sync balances to cart UI from User Directory (not from ledger)
  syncCartFromUser(u, { resetCartCountOnLogin: false });

  // Render history from Purchase History
  renderPurchaseHistory(u.user);
}


// --- Render ledger ---
// --- Render ledger ---
async function renderLedger(){
  const ledger = await fetchFinalizedLedger();
  const grid = document.getElementById("ledgerGrid");
  if (!grid) return;

  // Detect if purchased/symbolic columns exist in the data
  const hasBalances = ledger.some(u => u.purchased !== undefined || u.symbolic !== undefined);

  grid.innerHTML = `
  <table class="prestige-sheet">
    <tr>
      <th>User</th>
      <th>Transaction</th>
      <th>Status</th>
      <th>Verified By</th>
      <th>Finalize Code</th>
      <th>Finalize Expiry</th>
      ${hasBalances ? `<th>Purchased ü™ô</th><th>Symbolic ‚ô¶Ô∏è</th>` : ""}
    </tr>
    ${ledger.map(l => {
      const ledgerStatus = String(l.status || "Pending").trim();
      const ledgerVerifiedBy = l.verifiedBy || "‚Äî";
      const glowClass = ledgerStatus.toLowerCase() === "finalized" ? "glow-gold" : "glow-silver";

      return `
        <tr>
          <td>${l.user}</td>
          <td>${l.transaction}</td>
          <td class="${glowClass}">${ledgerStatus}</td>
          <td>${ledgerVerifiedBy}</td>
          <td>${l.finalizeCode || ""}</td>
          <td>${l.finalizeExpiry || ""}</td>
          ${hasBalances ? `<td>${l.purchased || "0"}</td><td>${l.symbolic || "0"}</td>` : ""}
        </tr>`;
    }).join("")}
  </table>
`;

}




// --- Render purchase history ---
// --- Render purchase history ---
async function renderPurchaseHistory(userName){
  const history = await fetchPurchaseHistory();
  const ledger  = await fetchFinalizedLedger();

  const rows = history.filter(r => String(r.user).trim() === String(userName).trim());
  const box = document.getElementById("purchaseHistory");
  if(!box) return;

  box.innerHTML = `
    <h4>Purchase History</h4>
    <table class="prestige-sheet">
      <tr>
        <th>User</th>
        <th>Transaction</th>
        <th>Status</th>
        <th>Verified By</th>
        <th>Date</th>
        <th>Notes</th>
      </tr>
      ${rows.map(h => {
  // Scoped variables for Purchase History
  const historyStatus = String(h.status || "Pending").trim().toLowerCase();
  const historyVerifiedBy = h.verifiedBy || "‚Äî";
  const glowClass = historyStatus === "finalized" ? "history-gold" : "history-silver";

  return `
    <tr>
      <td>${h.user}</td>
      <td>${h.transaction}</td>
      <td class="${glowClass}">${historyStatus}</td>
      <td>${historyVerifiedBy}</td>
      <td>${h.date || ""}</td>
      <td>${h.notes || ""}</td>
    </tr>`;
}).join("")}

    </table>
  `;
}




// --- NEW: Finalize handler (continued) ---
async function consumeFinalizeCodeFromSheet(code){
  const ledger = await fetchFinalizedLedger();
  const history = await fetchPurchaseHistory();

  const match = ledger.find(r => String(r.finalizeCode || "").trim() === String(code).trim());
  if (!match) {
    setFinalizeStatus("‚úó FINALIZE CODE INVALID", "glow-silver");
    return false;
  }

  if (match.finalizeExpiry){
    const expiry = new Date(match.finalizeExpiry);
    if (Date.now() > expiry.getTime()){
      setFinalizeStatus("‚úó CODE EXPIRED", "glow-silver");
      return false;
    }
  }

  // üîé Check Purchase History tab for this user/transaction
  const historyMatch = history.find(h =>
    String(h.user).trim() === String(match.user).trim() &&
    String(h.transaction).trim() === String(match.transaction).trim()
  );

  const status = historyMatch ? historyMatch.status : "Pending";
  const normalized = String(status || "Pending").trim().toLowerCase();
  const glowClass = normalized === "finalized" ? "glow-gold" : "glow-silver";
  const verifiedBy = match.verifiedBy || "Prestige Member";

  setFinalizeStatus(` ${status} by ${verifiedBy}`, glowClass);

  // Refresh panels
  await renderUserCard();
  await renderPurchaseHistory(match.user);
  await renderLedger();

  // üîë Flip shimmer to gold only if Purchase History says Finalized
  if (normalized === "finalized") {
    document.querySelectorAll('.cart-item').forEach(el => {
      const codeAttr = el.getAttribute('data-finalize-code');
      if (String(codeAttr).trim() === String(match.finalizeCode).trim()) {
        el.classList.remove('pending','shimmer','glow-silver');
        el.classList.add('finalized','glow-gold');
        const statusEl = el.querySelector('.cart-status');
        if (statusEl) {
          statusEl.textContent = ` Finalized by ${verifiedBy}`;
        }
      }
    });
    console.info("Shimmer flipped to gold for finalized items (Purchase History confirmed).");
  }

  return true;
}


function setFinalizeStatus(text, cssClass){
  const el = document.getElementById("finalizeStatus");
  if (!el) return;
  el.textContent = text;
  el.className = `status ${cssClass}`;
}

// --- Wiring ---
document.addEventListener("DOMContentLoaded", () => {
  // Login
  ddocument.getElementById("loginBtn")?.addEventListener("click", async () => {
  const username = sessionStorage.getItem("username");
  if (username) {
    await renderController("login", { userName: username });
  }
});

  document.getElementById("loginCode")?.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginUser(e);
  });
  // Logout
  document.getElementById("logoutBtn")?.addEventListener("click", () => {
    sessionStorage.clear();
    document.getElementById("userDirectory")?.classList.remove("active");
    document.getElementById("loginPanel")?.classList.add("active");
    renderLedger();

    // Clear header/cart balances
    const purchasedEl = document.getElementById('purchasedCount');
    const symbolicEl  = document.getElementById('symbolicCount');
    if (purchasedEl) purchasedEl.textContent = '0';
    if (symbolicEl)  symbolicEl.textContent  = '0';
    const cartCount = document.getElementById('cartCount');
    const floatBadge = document.getElementById('floatingCartCount');
    if(cartCount) cartCount.textContent = '0';
    if(floatBadge) floatBadge.textContent = '0';
    document.querySelectorAll('.cart-balance-row').forEach(r => r.remove());
  });

  // Finalize
  document.getElementById("finalizeBtn")?.addEventListener("click", async () => {
    const entered = document.getElementById("finalizeCode")?.value.trim();
    if (!entered) return;
    await consumeFinalizeCodeFromSheet(entered);
  });
});

// --- On load: show ledger only ---
window.onload = () => {
  renderLedger();
  const loginPanel = document.getElementById("loginPanel");
  if (loginPanel) loginPanel.classList.add("active", "frost");

  // If session exists, sync cart from that user on page load
  const code = sessionStorage.getItem('accessCode');
  if (code) {
    getUserByAccessCode(code).then(u => { if(u) syncCartFromUser(u, { resetCartCountOnLogin: false }); });
  }
};

// --- Polling: refresh every 15s ---
setInterval(() => {
  renderLedger();
  renderUserCard();
}, 15000);

// Safety: ensure status element updates (defensive)
try {
  const status = document.getElementById('loginStatus');
  if (status) {
    status.classList.remove('pending');
    status.classList.add('finalized');
    status.textContent = ' Finalized in Prestige Ledger';
  }
} catch(e){ /* ignore if not present */ }
</script>


          



  <script>
document.getElementById("logoutBtn")?.addEventListener("click", () => {
  sessionStorage.clear();

  // Reset token counters
  const purchasedEl = document.getElementById("purchasedCount");
  const symbolicEl  = document.getElementById("symbolicCount");
  if (purchasedEl) purchasedEl.textContent = "0";
  if (symbolicEl)  symbolicEl.textContent  = "0";

  // Update status message
  const statusEl = document.getElementById("loginStatus");
  if (statusEl){
    statusEl.textContent = "Logout successful";
    statusEl.className = "status finalized";
  }

  document.getElementById("userDirectory")?.classList.remove("active");
  document.getElementById("loginPanel")?.classList.add("active");

  renderLedger();
});
document.addEventListener("DOMContentLoaded", () => {
  // Reveal access code input field
  document.getElementById("revealCodeBtn")?.addEventListener("click", () => {
    document.getElementById("accessCodeWrapper").style.display = "block";
    document.getElementById("revealCodeBtn").style.display = "none";
  });

  // Toggle visibility of access code characters
  document.getElementById("toggleCodeBtn")?.addEventListener("click", () => {
    const codeInput = document.getElementById("loginCode");
    const isMasked = codeInput.type === "password";
    codeInput.type = isMasked ? "text" : "password";
    document.getElementById("toggleCodeBtn").textContent = isMasked ? "üôà Hide" : "üëÅ Reveal";
  });

  // Login logic
  document.getElementById("loginBtn")?.addEventListener("click", loginUser);
  document.getElementById("loginCode")?.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginUser(e);
  });
});
// Unlock: remove frost (visual reveal), maintain pending state
function unlockFrostedObject(){
  const veil = document.querySelector('#imgVoid .frost-overlay');
  if (veil) veil.style.display = 'none';

  const status = document.querySelector('#imgVoid .object-status');
  if (status){
    status.textContent = 'Unlocked ~ Awaiting member finalization';
    status.classList.remove('finalized');
    status.classList.add('pending');
  }
}

// Apply finalized state only when sheet confirms
function applyFinalizedState(){
  const container = document.getElementById('imgVoid');
  const status = container?.querySelector('.object-status');
  if (container) container.classList.add('finalized');
  if (status){
    status.textContent = ' Finalized in Prestige Ledger';
    status.classList.remove('pending');
    status.classList.add('finalized');
  }
}

// Optional: parallax hover for live presence
(function attachParallax(){
  const container = document.getElementById('imgVoid');
  const stack = container?.querySelector('.ring-stack');
  if (!container || !stack) return;

  let hovering = false;
  const base = 'translate(-50%, -50%)';

  container.addEventListener('mousemove', (e) => {
    hovering = true;
    const r = container.getBoundingClientRect();
    const x = ((e.clientX - r.left) / r.width - 0.5) * 12;   // yaw
    const y = ((e.clientY - r.top) / r.height - 0.5) * -10;  // pitch
    stack.style.animation = 'none'; // pause float/spin on hover
    stack.style.transform = `${base} rotateX(${y}deg) rotateY(${x}deg)`;
  });

  container.addEventListener('mouseleave', () => {
    hovering = false;
    stack.style.transform = '';
    stack.style.animation = 'floatY 4.2s ease-in-out infinite, slowSpin 14s linear infinite';
  });
})();
function showPanel(panelId) {
  document.querySelectorAll('.chamber-panel').forEach(p => {
    p.classList.remove('active');
  });
  document.getElementById(panelId).classList.add('active');
}
document.querySelectorAll('.billboard').forEach((bb, i) => {
  bb.style.animationDelay = `${i * 0.2}s`; // stagger each billboard
});

</script>

<script>
/* Populate hidden username/email from directory card into #loveform fields */
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('loveform');
  if (!form) return;

  // Try common directory selectors; prefer data attributes if present
  const dirCard = document.querySelector('#userDirectory .user.active') || document.querySelector('#userDirectory .user') || document.querySelector('#userDirectory');
  let name = '', email = '';

  if (dirCard) {
    name = dirCard.getAttribute('data-username') || dirCard.querySelector('.account-name')?.textContent?.trim() || dirCard.querySelector('.user-name')?.textContent?.trim() || '';
    email = dirCard.getAttribute('data-email') || dirCard.querySelector('.account-email')?.textContent?.trim() || '';
  }

  // Fallbacks: sessionStorage or login input
  if (!name) name = sessionStorage.getItem('username') || document.getElementById('loginUser')?.value || '';
  if (!email) email = sessionStorage.getItem('userEmail') || '';

  // Write into hidden form fields
  const u = document.getElementById('loveform_username');
  const e = document.getElementById('loveform_email');
  if (u) u.value = name;
  if (e) e.value = email;
});
</script>

<script>

// Cart-scoped markItemsGold ‚Äî finalizes only items inside cart containers
(function(){
  if(window.__markItemsGoldCartScoped) return;
  window.__markItemsGoldCartScoped = true;

  // update this list to match your cart container(s)
  const CART_CONTAINERS = ['#checkoutPanel', '.checkout-cart', '.cart-list', '#cartPanel', '.floating-cart'];

  function _applyGoldToCartItem(el){
    if(!el || el.__goldAppliedCart) return;
    el.__goldAppliedCart = true;
    // only change classes/text inside the cart item
    el.classList.remove('pending','shimmer','status-pend');
    el.classList.add('finalized','gold');
    const status = el.querySelector('.status, .product-status, .badge');
    if(status) status.textContent = 'Verified';
    // counters inside card
    el.querySelectorAll('.counter, .price, .product-status').forEach(c=>{
      c.classList.remove('silver');
      c.classList.add('gold');
    });
    // visual tweak limited to this element
    try { el.style.boxShadow = el.style.boxShadow || '0 0 12px rgba(255,216,122,0.28)'; } catch(e){}
  }

  function markItemsGoldInCart(){
    const containers = CART_CONTAINERS.map(s => document.querySelector(s)).filter(Boolean);
    if(!containers.length) { console.info('markItemsGoldInCart: no cart containers found'); return false; }
    const nodes = new Set();
    containers.forEach(c => c.querySelectorAll('.cart-item, .cart-item.pending, .product-card').forEach(n => nodes.add(n)));
    if(!nodes.size) { console.info('markItemsGoldInCart: no cart items found'); return false; }
    nodes.forEach(_applyGoldToCartItem);
    console.info('markItemsGoldInCart: finalized', nodes.size, 'cart item(s).');
    return true;
  }

  // expose
  window.markItemsGoldInCart = markItemsGoldInCart;

  // auto-hook after verification (safe: only calls cart-scoped function)
  


</script><script>
/
// Cart-scoped markItemsGold ‚Äî finalizes only items inside cart containers
(function(){
  if(window.__markItemsGoldCartScoped) return;
  window.__markItemsGoldCartScoped = true;

  // update this list to match your cart container(s)
  const CART_CONTAINERS = ['#checkoutPanel', '.checkout-cart', '.cart-list', '#cartPanel', '.floating-cart'];

  function _applyGoldToCartItem(el){
    if(!el || el.__goldAppliedCart) return;
    el.__goldAppliedCart = true;
    // only change classes/text inside the cart item
    el.classList.remove('pending','shimmer','status-pend');
    el.classList.add('finalized','gold');
    const status = el.querySelector('.status, .product-status, .badge');
    if(status) status.textContent = 'Verified';
    // counters inside card
    el.querySelectorAll('.counter, .price, .product-status').forEach(c=>{
      c.classList.remove('silver');
      c.classList.add('gold');
    });
    // visual tweak limited to this element
    try { el.style.boxShadow = el.style.boxShadow || '0 0 12px rgba(255,216,122,0.28)'; } catch(e){}
  }

  function markItemsGoldInCart(){
    const containers = CART_CONTAINERS.map(s => document.querySelector(s)).filter(Boolean);
    if(!containers.length) { console.info('markItemsGoldInCart: no cart containers found'); return false; }
    const nodes = new Set();
    containers.forEach(c => c.querySelectorAll('.cart-item, .product-card').forEach(n => nodes.add(n)));
    if(!nodes.size) { console.info('markItemsGoldInCart: no cart items found'); return false; }
    nodes.forEach(_applyGoldToCartItem);
    console.info('markItemsGoldInCart: finalized', nodes.size, 'cart item(s).');
    return true;
  }

  // expose for sheet finalize handler
  window.markItemsGoldInCart = markItemsGoldInCart;

  console.info('markItemsGoldInCart installed ‚Äî call markItemsGoldInCart() after sheet verification.');
})();


</script>
<script>
(function(){
  'use strict';
  document.addEventListener('DOMContentLoaded', () => {
    // CONFIG
    const PRESTIGE_NUMBER = window.PRESTIGE_NUMBER || '+16164391862';
    const SUPPORT_EMAIL = window.SUPPORT_EMAIL || 'orginator+store@icloud.com';
    const JITSI_BASE = window.JITSI_BASE || 'https://meet.jit.si';

    // DOM helpers
    const $id = id => document.getElementById(id);
    const $q = sel => document.querySelector(sel);

    // Hooks
    const buzzer = $id('prestigeBuzzer') || $q('.prestige-buzzer') || $q('#prestigeSlotFinal .prestige-buzzer');
    const widget = $id('prestigeWidgetFinal') || $id('prestigeWidget') || $q('.prestige-widget-final') || $q('.prestige-widget');
    const nameInput = $id('pfName') || widget?.querySelector('input[placeholder*="name"]');
    const phoneInput = $id('pfPhone') || widget?.querySelector('input[placeholder*="Phone"]');
    const issueInput = $id('pfIssue') || widget?.querySelector('input[placeholder*="issue"], textarea');
    const smsBtn = $id('pfSendSms') || widget?.querySelector('#pfSendSms, .send, .prestige-send');
    const emailBtn = $id('pfSendEmail') || widget?.querySelector('#pfSendEmail, .send:nth-of-type(2), .prestige-send.ghost');

    // Modal and hidden staff reply
    let hiddenStaff = $id('prestigeHiddenStaffReply');
    if(!hiddenStaff){
      hiddenStaff = document.createElement('textarea');
      hiddenStaff.id = 'prestigeHiddenStaffReply';
      hiddenStaff.style.display = 'none';
      document.body.appendChild(hiddenStaff);
    }
    const modalEl = $id('prestigeModal') || $q('.prestige-modal');
    const smsTextarea = $id('prestigeSmsText') || (modalEl && modalEl.querySelector('textarea'));
    const copySmsBtn = $id('copySms') || (modalEl && modalEl.querySelector('#copySms'));
    const modalSendEmailBtn = $id('modalSendEmail') || (modalEl && modalEl.querySelector('#modalSendEmail'));
    const closeModalBtn = $id('closeModal') || (modalEl && modalEl.querySelector('#closeModal'));

    // Confirm UI fallback
    const confirmEl = $id('prestigeConfirm') || $q('.prestige-confirm');
    const confirmProceed = $id('confirmProceed') || (confirmEl && confirmEl.querySelector('#confirmProceed'));
    const confirmCancel = $id('confirmCancel') || (confirmEl && confirmEl.querySelector('#confirmCancel'));

    // Basic warnings
    if(!smsBtn) console.warn('Prestige: SMS button not found (pfSendSms).');
    if(!widget) console.warn('Prestige: widget not found (prestigeWidgetFinal).');

    // Utility: generate room id
    function genRoom(prefix='prestige', len=8){
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let s = prefix + '-';
      for(let i=0;i<len;i++) s += chars[Math.floor(Math.random()*chars.length)];
      return s;
    }

    // CART READERS
    function collectCartSummaryLinesDirect(){
      const container = document.querySelector('#cartList') || document.querySelector('.cart, .cart-list');
      const VISUAL = ['.skeleton','.visual-only','[data-shimmer]','[data-visual]'];

      const lines = [];
      if(!container) return lines;
      const items = container.querySelectorAll('.cart-item, .product-card, .cart-row, .cart-entry, .store-item, .item');
      items.forEach(node => {
        try {
          const walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null, false);
          let text = '', n;
          while(n = walker.nextNode()){
            let p = n.parentNode, skip = false;
            while(p && p !== document){
              for(const sel of VISUAL){ try{ if(p.matches && p.matches(sel)){ skip = true; break; } }catch(e){} }
              if(skip) break;
              p = p.parentNode;
            }
            if(skip) continue;
            const t = n.nodeValue.replace(/\s+/g,' ').trim();
            if(t) text += (text ? ' ' : '') + t;
          }
          const title = (node.querySelector('.product-title, .title, .name, h4, h3')?.textContent || text || node.getAttribute('data-title') || '').trim();
          const price = (node.querySelector('.price, .product-cost, .item-price')?.textContent || node.getAttribute('data-price') || '').trim();
          const qtyEl = node.querySelector('.qty, .quantity') || node.querySelector('input.qty');
          const qty = qtyEl ? ((qtyEl.value||qtyEl.textContent||'').trim()) : '';
          if(title){
            const parts = [ title.replace(/\b(shimmer|pending|awaiting)\b/ig,'').trim(), qty ? 'x'+qty : '', price ].filter(Boolean);
            lines.push(parts.join(' ‚Ä¢ '));
          }
        } catch(e){
          console.warn('collectCartSummaryLinesDirect parse error', e);
        }
      });
      return lines;
    }

    function buildOneLineCartSummary(maxItems = 3){
      try {
        const lines = collectCartSummaryLinesDirect() || [];
        if(!lines.length) return '';
        const sample = lines.slice(0, maxItems).join('; ');
        return sample.length > 200 ? sample.slice(0,197) + '...' : sample;
      } catch(e){
        return '';
      }
    }

    // Build SMS preview (no duplicate link)
    function buildSmsPreview(){
      const name = (nameInput?.value || '').trim();
      const phone = (phoneInput?.value || '').trim();
      const issue = (issueInput?.value || '').trim();
      const room = genRoom('prestige',8);
      const roomLink = `${JITSI_BASE}/${room}`;
      const header = [];
      if(name) header.push(`Name: ${name}`);
      if(phone) header.push(`Phone: ${phone}`);
      if(issue) header.push(`Issue: ${issue}`);
      header.push(`Join: ${roomLink}`);
      let body = header.join('\n');

      const cartLines = collectCartSummaryLinesDirect();
      if(cartLines && cartLines.length) body += '\n\nCart:\n' + cartLines.join('\n');

      const friendly = `\n\nPrestige Care , we can help verify your purchase and join a secure chatroom (see Join link above).\n\nIf you prefer, our team can also assist by email or call.{Prestige members may take 15 ~ 30 minutes to respond}`;
      body += friendly;

      const staffReply = `Hi ${name || '[name]'}, join here: ${roomLink} ‚Äî I‚Äôll join now.`;
      return { body, staffReply, roomLink };
    }

    // Client cart token helpers
    function ensureCartToken(){
      try {
        const KEY = 'prestigeCartToken';
        let token = localStorage.getItem(KEY);
        if(token && typeof token === 'string' && token.length >= 8) return token;
        token = 'cart_' + Math.random().toString(36).slice(2,10);
        localStorage.setItem(KEY, token);
        return token;
      } catch(e){
        console.warn('ensureCartToken failed', e);
        return 'cart_' + Math.random().toString(36).slice(2,10);
      }
    }

    // Snapshot POST
    async function createSnapshotAndGetUrl(){
      try {
        const cartLines = collectCartSummaryLinesDirect();
        const payload = {
          token: ensureCartToken(),
          name: (nameInput?.value || '').trim(),
          phone: (phoneInput?.value || '').trim(),
          issue: (issueInput?.value || '').trim(),
          cartLines,
          pageUrl: window.location.href,
          ts: Date.now()
        };
        const res = await fetch('/api/prestige/snapshot', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if(!res.ok){ console.warn('snapshot POST failed', res.status); return null; }
        const json = await res.json();
        if(json.url) return json.url;
        if(json.token) return `${window.location.origin}/p/s/${json.token}`;
        return null;
      } catch(e){
        console.warn('createSnapshotAndGetUrl error', e);
        return null;
      }
    }

    // openPrestigeSms must NOT touch modal UI
    // --- REPLACE openPrestigeSms WITH THIS ---
async function openPrestigeSms(prestigeNumber, messageText){
  const body = String(messageText || '').trim();
  const encoded = encodeURIComponent(body);
  const ua = navigator.userAgent || '';
  const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
  const isAndroid = /Android/.test(ua);

  const candidates = [];
  if(isIOS){
    candidates.push(`sms:${prestigeNumber}&body=${encoded}`);
    candidates.push(`sms:${prestigeNumber}?body=${encoded}`);
  } else {
    candidates.push(`sms:${prestigeNumber}?body=${encoded}`);
    candidates.push(`sms:${prestigeNumber}&body=${encoded}`);
  }

  function tryAnchor(uri){
    return new Promise((resolve) => {
      try {
        const a = document.createElement('a');
        a.href = uri;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        setTimeout(()=> { try{ a.remove(); }catch(e){}; resolve(true); }, 300);
      } catch(e){ resolve(false); }
    });
  }

  // prefer native share on mobile
  if(navigator.share && (isIOS || isAndroid)){
    try { await navigator.share({ title:'Prestige Care', text: body }); return { status:'shared' }; } catch(e){ /* ignore */ }
  }

  for(const uri of candidates){
    try {
      const ok = await tryAnchor(uri);
      if(ok) return { status:'opened', uri };
    } catch(e){
      console.warn('openPrestigeSms tryAnchor error', e);
    }
  }

  // fallback: copy to clipboard (do not touch modal here)
  try { await navigator.clipboard.writeText(`${body}\n\nPrestige Care: ${prestigeNumber}`); } catch(e){ console.warn('clipboard fallback failed', e); }
  return { status:'fallback' };
}

// --- REPLACE handleSms WITH THIS ---
async function handleSms(){
  try {
    console.debug('Prestige: handleSms start');

 // Build preview and token block
const preview = (typeof buildSmsPreview === 'function')
  ? buildSmsPreview()
  : { body: 'Prestige Care', staffReply: '' };

const token = (typeof ensureCartToken === 'function')
  ? ensureCartToken()
  : ('cart_' + Math.random().toString(36).slice(2,10));

// Only include CartID here, not cart lines (to avoid duplication)
const tokenBlock = `CartID: ${token}\n\n`;

// Populate textarea if present
if (smsTextarea) {
  smsTextarea.value = tokenBlock + (preview.body || '');
} else {
  console.warn('Prestige: smsTextarea not found; modal textarea missing');
}

// Ensure modal exists
if (!modalEl) {
  console.warn('Prestige: modal element not found; falling back to immediate send');
  // fallback: create message and send immediately
  const fallbackMsg = tokenBlock + (preview.body || '');
  await openPrestigeSms(PRESTIGE_NUMBER, fallbackMsg);
  return;
}


    // Ensure a visible CartID badge (click to copy)
    try {
      let tokenBadge = modalEl.querySelector('.prestige-cartid-badge');
      if(!tokenBadge){
        tokenBadge = document.createElement('div');
        tokenBadge.className = 'prestige-cartid-badge';
        tokenBadge.style.cssText = 'font-weight:600;margin-bottom:8px;cursor:pointer;padding:6px 8px;border-radius:4px;background:#f3f4f6;border:1px solid #e5e7eb;';
        modalEl.insertBefore(tokenBadge, modalEl.firstChild);
      }
      tokenBadge.textContent = `CartID: ${token}`;
      tokenBadge.onclick = async () => {
        try { await navigator.clipboard.writeText(token); tokenBadge.textContent = `CartID: ${token} (copied)`; setTimeout(()=> tokenBadge.textContent = `CartID: ${token}`, 1200); } catch(e){ console.warn('copy token failed', e); }
      };
    } catch(e){ console.warn('Prestige: token badge creation failed', e); }

    // Show modal
    modalEl.classList.add('show');
    modalEl.style.display = 'block';
    console.debug('Prestige: modal shown');

    // Find or create Proceed/Cancel buttons inside modal
   // --- Find an existing form proceed/cancel first, otherwise inject modal controls (idempotent) ---
let proceedBtn = null;
let cancelBtn = null;

// 1) Try to find a form-based proceed button (common selectors)
try {
  // common form containers and submit buttons used by many themes
  const formSelectors = [
    'form#prestigeForm', 'form.prestige-form', 'form.checkout', 'form.cart-form',
    '.prestige-form', '.checkout-form', '.cart-form'
  ];
  for(const sel of formSelectors){
    const f = document.querySelector(sel);
    if(!f) continue;
    // prefer explicit submit button
    const submit = f.querySelector('button[type="submit"], input[type="submit"], .form-proceed, .proceed, .submit');
    if(submit){
      proceedBtn = submit;
      // try to find a cancel/reset in the same form
      cancelBtn = f.querySelector('button[type="reset"], .form-cancel, .cancel') || null;
      break;
    }
    // fallback: any button that looks like proceed inside the form
    const anyBtn = f.querySelector('button, input[type="button"], input[type="submit"]');
    if(anyBtn){
      proceedBtn = anyBtn;
      cancelBtn = f.querySelector('button[type="reset"], .form-cancel, .cancel') || null;
      break;
    }
  }
} catch(e){
  console.warn('Prestige: form lookup failed', e);
}

// 2) If no form proceed found, reuse previously injected modal controls if present
if(!proceedBtn){
  // avoid injecting multiple times: mark modalEl._prestigeInjected
  try {
    if(modalEl){
      // if we already injected controls earlier, reuse them
      if(modalEl._prestigeInjected){
        proceedBtn = modalEl.querySelector('.prestige-proceed') || modalEl.querySelector('#confirmProceed, .modal-proceed');
        cancelBtn = modalEl.querySelector('.prestige-cancel') || modalEl.querySelector('#confirmCancel, .modal-cancel');
      } else {
        // inject controls once
        const footer = modalEl.querySelector('.modal-footer') || modalEl;
        const wrapper = document.createElement('div');
        wrapper.className = 'prestige-injected-controls';
        wrapper.style.cssText = 'margin-top:12px;display:flex;gap:8px;justify-content:flex-end;';
        const cancel = document.createElement('button');
        cancel.type = 'button';
        cancel.className = 'prestige-cancel';
        cancel.textContent = 'Cancel';
        const proceed = document.createElement('button');
        proceed.type = 'button';
        proceed.className = 'prestige-proceed';
        proceed.textContent = 'Proceed';
        proceed.style.cssText = 'font-weight:600;';
        wrapper.appendChild(cancel);
        wrapper.appendChild(proceed);
        footer.appendChild(wrapper);
        proceedBtn = proceed;
        cancelBtn = cancel;
        modalEl._prestigeInjected = true;
      }
    }
  } catch(e){
    console.warn('Prestige: modal injection failed', e);
  }
}

// 3) Final safety: if still no proceedBtn, fallback to a global confirm UI
if(!proceedBtn){
  proceedBtn = confirmProceed || null;
  cancelBtn = confirmCancel || null;
}


    // One-time attach helper
    function once(el, ev, fn){
      if(!el) return;
      const wrapper = function(e){ try { fn(e); } finally { el.removeEventListener(ev, wrapper); } };
      el.addEventListener(ev, wrapper);
    }

    // Cancel handler
    once(cancelBtn, 'click', () => {
      try { modalEl.classList.remove('show'); modalEl.style.display = 'none'; } catch(e){}
      console.debug('Prestige: modal cancelled by user');
    });

    // Proceed handler
 // Proceed handler (idempotent; creates snapshot after user confirms)
if(proceedBtn){
  // avoid double-attaching
  if(!proceedBtn._prestigeAttached){
    proceedBtn._prestigeAttached = true;

    const enclosingForm = proceedBtn.closest ? proceedBtn.closest('form') : null;

    const handler = async function onProceed(e){
      // prevent multiple clicks
      try {
        // If this is a real submit button, prevent immediate submit so we can snapshot first
        const isSubmit = (proceedBtn.tagName === 'BUTTON' && (proceedBtn.type === 'submit' || proceedBtn.getAttribute('type') === 'submit')) ||
                         (proceedBtn.tagName === 'INPUT' && proceedBtn.type === 'submit');
        if(isSubmit && e && typeof e.preventDefault === 'function') e.preventDefault();

        console.debug('Prestige: Proceed clicked (handler)');

        // Read edited body (user may have changed it)
        const editedBody = (smsTextarea?.value || preview.body || '').trim();

        // show creating state and prevent double clicks
        const originalText = proceedBtn.textContent;
        try { proceedBtn.textContent = 'Creating‚Ä¶'; } catch(e){}
        try { proceedBtn.disabled = true; } catch(e){}

        // Create snapshot AFTER user confirms (with a short timeout)
        let snapshotUrl = null;
        try {
          if(typeof createSnapshotAndGetUrl === 'function'){
            snapshotUrl = await Promise.race([
              createSnapshotAndGetUrl(),
              new Promise((resolve) => setTimeout(()=> resolve(null), 6000))
            ]);
          }
        } catch(err){
          console.warn('snapshot error', err);
          snapshotUrl = null;
        } finally {
          // always restore button state
          try { proceedBtn.textContent = originalText; } catch(e){}
          try { proceedBtn.disabled = false; } catch(e){}
        }

        // Compose final message: prefer snapshot URL, otherwise include token
        let messageToSend = editedBody;
        if(snapshotUrl){
          messageToSend += `\n\nDetails: ${snapshotUrl}`;
          try { hiddenStaff.value = `Snapshot: ${snapshotUrl}`; } catch(e){}
        } else {
          const t = (typeof ensureCartToken === 'function') ? ensureCartToken() : token;
          const one = (typeof buildOneLineCartSummary === 'function') ? buildOneLineCartSummary(3) : oneLine;
          if(one) messageToSend += `\n\nItems: ${one}`;
          messageToSend += `\n\nCartID: ${t}`;
          try { hiddenStaff.value = `CartID: ${t}`; } catch(e){}
        }

        // Hand off to opener (share / sms / clipboard)
        const res = await openPrestigeSms(PRESTIGE_NUMBER, messageToSend);
        console.debug('Prestige: openPrestigeSms result', res);

        // If this was a real form submit button, continue the form submit now
        if(isSubmit && enclosingForm){
          setTimeout(()=> {
            try { enclosingForm.submit(); } catch(e){ console.warn('form.submit failed', e); }
          }, 250);
        }

      } catch(err){
        console.error('Prestige: error in Proceed handler', err);
        alert('An error occurred while sending. Check console for details.');
      } finally {
        try { modalEl.classList.remove('show'); modalEl.style.display = 'none'; } catch(e){}
      }
    };

    proceedBtn.addEventListener('click', handler);
  }
}


  } catch(err){
    console.error('Prestige: handleSms top-level error', err);
    alert('An error occurred preparing the SMS preview. Check console for details.');
  }
}


    // Email handler unchanged
    function handleEmail(){
      const name = (nameInput?.value || '').trim();
      const phone = (phoneInput?.value || '').trim();
      const issue = (issueInput?.value || '').trim();
      const room = genRoom('prestige',8);
      const t = (typeof buildTemplates === 'function') ? buildTemplates(name, phone, issue, room) : {
        subjectStaff: `Prestige Help Request ‚Äî ${name || '[username]'}`,
        bodyStaff: `User: ${name}\nPhone: ${phone}\nIssue: ${issue}`
      };
      hiddenStaff.value = t.staffReply || `Hi ${name||'[name]'}, join here: ${JITSI_BASE}/${room} ‚Äî I‚Äôll join now.`;
      if(typeof openMailto === 'function') openMailto(t.subjectStaff, t.bodyStaff);
      else window.location.href = `mailto:${encodeURIComponent(SUPPORT_EMAIL)}?subject=${encodeURIComponent(t.subjectStaff)}&body=${encodeURIComponent(t.bodyStaff)}`;
    }

    // Safe attach helper
    function safeAttach(btn, handler, name){
      if(!btn || !handler) return;
      if(btn._prestigeAttached) return;
      try { btn.type = btn.type || 'button'; } catch(e){}
      btn.addEventListener('click', function(e){
        if(e && typeof e.preventDefault === 'function') e.preventDefault();
        try {
          const res = handler();
          if(res && typeof res.then === 'function') res.catch(err => console.error(`${name} handler error`, err));
        } catch(err){ console.error(`${name} wrapper error`, err); }
      }, { passive:false });
      btn._prestigeAttached = true;
    }

    // Attach handlers
    safeAttach(smsBtn, handleSms, 'SMS');
    safeAttach(emailBtn, handleEmail, 'Email');
    if(buzzer && !buzzer._prestigeToggleInstalled){
      buzzer.addEventListener('click', () => { widget?.classList.toggle('prestige-hidden'); (nameInput || widget?.querySelector('input'))?.focus(); buzzer.classList.remove('pulse'); });
      buzzer._prestigeToggleInstalled = true;
    }

    // Modal actions
    if(copySmsBtn && smsTextarea && !copySmsBtn._prestigeAttached){
      copySmsBtn.addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(smsTextarea.value || ''); copySmsBtn.textContent = 'Copied'; setTimeout(()=> copySmsBtn.textContent = 'Copy SMS',1200); } catch(e){ copySmsBtn.textContent = 'Copy failed'; setTimeout(()=> copySmsBtn.textContent = 'Copy SMS',1200); }
      });
      copySmsBtn._prestigeAttached = true;
    }
    if(modalSendEmailBtn && !modalSendEmailBtn._prestigeAttached){
      modalSendEmailBtn.addEventListener('click', () => {
        const name = (nameInput?.value || '').trim();
        const phone = (phoneInput?.value || '').trim();
        const issue = (issueInput?.value || '').trim();
        const subject = `Prestige Help Request ‚Äî ${name || '[username]'}`;
        const body = `User: ${name || '[name]'}\nPhone: ${phone || '[number]'}\nIssue: ${issue || '[short description]'}\n\nPlease respond with Jitsi link via SMS.`;
        if(typeof openMailto === 'function') openMailto(subject, body);
        else window.location.href = `mailto:${encodeURIComponent(SUPPORT_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      });
      modalSendEmailBtn._prestigeAttached = true;
    }
    if(closeModalBtn && !closeModalBtn._prestigeAttached){
      closeModalBtn.addEventListener('click', () => { if(modalEl) modalEl.style.display = 'none'; });
      closeModalBtn._prestigeAttached = true;
    }

    // Expose debug helpers
    window.prestige = window.prestige || {};
    window.prestige.collectCartSummaryLinesDirect = collectCartSummaryLinesDirect;
    window.prestige.buildSmsPreview = buildSmsPreview;
    window.prestige.createSnapshotAndGetUrl = createSnapshotAndGetUrl;
    window.prestige.openPrestigeSms = openPrestigeSms;
    window.prestige.ensureCartToken = ensureCartToken;
    window.prestige.buildOneLineCartSummary = buildOneLineCartSummary;

    console.log('Prestige: modal-first SMS handler attached.');
  });
})();
  
  // injection: create controls but copy classes from existing modal buttons if present
(function injectPrestigeControls(modalEl){
  if(!modalEl) return null;
  if(modalEl._prestigeInjected) {
    return {
      proceed: modalEl.querySelector('.prestige-proceed'),
      cancel: modalEl.querySelector('.prestige-cancel')
    };
  }

  // try to find existing modal buttons to copy classes from
  const sampleProceed = modalEl.querySelector('button.btn-primary, button.primary, .modal-footer .btn, .modal-footer .primary') ||
                        document.querySelector('button.btn-primary, button.primary, .modal-footer .btn, .modal-footer .primary');
  const sampleCancel  = modalEl.querySelector('button.btn-secondary, button.secondary, .modal-footer .btn-secondary, .modal-footer .cancel') ||
                        document.querySelector('button.btn-secondary, button.secondary, .modal-footer .btn-secondary, .modal-footer .cancel');

  const footer = modalEl.querySelector('.modal-footer') || modalEl;
  const wrapper = document.createElement('div');
  wrapper.className = 'prestige-injected-controls';
  wrapper.style.cssText = 'margin-top:12px;display:flex;gap:8px;justify-content:flex-end;align-items:center;';

  const cancel = document.createElement('button');
  cancel.type = 'button';
  cancel.className = 'prestige-cancel';
  cancel.textContent = 'Cancel';

  const proceed = document.createElement('button');
  proceed.type = 'button';
  proceed.className = 'prestige-proceed';
  proceed.textContent = 'Proceed';

  // copy class lists from sample buttons if found (preserve site styling)
  try {
    if(sampleProceed && sampleProceed.classList && sampleProceed.classList.length){
      proceed.className = Array.from(sampleProceed.classList).join(' ') + ' prestige-proceed';
    }
    if(sampleCancel && sampleCancel.classList && sampleCancel.classList.length){
      cancel.className = Array.from(sampleCancel.classList).join(' ') + ' prestige-cancel';
    }
  } catch(e){ /* ignore copy errors */ }

  wrapper.appendChild(cancel);
  wrapper.appendChild(proceed);
  footer.appendChild(wrapper);

  modalEl._prestigeInjected = true;
  return { proceed, cancel };
})(modalEl);

  
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const sms = document.getElementById('pfSendSms') || document.getElementById('smsBtn');
  const modal = document.getElementById('prestigeModal') || document.querySelector('.prestige-modal');
  if (!sms || !modal) return;
  if (sms.tagName === 'BUTTON') sms.type = 'button';
  sms.addEventListener('click', e => {
    e.preventDefault();
    e.stopPropagation();
    modal.classList.toggle('open');
    modal.setAttribute('aria-hidden', modal.classList.contains('open') ? 'false' : 'true');
  });
  // close button inside modal (if present)
  const close = modal.querySelector('#closeModal') || modal.querySelector('.close-btn');
  close?.addEventListener('click', e => { e.preventDefault(); modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); });
});
</script>


</body>
</html>
