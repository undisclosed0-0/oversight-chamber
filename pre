<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Prestige Hybrid Storefront</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg1:#0f2027; --bg2:#203a43; --bg3:#2c5364;
      --ink:#eaf3ff; --muted:#a8bfd6;
      --blue:#88ccff; --blueDim:#69b9ff;
      --silver:#c0cbd6; --gold:#ffd87a;
      --panel: rgba(30,30,40,0.88);
      --glass: rgba(255,255,255,0.08);
      --radius:14px;
      --shadow:0 18px 40px rgba(0,0,0,0.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); font-family:'Cinzel Decorative', serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
    }
    .wrap{ max-width:1160px; margin:0 auto; padding:18px }

    /* Header crest + fa√ßade */
    header.site {
      padding:22px 16px; text-align:center; position:relative;
      background: radial-gradient(640px 280px at 10% 0%, rgba(136,204,255,0.18), transparent);
      box-shadow: 0 0 30px rgba(136,204,255,0.15) inset;
    }
    .brand-title{
      font-size:2.6rem; margin:0;
      color:var(--ink);
      text-shadow: 0 0 20px var(--blue), 0 0 6px var(--blueDim);
    }
    .crest-mark{
      width:56px; height:56px; border-radius:50%; margin:0 auto 8px;
      background: conic-gradient(from 190deg, var(--blue), #aee3ff, var(--blueDim), var(--blue));
      box-shadow: 0 0 26px var(--blue);
    }

    /* Verse + token box + cart */
    .token-box{
      margin:16px auto; max-width:860px; padding:14px 16px;
      border:1px solid var(--blue); border-radius:12px;
      background: var(--glass); text-align:center;
      box-shadow: 0 0 24px rgba(136,204,255,0.25);
    }
    .verse{ font-style:italic; color:var(--ink); margin-bottom:10px }
    .counters{ display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-top:8px }
    .counter{
      padding:8px 12px; border-radius:10px; border:1px solid var(--blue);
      background: var(--glass); box-shadow: 0 0 14px rgba(136,204,255,0.25);
    }
    .counter.gold{ border-color: var(--gold); box-shadow: 0 0 16px rgba(255,216,122,0.35); color: var(--gold) }
    .counter.silver{ border-color: var(--silver); box-shadow: 0 0 16px rgba(192,203,214,0.35); color: var(--silver) }
    .cart-btn{
      all:unset; display:inline-block; margin-top:10px; cursor:pointer;
      background:linear-gradient(180deg, #152535, #0f1b29);
      border:1px solid var(--blue); color:var(--ink);
      padding:8px 12px; border-radius:10px;
      box-shadow: 0 0 14px rgba(136,204,255,0.25);
    }

    /* Farce-style first windows row (live/manual submission look) */
    .windows{
      display:grid; grid-template-columns:repeat(4,1fr); gap:12px;
      margin-top:18px;
    }
    .window{
      min-height:150px; position:relative; overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
      border:1px solid #28435a; border-radius:12px; box-shadow: var(--shadow);
    }
    .window::after{
      content:""; position:absolute; left:0; right:0; bottom:0; height:3px;
      background:linear-gradient(90deg, var(--blue), #aee3ff, var(--blueDim));
      opacity:0.75;
    }
    .tile{
      position:absolute; inset:0; display:flex; align-items:center; gap:12px; padding:12px;
    }
    .tile-art{
      width:70px; height:70px; border-radius:12px;
      background:linear-gradient(135deg, #7a1bd1, #ff2d6b);
      box-shadow:0 10px 26px rgba(122,27,209,0.35);
    }
    .tile-meta{ display:flex; flex-direction:column; gap:6px }
    .tile-title{ font-weight:700 }
    .tile-sub{ color:var(--muted); font-size:13px }
    .badge{
      display:inline-flex; align-items:center; gap:6px; font-size:12px; color:#04131f;
      background:linear-gradient(180deg, var(--blue), #bfe8ff); padding:4px 8px; border-radius:999px; font-weight:700;
    }

    /* Second windows row: chamber directory */
    .windows-dir{ margin-top:16px }
    .dir-card{ padding:12px; text-align:center; border:1px solid #28435a; border-radius:12px; background:var(--glass) }
    .dir-card h3{ margin:6px 0; text-shadow:0 0 8px var(--blue) }
    .dir-card p{ margin:0; color:var(--muted) }
    .dir-card .open{
      display:inline-block; margin-top:8px; padding:6px 10px; border-radius:10px;
      border:1px solid var(--blue); color:#04131f; background:linear-gradient(180deg, var(--blue), #bfe8ff);
      text-decoration:none; font-weight:700;
    }

    /* Chambers (dual panels: left info image/desc, right store) */
    .chamber{
      display:none; margin-top:18px; padding:18px;
      border:2px solid var(--blue); border-radius:var(--radius);
      background:var(--panel); box-shadow: 0 0 24px var(--blue);
    }
    .chamber.active{ display:block }
    .chamber-grid{
      display:grid; grid-template-columns: 1fr 1fr; gap:16px;
    }
    .info-panel, .store-panel{
      border:1px solid #2c4b64; border-radius:12px; background: var(--glass);
      padding:14px;
    }
    .info-img{
      width:100%; height:180px; border-radius:10px; margin-bottom:10px;
      background:linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      border:1px solid #325875;
    }
    .store-panel h4{ margin:0 0 10px; text-shadow:0 0 8px var(--blue) }
    .product-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:12px }
    .product-card{ border:1px solid var(--blue); border-radius:10px; padding:12px; background:#333a; box-shadow:0 0 12px var(--blue) }
    .price{ opacity:.9; margin:6px 0 }
    .status{ font-style:italic; min-height:22px }
    .status.pending{ color:var(--silver); text-shadow:0 0 6px var(--silver) }
    .status.finalized{ color:var(--gold); text-shadow:0 0 6px var(--gold) }

    /* Payment rails (inside Commerce checkout) */
    .checkout{
      margin-top:12px; display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:10px;
    }
    .rail{ border:1px dashed rgba(136,204,255,0.35); border-radius:10px; padding:12px; background:rgba(46,52,70,0.6) }
    .rail strong{ display:block; margin-bottom:6px }

    /* Live feed + reflection + community ad (timers are hook-ready) */
    .lower{
      margin-top:20px; display:grid; grid-template-columns: 2fr 1fr; gap:14px;
    }
    .panel-lite{
      border:1px solid #2c4b64; border-radius:12px; background: var(--glass);
      padding:12px;
    }
    .feed{ display:grid; gap:8px }
    .feed-item{ padding:10px; border-radius:10px; border:1px solid #325875; background:linear-gradient(180deg, rgba(20,26,34,0.9), rgba(12,17,23,0.9)) }
    .ad{ min-height:80px; display:flex; align-items:center; justify-content:center; text-align:center }

    /* Animations */
    @keyframes frostFade{ from{ opacity:0; transform:scale(0.98) } to{ opacity:1; transform:scale(1) } }
    @keyframes voidGlow{
      0%{ box-shadow:0 0 22px rgba(255,216,122,0.24) }
      50%{ box-shadow:0 0 44px rgba(255,238,200,0.5) }
      100%{ box-shadow:0 0 22px rgba(255,216,122,0.24) }
    }
    .frost{ animation:frostFade .8s ease forwards }
    .void{ animation:voidGlow 8s ease-in-out infinite }

    /* Controls */
    .controls{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px }
    .btn{
      all:unset; display:inline-block; cursor:pointer;
      background:linear-gradient(180deg,#152535,#0f1b29); color:var(--ink);
      border:1px solid var(--blue); border-radius:10px; padding:8px 12px; font-weight:700;
      box-shadow:0 0 14px rgba(136,204,255,0.25);
    }

    /* Responsive */
    @media (max-width:960px){ .windows{grid-template-columns:repeat(2,1fr)} .chamber-grid{grid-template-columns:1fr} .lower{grid-template-columns:1fr} }
    @media (max-width:560px){ .windows{grid-template-columns:1fr} .brand-title{font-size:2.2rem} }
 
  .feed-item {
  background: linear-gradient(180deg, rgba(20,26,34,0.9), rgba(12,17,23,0.9));
  border: 1px solid #273242;
  border-radius: 10px;
  padding: 10px 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  animation: fadeSlide 0.6s ease;
}
@keyframes fadeSlide {
  from { opacity: 0; transform: translateY(-6px); }
  to   { opacity: 1; transform: translateY(0); }
}

  .billboard-row {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 16px;
  margin-top: 20px;
}

.billboard-article {
  background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
  border: 1px solid #28435a;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(136,204,255,0.15);
  padding: 14px;
  animation: fadeSlide 0.6s ease;
}

.billboard-image {
  width: 100%;
  height: 140px;
  border-radius: 10px;
  background: #444;
  margin-bottom: 10px;
}

.billboard-title {
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 4px;
}

.billboard-sub {
  font-size: 0.9rem;
  color: #a8bfd6;
  margin-bottom: 6px;
}

.badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: bold;
  background: linear-gradient(180deg, #88ccff, #bfe8ff);
  color: #04131f;
}

@keyframes fadeSlide {
  from { opacity: 0; transform: translateY(-10px); }
  to   { opacity: 1; transform: translateY(0); }
}
.emblem-sigil {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin-bottom: 8px;
  background: radial-gradient(circle at center, rgba(255,255,255,0.08), rgba(136,204,255,0.15));
  box-shadow: 0 0 12px rgba(136,204,255,0.25);
}

/* Unique shading per method */
.prestige-pay {
  background: linear-gradient(135deg, #ffd87a, #fff2c2);
}
.cod {
  background: linear-gradient(135deg, #88ccff, #d0ecff);
}
.money-order {
  background: linear-gradient(135deg, #c0cbd6, #e2e8f0);
}
.checkout-cart {
  background: linear-gradient(135deg, #aee3ff, #eaf6ff);
}

 .cart-list { display: grid; gap: 12px; margin-top: 12px }
.cart-item {
  padding: 12px;
  border-radius: 10px;
  background: linear-gradient(90deg, #2a2a2a 0%, #3a3a3a 50%, #2a2a2a 100%);
  background-size: 200% 100%;
  animation: shimmerSoft 3s infinite linear;
  color: #e0e0e0;
}

@keyframes shimmerSoft {
  0%   { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
.cart-item {
  border: 1px solid rgba(255,255,255,0.06);
}

.cart-item.finalized {
  background: linear-gradient(135deg, #4a3a1a, #6a4a2a);
  color: #ffd87a;
  border: 1px solid #d6b36a;
  box-shadow: 0 0 12px rgba(255,216,122,0.35);
}

.receipt-confirm {
  font-size: 1.2rem;
  font-weight: bold;
  text-align: center;
  background: linear-gradient(135deg, #4a3a1a, #6a4a2a);
  padding: 12px;
  border-radius: 10px;
  box-shadow: 0 0 18px rgba(255,216,122,0.3);
}inear-gradient(135deg, #ffd87a, #fff2c2);
  border-radius: 12px;
  box-shadow: 0 0 24px rgba(255,216,122,0.35);
}
.info-img.glow {
  background: radial-gradient(circle at center, rgba(255,216,122,0.15), transparent);
  box-shadow: 0 0 30px rgba(255,216,122,0.45);
  border: 2px solid #d6b36a;
  border-radius: 12px;
  padding: 16px;
  color: #ffd87a;
}
.cart-btn {
  position: relative;
  font-size: 1rem;
  padding: 8px 14px;
}

.cart-count {
  position: absolute;
  top: -6px;
  right: 160px;
  background: crimson;
  color: white;
  font-size: 0.8rem;
  font-weight: bold;
  border-radius: 50%;
  padding: 2px 6px;
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
}
.product-card {
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.product-card:active {
  transform: scale(0.96); /* slight shrink to simulate press */
  box-shadow: 0 0 6px rgba(0,0,0,0.4) inset; /* inner shadow for depth */
}
.product-card {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  background: #1a1a1a;
  border: 1px solid #444;
  border-radius: 12px;
  padding: 16px;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  cursor: pointer;
}

.product-card:hover {
  transform: scale(1.02);
  box-shadow: 0 0 12px rgba(136,204,255,0.5);
}

.product-card:active {
  transform: scale(0.96);
  box-shadow: 0 0 6px rgba(0,0,0,0.4) inset;
}

.product-icon {
  height: 80px;
  width: 80px;
  margin: 0 auto 12px;
  background-size: cover;
  background-position: center;
  border-radius: 50%;
  box-shadow: 0 0 8px rgba(255,255,255,0.1);
}
.ring-crest { background-image: url('/assets/ring.png'); } /* example icon class */

.product-meta {
  text-align: center;
  margin-bottom: 8px;
}

.product-title {
  font-weight: bold;
  font-size: 1.1rem;
  margin-bottom: 4px;
}

.product-cost {
  color: #ccc;
  font-size: 0.95rem;
}

.product-status {
  font-size: 0.85rem;
  font-style: italic;
  color: #aaa;
}

.product-action {
  text-align: center;
  font-size: 0.9rem;
  color: #88ccff;
  margin-top: 8px;
}
.product-grid {
  display: flex;
  flex-direction: column;
  gap: 0; /* remove default spacing */
}

.product-card {
  padding: 16px;
  border-bottom: 1px solid rgba(255,255,255,0.08); /* subtle divider */
}

.product-card:last-child {
  border-bottom: none; /* no divider after last card */
}
.feed-item .badge {
  display:inline-block;
  background:#3b82f6; /* blue aura */
  color:#fff;
  font-size:0.75em;
  padding:2px 6px;
  border-radius:6px;
  margin-top:4px;
}
.floating-cart {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(20,26,34,0.85);
  border: 1px solid #28435a;
  border-radius: 12px;
  padding: 10px 16px;
  color: var(--ink);
  font-weight: bold;
  box-shadow: 0 0 18px rgba(136,204,255,0.25);
  z-index: 999;
  animation: frostFade 0.6s ease;
}
.ghost-btn {
  all: unset;
  margin-left: 12px;
  padding: 6px 10px;
  border-radius: 8px;
  background: linear-gradient(180deg, var(--blue), #bfe8ff);
  color: #04131f;
  font-weight: bold;
  cursor: pointer;
}
@keyframes frostFade {
  from { opacity: 0; transform: scale(0.98); }
  to   { opacity: 1; transform: scale(1); }
}
.frost {
  animation: frostFade 0.8s ease forwards;
}
.dir-controls {
  display: flex;
  justify-content: flex-end; /* push buttons to right edge */
  gap: 12px;
  margin-top: 12px;
}

.cer-btn {
  padding: 10px 20px;
  background: linear-gradient(180deg, #4b3f72, #6a5acd);
  color: #fff;
  font-family: 'Cinzel', serif;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(75, 63, 114, 0.3);
  cursor: pointer;
  transition: transform 0.2s ease;
}

.cer-btn:hover {
  transform: scale(1.05);
}

.logout-btn {
  background: linear-gradient(180deg, #a83232, #d94f4f); /* red aura */
  box-shadow: 0 4px 12px rgba(168, 50, 50, 0.4);
}
/* Match rectangular panel dimensions */
#loginPanel {
  background: rgba(30, 30, 30, 0.6);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 30px;
  width: 480px;       /* match other rectangular panels */
  min-height: 240px;  /* consistent vertical rhythm */
  margin: 40px auto;
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
  text-align: center;
  animation: fadeSlide 0.6s ease-out;
}

/* Inputs stretch to panel width */
#loginPanel input {
  width: 90%;
  max-width: 420px;   /* keep inside panel frame */
  padding: 12px;
  margin: 12px 0;
  border: none;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  font-size: 15px;
  outline: none;
  transition: background 0.3s;
}

#loginPanel input:focus {
  background: rgba(255, 255, 255, 0.2);
  box-shadow: 0 0 8px #ffd700;
}

/* Buttons aligned and consistent */
#loginPanel button {
  margin: 10px;
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, #ffd700, #ff8c00);
  color: #222;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

#loginPanel button:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 12px #ffd700;
}
/* Container with depth */
.frost-container {
  position: relative;
  width: 100%;
  max-width: 540px;
  height: 300px;
  margin: 0 auto;
  background: radial-gradient(circle at 50% 30%, #0d1117 0%, #0a0d12 40%, #06080b 100%);
  border: 1px solid rgba(140,160,200,0.18);
  box-shadow: 0 10px 28px rgba(0,0,0,0.45), inset 0 1px 18px rgba(120,150,200,0.12);
  border-radius: 16px;
  overflow: hidden;
  perspective: 900px;
}

/* Frost overlay */
.frost-overlay {
  position: absolute;
  inset: 0;
  backdrop-filter: blur(14px) saturate(1.05);
  background: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, rgba(180,210,255,0.07) 100%);
  border-radius: 16px;
  pointer-events: none;
  z-index: 3;
  animation: frostPulse 4.5s ease-in-out infinite;
}

@keyframes frostPulse {
  0%,100% { opacity: 0.9; }
  50%     { opacity: 0.75; }
}

/* 3D object wrapper */
.object-3d {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  z-index: 1;
}

/* Container perspective */
.frost-container {
  perspective: 1200px;
}

/* Ring stack: float, rotate, stretch */
.ring-stack {
  position: absolute;
  left: 50%;
  top: 52%;
  width: 240px;
  height: 240px;
  transform-style: preserve-3d;
  filter: drop-shadow(0 16px 22px rgba(0,0,0,0.45));
  animation:
    floatY 4.2s ease-in-out infinite,
    rotateAndStretch 14s linear infinite;
}

@keyframes floatY {
  0%,100% { transform: translate(-50%, -50%) translateY(0); }
  50%     { transform: translate(-50%, -50%) translateY(-10px); }
}

@keyframes rotateAndStretch {
  0%   { transform: translate(-50%, -50%) rotateY(0deg) scaleX(1.0); }
  25%  { transform: translate(-50%, -50%) rotateY(90deg) scaleX(1.18); }
  50%  { transform: translate(-50%, -50%) rotateY(180deg) scaleX(1.0); }
  75%  { transform: translate(-50%, -50%) rotateY(270deg) scaleX(1.18); }
  100% { transform: translate(-50%, -50%) rotateY(360deg) scaleX(1.0); }
}

/* SVG layers with depth */
.ring-layer {
  position: absolute;
  left: 0; top: 0;
  width: 100%; height: 100%;
  transform-style: preserve-3d;
}

.layer-front { transform: translateZ(36px) rotateX(2deg); }
.layer-mid   { transform: translateZ(18px) rotateX(1deg); }
.layer-back  { transform: translateZ(-18px) rotateX(-1deg); }

.ring-layer circle {
  stroke-width: 28;
  fill: none;
  filter: drop-shadow(0 0 6px rgba(0,0,0,0.3));
}

/* Inner rim */
.inner-rim {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 160px;
  height: 160px;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  box-shadow: inset 0 0 18px rgba(0,0,0,0.4);
  background: radial-gradient(circle, rgba(255,255,255,0.05), rgba(0,0,0,0.2));
  z-index: 0;
}

/* Facets */
.facets {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
}

.facet {
  position: absolute;
  width: 36px; height: 36px;
  background: linear-gradient(135deg, rgba(255,255,255,0.6), rgba(180,225,255,0.15));
  border: 1px solid rgba(190,220,255,0.35);
  backdrop-filter: blur(1px);
  box-shadow: 0 3px 9px rgba(0,0,0,0.25);
  transform: translateZ(20px) rotateX(18deg) scaleX(1.4);
  opacity: 0.65;
  border-radius: 8px;
  animation: facetShimmer 3.6s ease-in-out infinite;
}

@keyframes facetShimmer {
  0%,100% { opacity: 0.55; }
  50%     { opacity: 0.85; }
}

/* Side facets */
.side-facets {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  z-index: 0;
}

.side {
  position: absolute;
  width: 14px;
  height: 140px;
  background: linear-gradient(90deg, rgba(180,220,255,0.2), rgba(255,255,255,0.05));
  border-radius: 6px;
  transform-origin: center;
  opacity: 0.5;
  backdrop-filter: blur(1px);
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
  transform: translate(-50%, 0) rotateY(90deg) scaleX(1.4);
}

.s1 { left: 50%; top: 0%; }
.s2 { left: 50%; top: 25%; }
.s3 { left: 50%; top: 50%; }
.s4 { left: 50%; top: 75%; }

/* Status */
.object-status {
  position: absolute;
  bottom: 12px;
  left: 12px;
  padding: 6px 10px;
  font-size: 14px;
  border-radius: 10px;
  z-index: 4;
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(120,140,180,0.25);
}

.object-status.pending {
  color: #cdd4e0;
  font-style: italic;
  text-shadow: 0 0 4px rgba(190,190,220,0.5);
}

.object-status.finalized {
  color: goldenrod;
  font-weight: bold;
  text-shadow: 0 0 6px rgba(255,215,0,0.6);
}

.frost-container.finalized .ring-stack {
  filter: drop-shadow(0 20px 26px rgba(0,0,0,0.5)) saturate(1.1);
}
.chamber-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  padding: 12px;
}

@media (min-width: 600px) {
  .chamber-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 900px) {
  .chamber-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}
#imgVoid {
  width: 100%;
  max-width: 360px;
  margin: 0 auto;
  aspect-ratio: 3 / 2;
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  background: linear-gradient(to bottom, #0a0f1c, #1c2738);
}
.store-card {
  padding: 12px;
  border-radius: 10px;
  background: #1e2a38;
  color: #fff;
  font-size: 0.95rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: transform 0.2s ease;
}

.store-card:active {
  transform: scale(0.98);
}
.chamber-panel {
  display: none;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.chamber-panel.active {
  display: block;
  opacity: 1;
}
.mobile-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #0f172a;
  display: flex;
  justify-content: space-around;
  padding: 8px 0;
  z-index: 1000;
}

/* Hide sticky nav on tablet/desktop */
@media (min-width: 768px) {
  .mobile-nav {
    display: none !important;
  }
}

.checkout-btn {
  position: fixed;
  bottom: 60px;   /* above sticky bar */
  right: 12px;
  background: #2ed573;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 16px;
  font-size: 0.9rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}
.cart-btn {
  margin-bottom: 60px; /* lifts cart above sticky nav */
}

/* Hide on larger screens */
@media (min-width: 768px) {
  .checkout-btn {
    display: none;
  }
}
.user-login {
  width: 100%;      /* default full width */
  max-width: 400px; /* desktop size */
  margin: 0 auto;
}

/* Mobile half size */
@media (max-width: 480px) {
  .user-login {
    width: 50%;     /* half screen width */
    margin: 0 auto;
  }
}
/* Desktop checkout button */
.checkout-btn-desktop {
  display: inline-block;
}

/* Hide desktop checkout on mobile */
@media (max-width: 767px) {
  .checkout-btn-desktop {
    display: none;
  }
}

/* Mobile checkout button */
.checkout-btn-mobile {
  display: none;
  position: fixed;
  bottom: 60px;   /* above sticky bar */
  right: 12px;
  background: #2ed573;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 16px;
  font-size: 0.9rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}

/* Show mobile checkout only on small screens */
@media (max-width: 767px) {
  .checkout-btn-mobile {
    display: block;
  }
}
.billboard-container {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;       /* horizontal scroll on mobile */
  gap: 12px;
  scroll-snap-type: x mandatory; /* smooth snapping */
}

.billboard {
  flex: 0 0 auto;
  width: 240px;
  height: 140px;
  background: #1e2a38;
  border-radius: 8px;
  opacity: 0;
  transform: translateX(40px);
  animation: fadeSlide 0.8s ease forwards;
  scroll-snap-align: start;
}

@keyframes fadeSlide {
  from {
    opacity: 0;
    transform: translateX(40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
.billboard-container {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
}

.billboard {
  flex: 0 0 100%;        /* take full width of screen */
  height: 160px;
  background: #1e2a38;
  border-radius: 8px;
  scroll-snap-align: center;
}

/* On larger screens, show multiple side by side */
@media (min-width: 768px) {
  .billboard {
    flex: 0 0 240px;     /* fixed size per billboard */
    margin-right: 12px;
  }
}


  </style>
<!-- Paste this entire block into the Console -->
!-- Unified Prestige: HTML hooks, CSS, and JS (paste once before </body>) -->
<style>
  /* Core UI */
  .prestige-slot-final { display:flex; flex-direction:column; gap:8px; align-items:center; padding:8px; box-sizing:border-box; min-width:220px; }
  .prestige-buzzer { width:56px; height:56px; border-radius:50%; border:none; cursor:pointer; background: radial-gradient(circle at 30% 30%, #ffd87a, #ffb84d 60%); box-shadow:0 8px 24px rgba(255,184,77,0.18); display:inline-flex; align-items:center; justify-content:center; font-weight:800; color:#04131f; font-size:20px; }
  .prestige-buzzer-label-final { color:#eaf3ff; font-weight:700; font-size:0.92rem; text-align:center; margin-top:6px; }
  .prestige-widget-final { width:100%; max-width:360px; padding:10px; border-radius:10px; background:linear-gradient(180deg,#071428,#0f2a3a); color:#eaf3ff; box-shadow:0 8px 24px rgba(0,0,0,0.35); display:flex; flex-direction:column; gap:8px; }
  .prestige-widget-final .input { width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:rgba(255,255,255,0.02); color:inherit; box-sizing:border-box; }
  .prestige-send { padding:8px 10px; border-radius:8px; background:linear-gradient(180deg,#ffd87a,#ffb84d); color:#04131f; font-weight:700; border:none; cursor:pointer; }
  .prestige-send.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:#88ccff; }
  .prestige-hidden { display:none !important; }
  .prestige-small { font-size:0.88rem; color:#a8bfd6; }

  /* Modal */
  .prestige-modal { position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:10010; width:min(720px,92%); max-width:720px; background:#071428; color:#eaf3ff; border-radius:12px; padding:16px; box-shadow:0 20px 60px rgba(0,0,0,0.6); display:none; }
  .prestige-modal textarea { width:100%; height:160px; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:rgba(255,255,255,0.02); color:inherit; resize:vertical; box-sizing:border-box; }
  .prestige-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
  .prestige-btn { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
  .prestige-btn.primary { background:linear-gradient(180deg,#ffd87a,#ffb84d); color:#04131f; }
  .prestige-btn.ghost { background:transparent; color:#88ccff; border:1px solid rgba(136,204,255,0.12); }

  /* Positioning helper (keeps your manual inline --x/--y) */
  .prestige-buzzer.center-over-tap { display:inline-block; transform: translateX(var(--x, 0px)) translateY(var(--y, 0px)); transition: transform .12s ease; z-index:9999; will-change: transform; }
</style>
</head>
<body>
  <div class="wrap">

    <!-- Fa√ßade header -->
    <header class="site">
      <div class="crest-mark" aria-hidden="true"></div>
      <h1 class="brand-title"> PRESTIGE HYBRID STORE</h1>
    </header>

    <!-- Verse + token + cart -->
    <section class="token-box frost">
      <div class="verse" id="dailyVerse">‚ÄúLet all that you do be done in love.‚Äù ‚Äî 1 Corinthians 16:14</div>
      <div class="counters">
        <div class="counter gold"><strong>Purchased:ü™ô</strong> <span id="purchasedCount">0</span></div>
        <div class="counter silver"><strong>Symbolic:‚ô¶Ô∏è</strong> <span id="symbolicCount">0</span></div>
      </div>
      <button class="cart-btn" id="cartBtn" onclick="showChamber('checkoutPanel')">
    üõí Cart & Checkout 
    <span id="cartCount" class="cart-count">0</span></button>
    </section>

<section id="userDirectory" class="chamber frost">
  <h4>üë• User Directory</h4>
  <div class="user-grid"></div>
  <div class="dir-controls">
    <button id="retrieveBtn" class="cer-btn">Retrieve Account Information</button>
    <button id="logoutBtn" class="cer-btn logout-btn">Log Out</button>
  </div>
</section>



<section id="loginPanel" class="chamber frost">

  <h4>üîë User Login</h4>
  <div class="controls">
    <input type="text" id="loginUser" placeholder="Enter Username" />
   <div id="accessCodeWrapper" style="display: none;">
    <input type="password" id="loginCode" placeholder="Enter Access Code" />
    <button id="toggleCodeBtn">üëÅ Reveal</button>
  </div>

  <button id="revealCodeBtn">Reveal Access Code Field</button>
  <button id="loginBtn">Log In</button>
  <div id="loginStatus" class="status pending" style="margin-top:8px"></div>
  
</section>

    <!-- First windows row (Farce-style live/manual submission look) -->
    <section class="windows" aria-label="Live submissions">
      <article class="window">
        <div class="tile">
          <div class="tile-art" aria-hidden="true"></div>
          <div class="tile-meta">
            <div class="tile-title">Midnight Static</div>
            <div class="tile-sub">Nova & The Wires</div>
            <span class="badge">New</span>
          </div>
        </div>
      </article>
      <article class="window">
        <div class="tile">
          <div class="tile-art" style="background:linear-gradient(135deg,#ff2d6b,#ffd87a)"></div>
          <div class="tile-meta">
            <div class="tile-title">Glass Rituals</div>
            <div class="tile-sub">Vera K.</div>
            <span class="badge">Live</span>
          </div>
        </div>
      </article>
      <article class="window">
        <div class="tile">
          <div class="tile-art" style="background:linear-gradient(135deg,#00e5ff,#0077ff)"></div>
          <div class="tile-meta">
            <div class="tile-title">Concrete Lullaby</div>
            <div class="tile-sub">Brutalist Choir</div>
            <span class="badge">Trending</span>
          </div>
        </div>
      </article>
      <article class="window">
        <div class="tile">
          <div class="tile-art" style="background:linear-gradient(135deg,#9bff5e,#2ed573)"></div>
          <div class="tile-meta">
            <div class="tile-title">Green Room Echoes</div>
            <div class="tile-sub">Staff Ensemble</div>
            <span class="badge">Exclusive</span>
          </div>
        </div>
      </article>
    </section>
<section id="billboard" class="billboard-row">
  <!-- Articles will be injected here -->
</section>

    <!-- Second windows row: chamber directory -->
    <section class="windows windows-dir" aria-label="Chamber directory">
      <article class="dir-card">
        <h3>üèõ Commerce</h3>
        <p>Purchased items, token logic, payment rails.</p>
        <a class="open" href="#commerce">Open chamber</a>
      </article>
      <article class="dir-card">
        <h3>‚öîÔ∏è Gamified</h3>
        <p>Quest rewards, symbolic tokens.</p>
        <a class="open" href="#gamified">Open chamber</a>
      </article>
      <article class="dir-card">
        <h3>ü§ù Community</h3>
        <p>Pooled contributions, generosity artifacts.</p>
        <a class="open" href="#community">Open chamber</a>
      </article>
      <article class="dir-card">
        <h3>‚úùÔ∏è Faith</h3>
        <p>Spiritual-only, prayer submission.</p>
        <a class="open" href="#faith">Open chamber</a>
      </article>
    </section>

    <!-- Chambers -->
    <section id="commerce" class="chamber frost">
      
      <div class="chamber-grid">
        <div class="info-panel">
          <div id="imgVoid" class="info-img frost-container">
  <!-- Frost overlay: visible until unlocked -->
  <div class="frost-overlay"></div>

  <!-- 3D Crystal Ring -->
  <div class="object-3d" aria-label="Crystal Ring">
    <div class="inner-rim"></div>

    <div class="ring-stack">
      <!-- Layer 1 (front) -->
      <svg viewBox="0 0 200 200" class="ring-layer layer-front" aria-hidden="true">
        <defs>
          <linearGradient id="gradFront" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#bdf2ff"/>
            <stop offset="35%"  stop-color="#9fe3ff"/>
            <stop offset="65%"  stop-color="#c8f7ff"/>
            <stop offset="100%" stop-color="#8bd7ff"/>
          </linearGradient>
          <radialGradient id="shineFront" cx="30%" cy="30%" r="70%">
            <stop offset="0%"   stop-color="rgba(255,255,255,0.9)"/>
            <stop offset="60%"  stop-color="rgba(255,255,255,0.15)"/>
            <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
          </radialGradient>
        </defs>
        <!-- ring via stroke width -->
        <circle cx="100" cy="100" r="60" stroke="url(#gradFront)" stroke-width="28" fill="none" stroke-linecap="round"/>
        <!-- soft shine overlay -->
        <circle cx="100" cy="100" r="62" fill="url(#shineFront)"/>
      </svg>

      <!-- Layer 2 (mid) -->
      <svg viewBox="0 0 200 200" class="ring-layer layer-mid" aria-hidden="true">
        <defs>
          <linearGradient id="gradMid" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#a4e9ff"/>
            <stop offset="35%"  stop-color="#c6f7ff"/>
            <stop offset="65%"  stop-color="#90ddff"/>
            <stop offset="100%" stop-color="#d6fbff"/>
          </linearGradient>
        </defs>
        <circle cx="100" cy="100" r="60" stroke="url(#gradMid)" stroke-width="26" fill="none" stroke-linecap="round" opacity="0.7"/>
      </svg>

      <!-- Layer 3 (back) -->
      <svg viewBox="0 0 200 200" class="ring-layer layer-back" aria-hidden="true">
        <defs>
          <linearGradient id="gradBack" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"   stop-color="#7ccfff"/>
            <stop offset="50%"  stop-color="#aee8ff"/>
            <stop offset="100%" stop-color="#6dc6ff"/>
          </linearGradient>
        </defs>
        <circle cx="100" cy="100" r="60" stroke="url(#gradBack)" stroke-width="24" fill="none" stroke-linecap="round" opacity="0.55"/>
      </svg>

      <!-- Facets: subtle crystalline segments -->
      <div class="facets">
        <span class="facet f1"></span>
        <span class="facet f2"></span>
        <span class="facet f3"></span>
        <span class="facet f4"></span>
        <span class="facet f5"></span>
      </div>
    </div>
  </div>
<div class="side-facets">
  <span class="side s1"></span>
  <span class="side s2"></span>
  <span class="side s3"></span>
  <span class="side s4"></span>
</div>

  <!-- Status -->
  <div class="object-status pending">Pending ‚Ä¢ Awaiting Prestige verification</div>
</div>

          <h4>üèõ Commerce Chamber</h4>
          <p>Pending credits shimmer silver until a Prestige member finalizes them to gold.</p>
          <p>Cart lists all available purchases, including token-related offerings.</p>
                  
        </div>
        <div class="chamber-grid">
        <div class="store-panel">
          <h4>Store</h4><div class="status pending">Pending verification</div><br>
          <div class="product-grid">
           <div class="product-card" onclick="addToCart('Crystal Ring', 20, 50, 'hybrid')">
  <div class="product-icon ring-crest"></div>
  <div class="product-meta">
    <div class="product-title">Crystal Ring</div>
    <div class="product-cost">üí∞ 20 purchased tokens</div>
    <div class="product-cost">‚ô¶Ô∏è 50 symbolic crystals</div>
    <div class="product-status pending">Pending Verification</div>
  </div>
  <div class="product-action">Click to add to cart</div>
</div>




              
            </div><br>
          
        <div class="chamber-grid">
            <div class="product-card" onclick="addToCart('Silver Necklace', 20)">
              <div class="product-title">Silver Necklace</div>
              <div class="price">üí∞ 30 purchased tokens</div><div class="status pending">Click to add to cart</div>
              
            </div>
            <div class="chamber-grid">
            <div class="product-card" onclick="addToCart('Braided Bracelet', 20)">
              <div class="product-title">Braided Bracelet</div>
              <div class="price">üí∞ 15 purchased tokens</div><div class="status pending">Click to add to cart</div>
              
            </div>
             <div class="chamber-grid"> 
           <div class="product-card" onclick="addToCart('Crest Charm', 20)">
              <div class="product-title">Crest Charm</div>
         <div class="price">üí∞ 10 purchased tokens</div>
              <div class="status pending">Click to add to cart</div>
              
            </div>
          </div>

 
</section>

    <section id="gamified" class="chamber frost">
  
      <div class="chamber-grid">
        <div class="info-panel">
          <div class="info-img" aria-hidden="true"></div>
          <h4>‚öîÔ∏è Gamified Chamber</h4>
          <p>Symbolic tokens are earned through quests and community actions (distinct from purchased tokens).</p>
        </div>
        <div class="store-panel">
          <h4>Rewards</h4>
          <div class="product-grid">
            <div class="product-card" onclick="addToCart('Quest Badge', 20, 5, 'hybrid')">
  <div class="product-icon Quest-Badge"></div>
  <div class="product-meta">
    <div class="product-title">Quest Badge</div>
    <div class="product-cost">üí∞ 20 purchased tokens</div>
    <div class="product-cost">‚ô¶Ô∏è 5 symbolic crystals</div>
    <div class="product-status pending">Pending Verification</div>
  </div>
  <div class="product-action">Click to add to cart</div>
</div>
            <div class="product-card">
              <div class="product-title">Mini‚Äëgame Medal</div>
              <div class="price">Cost: 8 symbolic tokens</div>
               <div class="price">Earns: 3 symbolic</div>
              <div class="status pending">Pending verification</div>
            </div>
            <div class="product-card">
              <div class="product-title">Challenge Scroll</div>
              <div class="price">Cost: 10 symbolic tokens</div>
              <div class="status pending">Pending verification</div>
            </div>
            <div class="product-card" data-task-id="habit-drink-water" data-type="habit" data-symbolic-reward="3" data-token-reward="1" data-habit-cooldown-ms="43200000">
  <div class="product-title">Drink Water</div>
  <div class="product-desc">Drink 8oz of water</div>
  <div class="price">Earns: 3 symbolic</div>
  <div class="status pending">Pending verification</div>
</div>


<div class="product-card" data-task-id="task-declutter" data-type="task" data-token-reward="8">
  <div class="product-title">Declutter Desk</div>
</div>

<div class="product-card" data-task-id="job-volunteer" data-type="job" data-token-reward="0">
  <div class="product-title">Volunteer Role</div>
</div>


          </div>
        </div>
      </div>
    </section>

    <section id="community" class="chamber frost">
     
      <div class="chamber-grid">
        <div class="info-panel">
          <div class="info-img" aria-hidden="true"></div>
          <h4>ü§ù Community Chamber</h4>
          <p>Pooled contributions and generosity artifacts are honored with symbolic tokens.</p>
          <ul style="margin:8px 0">
            <li>Volunteer hours (+6 symbolic)</li>
            <li>Smoke‚Äëfree challenge (+6 symbolic)</li>
            <li>Help a neighbor (+6 symbolic)</li>
            <li>Pooled contribution (+2 symbolic)</li>
          </ul>
        </div>
        <div class="store-panel">
          <h4>Artifacts</h4>
          <div class="product-grid">
            <div class="product-card">
              <div class="product-title">Community Crest</div>
              <div class="price">Cost: 6 symbolic tokens</div>
              <div class="status pending">Pending verification</div>
            </div>
            <div class="product-card">
              <div class="product-title">Generosity Ribbon</div>
              <div class="price">Cost: 7 symbolic tokens</div>
              <div class="status pending">Pending verification</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="faith" class="chamber frost">
      
      <div class="chamber-grid">
        <div class="info-panel">
          <div class="info-img" aria-hidden="true"></div>
          <h4>‚úùÔ∏è Faith Chamber</h4>
          <p>Spiritual‚Äëonly; submit prayer requests‚Äîno tokens are used here.</p>
          <div class="verse">Be kind to one another tenderhearted ‚Äî Ephesians 4:32</div>
        </div>
        <div class="store-panel">
          <h4>Prayer submission</h4>
          <input type="text" id="prayerInput" placeholder="Type your prayer here‚Ä¶" />
          <div class="controls" style="margin-top:8px">
            <button class="btn" id="submitPrayer">Submit prayer</button>
          </div>
          <div id="prayerLog" class="feed" style="margin-top:12px"></div>
        </div>
      </div>
    </section>

      
      
          
<!-- Cart Chamber -->
<section id="checkoutPanel" class="chamber frost" >
  <button class="checkout-btn">Checkout</button>
  <div class="chamber-grid">
    
    <!-- LEFT: Receipt viewer -->
    <div class="info-panel">
      <div class="info-img void" id="receiptViewer" aria-hidden="true"></div>
      <h4>üßæ Receipt Viewer</h4>
      <p>Finalized purchases glow gold. Pending shimmer silver until ledger confirmation.</p>
      <div id="receiptTotal">Total: 0 ü™ô + 0 ‚ô¶ </div>
      </div>
    
    

    <!-- RIGHT: Cart list -->
    <div class="store-panel">
      <h4>Cart & Checkout</h4>
      <div id="cartList" class="cart-list"></div>
      <button class="btn ghost-btn" onclick="emptyCart()">Empty Cart</button>
<br><br>
      <button class="btn finalize-btn" onclick="finalizeCart()">Finalize Purchases</button>
      <br><br>
    <button id="handoffBtn" class="btn">Send to Ledger</button><br></div>
 <!-- Payment rails and ritual flow -->
         <div class="checkout">
  
            
  <!-- HTML hooks (keep these where you already placed them) -->
<div class="prestige-slot-final" data-for-cod="true" id="prestigeSlotFinal">
  <div class="prestige-buzzer-wrap">
    <button class="prestige-buzzer center-over-tap" id="prestigeBuzzer" aria-label="Hail Prestige" title="Hail Prestige" style="--x:76px; --y:-10px">üîî</button>
    <div class="prestige-buzzer-label-final">Need help? Tap the buzzer</div>
  </div>

  <div class="prestige-widget-final prestige-hidden" id="prestigeWidgetFinal">
    <div style="font-weight:800">Hail Prestige ‚Äî Prefilled</div>
    <div class="row" style="margin-top:6px">
      <input id="pfName" class="input" placeholder="Your name (optional)" />
    </div>
    <div class="row">
      <input id="pfPhone" class="input" placeholder="Phone (optional)" />
    </div>
    <div>
      <input id="pfIssue" class="input" placeholder="Short issue description (optional)" />
    </div>
    <div class="prestige-small">You will confirm creation of a one‚Äëtime Jitsi room; Prestige members may take 15‚Äì30 minutes to respond.</div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="pfSendSms" class="send prestige-send">SMS</button>
      <button id="pfSendEmail" class="send prestige-send ghost">Email</button>
    </div>
  </div>
</div>

<!-- Hidden staff reply and modal/confirm (kept once in DOM) -->
<textarea id="prestigeHiddenStaffReply" style="display:none"></textarea>

<div class="prestige-modal" id="prestigeModal" aria-hidden="true">
  <div style="font-weight:800;margin-bottom:8px">Prefilled SMS text</div>
  <textarea id="prestigeSmsText" readonly></textarea>
  <div class="prestige-actions">
    <button id="copySms" class="prestige-btn ghost">Copy SMS</button>
    <button id="modalSendEmail" class="prestige-btn primary">Send Email</button>
    <button id="closeModal" class="prestige-btn ghost">Close</button>
  </div>
</div>

<div class="prestige-confirm" id="prestigeConfirm" style="display:none" aria-hidden="true">
  <div style="font-weight:800;margin-bottom:8px">Create one‚Äëtime Jitsi room?</div>
  <div class="prestige-small" style="margin-bottom:12px">This will create a one‚Äëtime Jitsi room and notify Prestige members by phone/email. Proceed?</div>
  <div style="display:flex;gap:8px;justify-content:flex-end">
    <button id="confirmCancel" class="prestige-btn ghost">Cancel</button>
    <button id="confirmProceed" class="prestige-btn primary">Proceed</button>
  </div>
</div>
           
           
</div>
    <br>
    <div class="rail">
    <div class="emblem-sigil prestige-pay"></div>
    <strong>Prestige Pay</strong>
    <p>Friendly flow. Finalization confirmed by ledger glow. Requires ceremonial desk approval.</p>
  </div>
   
  <div class="rail">
    <div class="emblem-sigil cod"></div>
    <strong>Cash on Delivery</strong>
    <p>Verified post-receipt. Status shimmer appears after member confirmation.</p>
  </div>
    <br>
  <div class="rail">
    <div class="emblem-sigil money-order"></div>
    <strong>Money Order</strong>
    <p>Accepted with pacing. Ledger updates once received and verified.</p>
  </div>
  <div class="rail">
    <div class="emblem-sigil chckout-cart"></div>
    <strong>Checkout Cart</strong>
    <p>View all pending purchases. Shimmer silver until finalized by Prestige member.</p>
  </div>
  </div>
</section>
      
     
    
          
          
    <form id="loveform" style="display:none" method="POST" target="hidden_iframe" action="">
  <textarea id="loveform_items_list" name="items_list"></textarea>
  <textarea id="loveform_receipt_text" name="receipt_text"></textarea>
  <input type="hidden" id="loveform_items_json" name="items_json" value="" />
  <input type="hidden" id="loveform_username" name="username" value="" />
  <input type="hidden" id="loveform_email" name="email" value="" />
  <input type="hidden" id="loveform_accessCode" name="accessCode" value="" />
</form>

<iframe name="hidden_iframe" style="display:none" aria-hidden="true"></iframe>


      
      
      
    <!-- Live feed + reflection + community ad -->
    <section class="lower">
      <div class="panel-lite">
        <h4 style="margin:6px 0 10px">Live updates</h4>
        <div id="liveFeed" class="feed">
          <div class="feed-item">üõç Crystal Ring purchase requested (Commerce) ‚Äî pending shimmer</div>
          <div class="feed-item">‚öîÔ∏è Quest completed: Submit grades (+5 symbolic)</div>
          <div class="feed-item">‚úùÔ∏è Prayer submitted: ‚ÄúGuide me in patience.‚Äù</div>
        </div>
      </div>
      <div class="panel-lite">
        <h4 style="margin:6px 0 10px">Reflection</h4>
        <div id="reflectionBox" class="ad">What effort today felt honest and steady?</div>
        <h4 style="margin:14px 0 10px">Community ad</h4>
        <div id="communityAd" class="ad">Neighbors Helping Neighbors ‚Äî pledge board rotates every 6 hours.</div>
      </div>
    </section>

      
      
  
      
      
      
      
    <!-- Directory back controls -->
    <section class="controls" style="margin-top:16px">
      <a class="btn" href="#">Back to top</a>
      <button class="btn" onclick="showChamber('')">Reset chambers</button>
    </section>

      
    <!-- Cart button already in token-box -->



      
      
  </div>

 
      
<nav class="mobile-nav">
  <button onclick="showPanel('commerce')">Commerce</button>
  <button onclick="showPanel('gamified')">Gamified</button>
  <button onclick="showPanel('community')">Community</button>
  <button onclick="showPanel('faith')">Faith</button>
</nav>




   
      
  <script>
    // Static reveal via class toggling (.active). Anchors also work.
    function showChamber(id){
      const ids = ['commerce','gamified','community','faith','checkoutPanel'];
      ids.forEach(x => {
        const el = document.getElementById(x);
        if(!el) return;
        if (id === x) { el.classList.add('active'); location.hash = '#' + id; }
        else { el.classList.remove('active'); }
      });
      if (!id) { history.pushState('', document.title, window.location.pathname + window.location.search); }
    }

    // Verse rotation every 30s (placeholder-ready for live JSON)
    const verses = [
  "Let all that you do be done in love ~ 1 Corinthians 16:14",
  "Be kind to one another ~ tenderhearted ~ Ephesians 4:32",
  "Walk by faith not by sight ~ 2 Corinthians 5:7",
  "The Lord is my shepherd I shall not want ~ Psalm 23:1",
  "I can do all things through Christ who strengthens me ~ Philippians 4:13",
  "Trust in the Lord with all your heart ~ Proverbs 3:5",
  "Do not be anxious about anything ~ Philippians 4:6",
  "Love your neighbor as yourself ~ Matthew 22:39",
  "Rejoice always ~ pray without ceasing ~ 1 Thessalonians 5:16-17",
  "The joy of the Lord is your strength ~ Nehemiah 8:10",
  "Create in me a clean heart ~ Psalm 51:10",
  "Blessed are the peacemakers ~ Matthew 5:9",
  "Your word is a lamp to my feet ~ Psalm 119:105",
  "He has made everything beautiful in its time ~ Ecclesiastes 3:11",
  "Be still and know that I am God ~ Psalm 46:10",
  "Let your light shine before others ~ Matthew 5:16",
  "Cast all your cares on Him ~ 1 Peter 5:7",
  "The Lord is my strength and my shield ~ Psalm 28:7",
  "In everything give thanks ~ 1 Thessalonians 5:18",
  "The steadfast love of the Lord never ceases ~ Lamentations 3:22"
];
    let v = 0;
    setInterval(() => {
      v = (v + 1) % verses.length;
      const box = document.getElementById('dailyVerse');
      if (box) box.textContent = verses[v];
    }, 30000);

    // Reflection rotation every 45s
    const reflections = [
  "Where can you slow down and show care?",
  "Does this purchase align with your values right now?",
  "Would gifting this bring someone meaningful joy?",
  "What patience do you want to practice today?",
  "What effort today felt honest and steady? ~",
  "Who have you checked in on this week? ~",
  "Is there a small kindness you‚Äôve overlooked? ~",
  "What are you grateful for in this moment? ~",
  "What intention do you want to carry forward? ~",
  "Where did you feel most present today? ~",
  "What would generosity look like right now? ~",
  "Is there someone who needs your quiet support? ~",
  "What part of your day felt sacred? ~",
  "What are you resisting that might deserve grace? ~",
  "How can you honor your limits with kindness? ~",
  "What gesture could restore someone‚Äôs peace? ~",
  "Where did you notice beauty today? ~",
  "What truth are you ready to speak gently? ~",
  "What does integrity look like in this moment? ~",
  "How can you soften your pace without losing purpose? ~",
  "What would it mean to lead with compassion today? ~"
];

    setInterval(() => {
      const idx = Math.floor(Math.random() * reflections.length);
      const el = document.getElementById('reflectionBox');
      if (el) el.textContent = reflections[idx];
    }, 45000);

    // Community ad placeholder rotation every 6 hours
    const ads = [
  "Neighbors Helping Neighbors ~ pledge board updates at dusk.",
  "Community Crest Night ~ shared table, shared honor.",
  "Volunteer Circle ~ add your hour, lift someone‚Äôs week.",
  "Quiet Generosity ~ small acts, steady light.",
  "Token Harvest ~ every kindness counts toward the collective bloom.",
  "Prestige Pledge Hour ~ log your vow, light the chamber.",
  "Shared Lantern Walk ~ one step, one glow, one bond.",
  "Kindness Ledger ~ record your ripple, honor the wave.",
  "Crest Exchange ~ trade tokens for warmth and witness.",
  "Silent Sigil Drop ~ anonymous gifts, visible impact.",
  "Unity Scroll ~ sign your name, seal the moment.",
  "Generosity Pulse ~ chamber lights shift with each act.",
  "Echo Chamber ~ your kindness echoes through the grid.",
  "Prestige Pantry ~ contribute quietly, receive openly.",
  "Civic Bloom ~ every gesture grows the shared garden.",
  "Token Tribute ~ honor someone with symbolic light.",
  "Community Weave ~ threads of care form the tapestry.",
  "Midnight Offering ~ late pledges shimmer with extra grace.",
  "Shared Ember ~ one spark passed, many warmed.",
  "Crest Reflection ~ review your impact, renew your vow.",
  "Kindness Relay ~ pass the gesture, extend the glow.",
  "Prestige Beacon ~ top contributors light the chamber crest."
];

    setInterval(() => {
      const idx = Math.floor(Math.random() * ads.length);
      const el = document.getElementById('communityAd');
      if (el) el.textContent = ads[idx];
    }, 6 * 60 * 60 * 1000);

    // Prayer submission (front-end only; hook to Sheets JSON in production)
    document.getElementById('submitPrayer')?.addEventListener('click', () => {
      const input = document.getElementById('prayerInput');
      const log = document.getElementById('prayerLog');
      const text = (input?.value || '').trim();
      if (!text) return;
      const ts = new Date().toLocaleString();
      const item = document.createElement('div');
      item.className = 'feed-item';
      item.textContent = `üïä ${text} ‚Äî ${ts}`;
      log?.prepend(item);
      input.value = '';
      // In production: POST to Google Apps Script ‚Üí Sheet; live feed pulls JSON
    });

    // Token counters: JSON hooks (no local placeholders in prod)
    async function loadLedger(){
      // Replace with your Apps Script JSON endpoint(s)
      // Example: const url = 'https://script.google.com/macros/s/XXXX/exec';
      // const res = await fetch(url, {cache:'no-store'}); const data = await res.json();
      // document.getElementById('purchasedCount').textContent = data.purchased;
      // document.getElementById('symbolicCount').textContent = data.symbolic;
    }
    // Call on load (disabled until endpoints provided)
    // loadLedger();

    // Cart button ‚Üí opens Commerce chamber
    document.getElementById('cartBtn')?.addEventListener('click', () => showChamber('checkoutPanel'));

    // On anchor navigation, ensure class toggling matches :target
    window.addEventListener('hashchange', () => {
      const id = (location.hash || '').replace('#','');
      if (['commerce','gamified','community','faith','checkoutPanel'].includes(id)) showChamber(id);
    });

    // Initial hash activation if present
    (function initFromHash(){
      const id = (location.hash || '').replace('','');
      if (['commerce','gamified','community','faith','checkoutPanel'].includes(id)) showChamber(id);
    })();
    
    
   </script><script>

(function(){
  const feed = document.getElementById('liveFeed');
  const samples = [
    'üèõ Purchase finalized: Silver Necklace',
    '‚öîÔ∏è Quest completed: Birthday bonus (+5 symbolic)',
    'ü§ù Contribution added: Help a neighbor (+2 symbolic)',
    '‚úùÔ∏è Prayer submitted: ‚ÄúStrength for tomorrow.‚Äù'
  ];
  let s = 0;

  setInterval(()=>{
    const item = document.createElement('div');
    item.className = 'feed-item';

    // Generate timestamp
    const now = new Date();
    const ts = now.toLocaleString(); // e.g. "11/13/2025, 6:45:12 PM"

    item.innerHTML = `<span>${samples[s % samples.length]}</span><small>${ts}</small>`;
    feed.prepend(item); // keep feed tidy
    if(feed.children.length > 6) feed.lastElementChild.remove();

    // cycle sample index
    s++;
  }, 60000); // every 1 minute
})();
</script>

   
<script>
(function(){
  const billboard = document.getElementById('billboard');
  const entries = [
    {
      title: "Midnight Static",
      sub: "Nova & The Wires",
      badge: "NEW",
      image: "#1a1a1a"
    },
    {
      title: "Glass Rituals",
      sub: "V√©ra K.",
      badge: "LIVE",
      image: "#ff2d6b"
    },
    {
      title: "Concrete Lullaby",
      sub: "Brutalist Choir",
      badge: "TRENDING",
      image: "#0077ff"
    },
    {
      title: "Green Room Echoes",
      sub: "Staff Ensemble",
      badge: "EXCLUSIVE",
      image: "#2ed573"
    }
  ];
  let i = 0;

  setInterval(() => {
    const e = entries[i % entries.length];
    const article = document.createElement('article');
    article.className = 'billboard-article';
    article.innerHTML = `
      <div class="billboard-image" style="background:${e.image}"></div>
      <div class="billboard-title">${e.title}</div>
      <div class="billboard-sub">${e.sub}</div>
      <span class="badge">${e.badge}</span>
    `;
    billboard.prepend(article);
    if (billboard.children.length > 4) billboard.lastElementChild.remove();
    i++;
  }, 15000); // every 8 seconds
})();
</script>
<script>
function unlockItem(id, className, cost){
  const card = document.getElementById(id);
  if (!card) return;

  card.classList.remove('locked');
  card.classList.add('unlocked');

  const veil = card.querySelector('.frost-veil');
  if (veil) veil.style.display = 'none';

  const status = card.querySelector('.object-status');
  if (status){
    status.textContent = 'Unlocked ‚Ä¢ Awaiting member finalization';
    status.classList.remove('pending');
    status.classList.add('finalized');
  }

  card.setAttribute('onclick', `displayInViewer('${className}', '${card.querySelector('.object-title').textContent}')`);
}
function displayInViewer(className, title){
  const viewer = document.querySelector('#commerce .info-img');
  viewer.className = 'info-img ' + className;
  viewer.setAttribute('aria-label', title);
}
  
  
</script>



<script>
let cartTokenTotal = 0, cartCrystalTotal = 0, cartItems = 0;

function addToCart(name, tokenCost, crystalCost, type){
  const cart = document.getElementById('cartList');
  const item = document.createElement('div');
  item.className = 'cart-item shimmer';
  item.innerHTML = `
    <div class="cart-title">${name}</div>
    ${type !== 'crystal' ? `<div>üí∞ ${tokenCost} purchased tokens</div>` : ''}
    ${type !== 'token' ? `<div>‚ô¶Ô∏è ${crystalCost} symbolic crystals</div>` : ''}
    <div class="cart-status">Pending ‚Ä¢ Awaiting Prestige verification</div>
  `;
  cart.appendChild(item);

  if (type !== 'crystal') cartTokenTotal += tokenCost;
  if (type !== 'token') cartCrystalTotal += crystalCost;

  cartItems += 1;
  updateCartDisplay();
}

function updateCartDisplay(){
  const badge = document.getElementById('cartCount');
  const floatBadge = document.getElementById('floatingCartCount');
  const total = document.getElementById('receiptTotal');

  if (badge) badge.textContent = cartItems;
  if (floatBadge) floatBadge.textContent = cartItems;
  if (total) total.textContent = `Total: ${cartTokenTotal} ü™ô + ${cartCrystalTotal} <üî¥>`;
}

function finalizeCart(){
  const viewer = document.getElementById('receiptViewer');
  if (viewer) {
    viewer.className = 'info-img shimmer';
    viewer.innerHTML = `<div class="receipt-confirm">üßæ Submitted ‚Ä¢ ${cartTokenTotal} ü™ô + ${cartCrystalTotal} <üî¥><br>Awaiting Prestige verification</div>`;
  }
(document.getElementById('confirmFinalizeBtn')||document.querySelector('.finalize-btn')||document.querySelector('[data-finalize-btn]')||document.querySelector('button.finalize-btn')).addEventListener('click', ()=>window.promptAndConsumeAccessCode());

  document.querySelectorAll('.cart-item').forEach(item => {
    item.classList.add('shimmer');
    item.classList.remove('finalized');
    
    const s = item.querySelector('.cart-status');
    if (s) s.textContent = 'Pending ‚Ä¢ Awaiting Prestige verification';
  });

  // Do NOT deduct balances yet‚Äîwait for sheet confirmation
  cartTokenTotal = 0;
  cartCrystalTotal = 0;
  cartItems = 0;
  updateCartDisplay();
}

function emptyCart(){
  const cart = document.getElementById('cartList');
  if (cart) cart.innerHTML = '';
  cartTokenTotal = 0;
  cartCrystalTotal = 0;
  cartItems = 0;
  updateCartDisplay();

  const viewer = document.getElementById('receiptViewer');
  if (viewer){
    viewer.className = 'info-img void';
    viewer.innerHTML = '';
  }

  const total = document.getElementById('receiptTotal');
  if (total) total.textContent = `Total: 0 ü™ô + 0 <üî¥>`;
}

</script>
<script>
// --- Utility: parse Google Sheets GViz JSON ---
async function loadSheet(sheetName){
  const url = `https://docs.google.com/spreadsheets/d/1Gppnlp80FqgOzeUERsSmLp5pZ4E9tvhfbt22NKtUbk8/gviz/tq?sheet=${sheetName}&tqx=out:json`;
  const res = await fetch(url);
  const text = await res.text();
  const json = JSON.parse(text.substr(47).slice(0, -2));
  return json.table.rows.map(r => r.c.map(c => c ? c.v : ""));
}

// --- COMMUNITY drip feed ---
let communityRows = [], communityIndex = 0;
async function initCommunityFeed(){
  communityRows = await loadSheet("Community");
  communityIndex = 0;
  revealNextCommunity();
  setInterval(revealNextCommunity, 60000); // one every 60s
}
function revealNextCommunity(){
  if (communityIndex >= communityRows.length) return;
  const r = communityRows[communityIndex];
  const box = document.getElementById("liveFeed");
  if (!box) return;
  const el = document.createElement("div");
  el.className = "feed-item fadeSlide"; // fade-in refinement
  el.textContent = `ü§ù ${r[0]}  ${r[1]} ${r[2] ? "(" + r[2] + ")" : ""}`;
  box.prepend(el);
  // keep last 6 visible
  while (box.children.length > 6) box.removeChild(box.lastChild);
  communityIndex++;
}

// --- ADS drip feed ---
let adsRows = [], adsIndex = 0;
async function initAdsFeed(){
  adsRows = await loadSheet("Ads");
  adsIndex = 0;
  revealNextAd();
  setInterval(revealNextAd, 45000); // one every 45s
}
function revealNextAd(){
  if (adsRows.length === 0) return;
  const r = adsRows[adsIndex % adsRows.length]; // loop refinement
  const board = document.getElementById("billboard");
  if (!board) return;
  const article = document.createElement("article");
  article.className = "billboard-article fadeSlide";
  article.innerHTML = `
    <div class="billboard-image"></div>
    <div class="billboard-title">${r[0]}</div>
    <div class="billboard-sub">${r[1]} ${r[2] ? "(" + r[2] + ")" : ""}</div>
    <span class="badge">AD</span>
  `;
  board.prepend(article);
  while (board.children.length > 4) board.removeChild(board.lastChild);
  adsIndex++;
}

// --- FAITH drip feed ---
let faithRows = [], faithIndex = 0;

async function initFaithFeed(){
  faithRows = await loadSheet("Faith");
  faithIndex = 0;
  revealNextFaith();
  setInterval(revealNextFaith, 45000); // one every 45s
}

function revealNextFaith(){
  if (faithRows.length === 0) return;
  const r = faithRows[faithIndex % faithRows.length];
  const log = document.getElementById("prayerLog");
  if (!log) return;

  const el = document.createElement("div");
  el.className = "feed-item fadeSlide";

  // richer markup with badge
  el.innerHTML = `
    <div class="faith-title">üïä ${r[0]}</div>
    <div class="faith-message">${r[1]} ${r[2] ? "(" + r[2] + ")" : ""}</div>
    <span class="badge">FAITH</span>
  `;

  log.prepend(el);

  // keep only last 6 prayers visible
  while (log.children.length > 6) {
    log.removeChild(log.lastChild);
  }

  faithIndex++;
}

// --- Initialize all feeds ---
document.addEventListener("DOMContentLoaded", () => {
  initCommunityFeed();
  initAdsFeed();
  initFaithFeed();
});
</script>
<script>
// Attach hover preview + cart logic to all product cards
document.addEventListener("DOMContentLoaded", () => {
  const info = document.getElementById("infoImg"); // the void preview panel
  const cartCountEl = document.getElementById("cartCount");
  const cartLog = document.getElementById("cartLog");

  let cartCount = 0;

  document.querySelectorAll(".product-card").forEach(card => {
    const titleEl = card.querySelector(".product-title");
    const title = titleEl ? titleEl.textContent : "Item";

    // Hover preview
    card.addEventListener("mouseenter", () => {
      if (info){
        info.style.backgroundImage = "url('/assets/" + title.toLowerCase().replace(/\s+/g,'-') + ".png')";
        info.style.backgroundSize = "cover";
        info.style.backgroundPosition = "center";
        info.classList.add("glow");
      }
    });
    card.addEventListener("mouseleave", () => {
      if (info){
        info.style.backgroundImage = "";
        info.classList.remove("glow");
      }
    });

    // Click ‚Üí add to cart
    card.addEventListener("click", () => {
      cartCount++;
      if (cartCountEl) cartCountEl.textContent = cartCount;

      if (cartLog){
        const item = document.createElement("div");
        item.className = "feed-item fadeSlide";
        item.textContent = `üõí Added: ${title}`;
        cartLog.prepend(item);
        while (cartLog.children.length > 5) cartLog.lastChild.remove();
      }
    });
  });
});
  
  
</script>
<div id="floatingCart" class="floating-cart frost">
  üõí <span id="floatingCartCount">0</span> items
  <button class="ghost-btn" onclick="showChamber('checkoutPanel')">Checkout</button>
</div>
</script><script>
// --- Config: set your Sheet ID and GID (tab ID) ---
const SHEET_ID = "2PACX-1vQ4o3D2FZ3wrqNxhsgv9shjeulUmqb5Uo0hhJK7axuEpUNPxEk7bgmrVqO-PGvUjZfXtHPt1lhWL2XR";
const GID = "0"; // replace with your tab's gid

// --- Fetch live registry from gviz JSON ---
async function fetchRegistry(){
  const res = await fetch("https://docs.google.com/spreadsheets/d/1eskbyxg5KOvTyOb68_Zdt5W1YeyfOuvBABqnMBN79xM/gviz/tq?tqx=out:json&gid=0");
  const text = await res.text();
  const json = JSON.parse(text.substring(47).slice(0, -2));
  const rows = json.table.rows;

  return rows
    .filter(r => r.c && r.c[0]?.v && r.c[1]?.v) // require User and AccessCode
    .map(r => ({
      user:        r.c[0]?.v ?? "",
      accessCode:  r.c[1]?.v ?? "",
      card:        r.c[2]?.v ?? "",
      purchased:   r.c[3]?.v ?? "0",
      symbolic:    r.c[4]?.v ?? "0",
      transaction: r.c[5]?.v ?? "",
      status:      r.c[6]?.v ?? "Pending"
    }));
}

// --- Cart sync helper (use the user object from the sheet) ---
function syncCartFromUser(u, opts = { resetCartCountOnLogin: false }){
  if(!u) return;
  // ensure session identity is set
  sessionStorage.setItem('activeAccountId', u.accessCode || u.card || u.user);
  window.currentUserId = sessionStorage.getItem('activeAccountId');

  // header counters
  const purchasedEl = document.getElementById('purchasedCount');
  const symbolicEl  = document.getElementById('symbolicCount');
  if(purchasedEl) purchasedEl.textContent = Number(u.purchased || 0);
  if(symbolicEl)  symbolicEl.textContent  = Number(u.symbolic || 0);

  // floating cart / checkout balance rows
  document.querySelectorAll('.floating-cart, .checkout-cart').forEach(container => {
    let row = container.querySelector('.cart-balance-row');
    if(!row){
      row = document.createElement('div');
      row.className = 'cart-balance-row';
      row.style.marginTop = '6px';
      row.style.fontSize = '0.95rem';
      row.style.color = 'var(--muted)';
      row.style.display = 'flex';
      row.style.gap = '10px';
      container.appendChild(row);
    }
    row.innerHTML = `<div><strong>Purchased</strong>: <span class="cart-bal-tokens">${Number(u.purchased||0)}</span></div>
                     <div><strong>Symbolic</strong>: <span class="cart-bal-symbolic">${Number(u.symbolic||0)}</span></div>`;
  });

  // optional: reset cart item counters on login
  if(opts.resetCartCountOnLogin){
    const cartCount = document.getElementById('cartCount');
    const floatBadge = document.getElementById('floatingCartCount');
    if(cartCount) cartCount.textContent = '0';
    if(floatBadge) floatBadge.textContent = '0';
  }
}

// --- Validate login against live sheet ---
async function loginUser(e){
  e?.preventDefault?.();
  const username = document.getElementById("loginUser").value.trim();
  const code = document.getElementById("loginCode").value.trim();
  const statusEl = document.getElementById("loginStatus");

  statusEl.textContent = "‚Ä¶ Checking access code";
  statusEl.className = "status pending";

  const registry = await fetchRegistry();
  const match = registry.find(r => r.accessCode === code && r.user === username);

  if (match){
    sessionStorage.setItem("username", match.user);
    sessionStorage.setItem("accessCode", match.accessCode);

    statusEl.textContent = "‚úÖ Login successful";
    statusEl.className = "status finalized";

    document.getElementById("userDirectory")?.classList.add("active");
    document.getElementById("loginPanel")?.classList.remove("active");

    // render user card and sync cart immediately
    await renderUserCard(); // pulls live from sheet and updates DOM
    // ensure cart mirrors the same user object (reset cart count on login)
    syncCartFromUser(match, { resetCartCountOnLogin: true });
  } else {
    statusEl.textContent = "‚úó INVALID USERNAME OR ACCESS CODE";
    statusEl.className = "status pending";
  }
}

// --- Lookup user by access code (from live feed) ---
async function getUserByAccessCode(code){
  const accounts = await fetchRegistry();
  return accounts.find(acc => String(acc.accessCode).trim() === String(code).trim()) || null;
}

// --- Render user card (after login or retrieve) ---
async function renderUserCard(){
  const username = sessionStorage.getItem("username");
  const code = sessionStorage.getItem("accessCode");
  if (!username || !code) return;

  const u = await getUserByAccessCode(code);
  if (!u) return;

  const grid = document.querySelector("#userDirectory .user-grid");
  if (!grid) return;

  grid.innerHTML = `
    <div class="user-card frost" data-user-id="${u.accessCode || u.card || u.user}">
      <div class="crest-avatar"></div>
      <div class="user-meta">
        <div class="account-name">${u.user}</div>
        <div class="card-id">PrestigePayCard: ${u.card}</div>
        <div class="token-balance">ü™ô ${u.purchased} | ‚ô¶Ô∏è ${u.symbolic}</div>
        <div class="last-transaction ${u.status==="Finalized"?"glow-gold":"glow-silver"}">
          ${u.transaction || "‚Äî"}
        </div>
      </div>
    </div>
  `;

  const purchasedEl = document.getElementById("purchasedCount");
  const symbolicEl  = document.getElementById("symbolicCount");
  if (purchasedEl) purchasedEl.textContent = u.purchased;
  if (symbolicEl)  symbolicEl.textContent  = u.symbolic;

  // Sync cart and floating UI to match this user immediately
  syncCartFromUser(u, { resetCartCountOnLogin: false });
}

// --- Render full ledger table ---
async function renderLedger(){
  const accounts = await fetchRegistry();
  const grid = document.getElementById("ledgerGrid");
  if (!grid) return;

  grid.innerHTML = `
    <table class="prestige-sheet">
      <tr><th>User</th><th>Card</th><th>Purchased</th><th>Symbolic</th><th>Transaction</th><th>Status</th></tr>
      ${accounts.map(u => `
        <tr>
          <td>${u.user}</td>
          <td>${u.card}</td>
          <td>${u.purchased}</td>
          <td>${u.symbolic}</td>
          <td>${u.transaction}</td>
          <td class="${u.status==="Finalized"?"glow-gold":"glow-silver"}">${u.status}</td>
        </tr>`).join("")}
    </table>
  `;
}

// --- Wiring ---
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("loginBtn")?.addEventListener("click", loginUser);
  document.getElementById("loginCode")?.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginUser(e);
  });

  document.getElementById("retrieveBtn")?.addEventListener("click", renderUserCard);

  document.getElementById("logoutBtn")?.addEventListener("click", () => {
    sessionStorage.clear();
    document.getElementById("userDirectory")?.classList.remove("active");
    document.getElementById("loginPanel")?.classList.add("active");
    renderLedger();
    // clear header/cart balances on logout
    const purchasedEl = document.getElementById("purchasedCount");
    const symbolicEl  = document.getElementById("symbolicCount");
    if (purchasedEl) purchasedEl.textContent = '0';
    if (symbolicEl)  symbolicEl.textContent  = '0';
    const cartCount = document.getElementById('cartCount');
    const floatBadge = document.getElementById('floatingCartCount');
    if(cartCount) cartCount.textContent = '0';
    if(floatBadge) floatBadge.textContent = '0';
    // clear floating cart balance rows
    document.querySelectorAll('.cart-balance-row').forEach(r => r.remove());
  });
});

// --- On load: show ledger only ---
window.onload = () => {
  renderLedger();
  const loginPanel = document.getElementById("loginPanel");
  if (loginPanel) loginPanel.classList.add("active", "frost");

  // If session exists, sync cart from that user on page load
  const code = sessionStorage.getItem('accessCode');
  if (code) {
    getUserByAccessCode(code).then(u => { if(u) syncCartFromUser(u, { resetCartCountOnLogin: false }); });
  }
};

// --- Polling: refresh every 15s ---
setInterval(() => {
  renderLedger();
  renderUserCard();
}, 15000);

// Safety: ensure status element updates (defensive)
try {
  const status = document.getElementById('loginStatus');
  if (status) {
    status.classList.remove('pending');
    status.classList.add('finalized');
    status.textContent = '‚úÖ Finalized in Prestige Ledger';
  }
} catch(e){ /* ignore if not present */ }
          
          
   
          
</script>


  <script>
document.getElementById("logoutBtn")?.addEventListener("click", () => {
  sessionStorage.clear();

  // Reset token counters
  const purchasedEl = document.getElementById("purchasedCount");
  const symbolicEl  = document.getElementById("symbolicCount");
  if (purchasedEl) purchasedEl.textContent = "0";
  if (symbolicEl)  symbolicEl.textContent  = "0";

  // Update status message
  const statusEl = document.getElementById("loginStatus");
  if (statusEl){
    statusEl.textContent = "‚úÖ Logout successful";
    statusEl.className = "status finalized";
  }

  document.getElementById("userDirectory")?.classList.remove("active");
  document.getElementById("loginPanel")?.classList.add("active");

  renderLedger();
});
document.addEventListener("DOMContentLoaded", () => {
  // Reveal access code input field
  document.getElementById("revealCodeBtn")?.addEventListener("click", () => {
    document.getElementById("accessCodeWrapper").style.display = "block";
    document.getElementById("revealCodeBtn").style.display = "none";
  });

  // Toggle visibility of access code characters
  document.getElementById("toggleCodeBtn")?.addEventListener("click", () => {
    const codeInput = document.getElementById("loginCode");
    const isMasked = codeInput.type === "password";
    codeInput.type = isMasked ? "text" : "password";
    document.getElementById("toggleCodeBtn").textContent = isMasked ? "üôà Hide" : "üëÅ Reveal";
  });

  // Login logic
  document.getElementById("loginBtn")?.addEventListener("click", loginUser);
  document.getElementById("loginCode")?.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginUser(e);
  });
});
// Unlock: remove frost (visual reveal), maintain pending state
function unlockFrostedObject(){
  const veil = document.querySelector('#imgVoid .frost-overlay');
  if (veil) veil.style.display = 'none';

  const status = document.querySelector('#imgVoid .object-status');
  if (status){
    status.textContent = 'Unlocked ‚Ä¢ Awaiting member finalization';
    status.classList.remove('finalized');
    status.classList.add('pending');
  }
}

// Apply finalized state only when sheet confirms
function applyFinalizedState(){
  const container = document.getElementById('imgVoid');
  const status = container?.querySelector('.object-status');
  if (container) container.classList.add('finalized');
  if (status){
    status.textContent = '‚úÖ Finalized in Prestige Ledger';
    status.classList.remove('pending');
    status.classList.add('finalized');
  }
}

// Optional: parallax hover for live presence
(function attachParallax(){
  const container = document.getElementById('imgVoid');
  const stack = container?.querySelector('.ring-stack');
  if (!container || !stack) return;

  let hovering = false;
  const base = 'translate(-50%, -50%)';

  container.addEventListener('mousemove', (e) => {
    hovering = true;
    const r = container.getBoundingClientRect();
    const x = ((e.clientX - r.left) / r.width - 0.5) * 12;   // yaw
    const y = ((e.clientY - r.top) / r.height - 0.5) * -10;  // pitch
    stack.style.animation = 'none'; // pause float/spin on hover
    stack.style.transform = `${base} rotateX(${y}deg) rotateY(${x}deg)`;
  });

  container.addEventListener('mouseleave', () => {
    hovering = false;
    stack.style.transform = '';
    stack.style.animation = 'floatY 4.2s ease-in-out infinite, slowSpin 14s linear infinite';
  });
})();
function showPanel(panelId) {
  document.querySelectorAll('.chamber-panel').forEach(p => {
    p.classList.remove('active');
  });
  document.getElementById(panelId).classList.add('active');
}
document.querySelectorAll('.billboard').forEach((bb, i) => {
  bb.style.animationDelay = `${i * 0.2}s`; // stagger each billboard
});

</script>

<script>
/* Populate hidden username/email from directory card into #loveform fields */
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('loveform');
  if (!form) return;

  // Try common directory selectors; prefer data attributes if present
  const dirCard = document.querySelector('#userDirectory .user.active') || document.querySelector('#userDirectory .user') || document.querySelector('#userDirectory');
  let name = '', email = '';

  if (dirCard) {
    name = dirCard.getAttribute('data-username') || dirCard.querySelector('.account-name')?.textContent?.trim() || dirCard.querySelector('.user-name')?.textContent?.trim() || '';
    email = dirCard.getAttribute('data-email') || dirCard.querySelector('.account-email')?.textContent?.trim() || '';
  }

  // Fallbacks: sessionStorage or login input
  if (!name) name = sessionStorage.getItem('username') || document.getElementById('loginUser')?.value || '';
  if (!email) email = sessionStorage.getItem('userEmail') || '';

  // Write into hidden form fields
  const u = document.getElementById('loveform_username');
  const e = document.getElementById('loveform_email');
  if (u) u.value = name;
  if (e) e.value = email;
});
</script>

<script>

/* Robust prompt-and-consume helper
   - Exposes: setOneTimeAccessCode(code), addOneTimeCode(code), promptAndConsumeAccessCode()
   - Reads/writes obf at static_one_time_obf and keeps an internal records array
   - Auto-attaches to confirm buttons and always prompts when triggered
*/
(function(){
  const KEY_OBF = 'static_one_time_obf';
  const KEY_RECORDS = 'static_one_time_records_simple';
  const KEY_USED = 'static_one_time_used_simple';
  const VALID_MS = 24 * 60 * 60 * 1000;

  // small safety so reloading this script won't double-attach
  if(window.__oneTimeHelperLoaded) return;
  window.__oneTimeHelperLoaded = true;

  // --- crypto helper
  async function sha256Hex(text){
    const enc = new TextEncoder().encode(String(text));
    const d = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(d)).map(b=>b.toString(16).padStart(2,'0')).join('');
  }

  // --- obf helpers (same scheme you used)
  function b64(s){ return btoa(s); }
  function unb64(s){ try { return atob(s); } catch(e){ return null; } }
  function obfFromHashes(hashes){
    return hashes.map(h=>{
      const chunks = (h.match(/.{1,8}/g) || []);
      return b64(chunks.reverse().join(''));
    }).join('|');
  }
  function hashesFromObf(payload){
    if(!payload) return [];
    return payload.split('|').map(p=>{
      const rev = unb64(p);
      if(!rev) return null;
      const chunks = rev.match(/.{1,8}/g) || [];
      return chunks.reverse().join('');
    }).filter(Boolean);
  }

  // --- storage helpers
  function loadRecords(){
    try { return JSON.parse(localStorage.getItem(KEY_RECORDS) || '[]'); } catch(e){ return []; }
  }
  function saveRecords(arr){
    localStorage.setItem(KEY_RECORDS, JSON.stringify(arr || []));
    // keep obf in sync for portability
    const raw = (arr || []).filter(r => !r.usedAt).map(r => r.hash);
    localStorage.setItem(KEY_OBF, raw.length ? obfFromHashes(raw) : '');
  }
  function loadUsed(){ try { return JSON.parse(localStorage.getItem(KEY_USED) || '[]'); } catch(e){ return []; } }
  function saveUsed(arr){ localStorage.setItem(KEY_USED, JSON.stringify(arr || [])); }

  // hydrate from obf if records empty
  (function hydrate(){
    const recs = loadRecords();
    if(recs.length) return;
    const obf = localStorage.getItem(KEY_OBF) || '';
    if(!obf) return;
    const raw = hashesFromObf(obf);
    const now = new Date().toISOString();
    const records = raw.map(h => ({ hash: h, createdAt: now }));
    saveRecords(records);
  })();

  // watch for external updates to static_one_time_obf and merge in new hashes
  let lastObf = localStorage.getItem(KEY_OBF) || '';
  setInterval(()=>{
    const obf = localStorage.getItem(KEY_OBF) || '';
    if(obf && obf !== lastObf){
      lastObf = obf;
      const raw = hashesFromObf(obf);
      const recs = loadRecords();
      const existing = new Set(recs.map(r=>r.hash.toLowerCase()));
      const now = new Date().toISOString();
      raw.forEach(h => { if(!existing.has(h.toLowerCase())) recs.push({ hash: h, createdAt: now }); });
      saveRecords(recs);
      console.info('One-time helper merged new obf payload into records');
    }
  }, 1200);

  // --- admin helpers
  async function setOneTimeAccessCode(code){
    if(!code || typeof code !== 'string') return console.warn('Provide a string code');
    const h = await sha256Hex(code);
    const recs = loadRecords().filter(r => r.hash !== h);
    recs.unshift({ hash: h, createdAt: new Date().toISOString() });
    saveRecords(recs);
    // clear used for this hash
    const used = loadUsed().filter(u => u !== h);
    saveUsed(used);
    console.info('One-time access code set (hash stored).');
    return h;
  }
  async function addOneTimeCode(code){
    if(!code || typeof code !== 'string') return console.warn('Provide a string code');
    const h = await sha256Hex(code);
    const recs = loadRecords();
    if(recs.some(r=>r.hash.toLowerCase()===h.toLowerCase())) return console.warn('Code already present');
    recs.push({ hash: h, createdAt: new Date().toISOString() });
    saveRecords(recs);
    console.info('Added one-time code (hash stored).');
    return h;
  }
  window.setOneTimeAccessCode = setOneTimeAccessCode;
  window.addOneTimeCode = addOneTimeCode;

  // --- verify and consume
  function isExpired(rec){
    try { return (Date.now() - new Date(rec.createdAt).getTime()) > VALID_MS; } catch(e){ return true; }
  }
  async function verifyAndConsume(code){
    const hash = await sha256Hex(code);
    const recs = loadRecords();
    const idx = recs.findIndex(r => r.hash.toLowerCase() === hash.toLowerCase());
    if(idx === -1) return { ok:false, reason:'no-match' };
    const rec = recs[idx];
    if(rec.usedAt) return { ok:false, reason:'used' };
    if(isExpired(rec)) return { ok:false, reason:'expired' };
    rec.usedAt = new Date().toISOString();
    recs[idx] = rec;
    saveRecords(recs);
    const used = loadUsed();
    if(!used.includes(rec.hash)) used.push(rec.hash);
    saveUsed(used);
    // update obf to remove consumed hashes
    const remaining = recs.filter(r=>!r.usedAt).map(r=>r.hash);
    localStorage.setItem(KEY_OBF, remaining.length ? obfFromHashes(remaining) : '');
    return { ok:true, record: rec };
  }

  // --- UI finalize helper (minimal)
  function applyFinalizedUI(){
    try {
      document.querySelectorAll('.status.pending').forEach(el=>{ el.classList.remove('pending'); el.classList.add('finalized'); el.textContent = 'Finalized'; });
      document.querySelectorAll('.shimmer, .cart-item').forEach(el=>{ el.classList.remove('shimmer'); el.classList.add('finalized'); });
      document.querySelectorAll('.counter.silver').forEach(el=>{ el.classList.remove('silver'); el.classList.add('gold'); });
      document.querySelectorAll('.frost-container').forEach(el=>el.classList.add('finalized'));
    } catch(e){ console.error('applyFinalizedUI error', e); }
  }
  window.applyFinalizedUI = applyFinalizedUI;

  // --- prompt wrapper (exposed exactly as older version)
  if(!window.promptAndConsumeAccessCode){
    window.promptAndConsumeAccessCode = async function(finalizeCallback){
      // prevent double prompts
      if(window.__oneTimePromptActive) return false;
      window.__oneTimePromptActive = true;
      try {
        const code = prompt('Enter one-time finalize access code');
        if(code === null){ window.__oneTimePromptActive = false; return false; }
        if(!code){ alert('No code entered'); window.__oneTimePromptActive = false; return false; }
        const res = await verifyAndConsume(code);
        if(!res.ok){
          if(res.reason === 'no-match') alert('Access code invalid');
          else if(res.reason === 'used') alert('Code already used');
          else if(res.reason === 'expired') alert('Code expired (24h)');
          else alert('Access code invalid or not available');
          window.__oneTimePromptActive = false;
          return false;
        }
        // finalize action
        try {
          if(typeof finalizeCallback === 'function') finalizeCallback();
          else if(typeof window.adminFinalizeAll === 'function') window.adminFinalizeAll();
          else if(typeof window.activateAllFinalized === 'function') window.activateAllFinalized();
          else {
            // fallback: mark local accounts finalized
            try {
              const KEY_ACCOUNTS = 'static_accounts_registry';
              const accounts = JSON.parse(localStorage.getItem(KEY_ACCOUNTS) || '{}');
              Object.keys(accounts).forEach(k => accounts[k].status = 'Finalized');
              localStorage.setItem(KEY_ACCOUNTS, JSON.stringify(accounts));
            } catch(e){}
          }
          applyFinalizedUI();
          alert('Access accepted ‚Äî finalized applied');
          window.__oneTimePromptActive = false;
          return true;
        } catch(e){
          console.error('finalize callback error', e);
          alert('Finalization failed; check console');
          window.__oneTimePromptActive = false;
          return false;
        }
      } catch(e){
        console.error('promptAndConsumeAccessCode error', e);
        window.__oneTimePromptActive = false;
        return false;
      }
    };
  }

  // --- attach to confirm buttons (ensures prompt shows)
  function attachConfirm(){
    const selectors = ['#confirmFinalizeBtn','#confirmBtn','.confirm-btn','[data-confirm]'];
    selectors.forEach(sel=>{
      const el = document.querySelector(sel);
      if(el && !el.__oneTimeAttached){
        el.addEventListener('click', function(ev){
          ev.preventDefault();
          // always call promptAndConsumeAccessCode so prompt appears
          window.promptAndConsumeAccessCode().then(accepted=>{
            if(accepted){
              const form = el.closest('form');
              if(form) form.submit();
            }
          });
        });
        el.__oneTimeAttached = true;
      }
    });
  }
  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', attachConfirm);
  else attachConfirm();

  // expose verify helper for debugging
  window.verifyAndConsumeOneTime = verifyAndConsume;

  // info
  console.info('One-time helper loaded. Use setOneTimeAccessCode(code), addOneTimeCode(code), promptAndConsumeAccessCode().');
})();
  
  // Patch to prevent multiple prompts after acceptance
(function(){
  const SELECTORS = ['#confirmFinalizeBtn','#confirmBtn','.confirm-btn','[data-confirm]'];
  // cooldown in ms after a successful accept to ignore extra clicks
  const COOLDOWN_MS = 1200;

  // ensure single delegated listener
  if(!window.__oneTimeDelegatedListenerInstalled){
    document.addEventListener('click', function delegatedOneTimeHandler(ev){
      try {
        // find nearest confirm element
        const el = ev.target.closest(SELECTORS.join(','));
        if(!el) return; // not a confirm click
        // prevent default only for matched confirm elements
        ev.preventDefault();

        // global reentrancy guard used by your verifier
        if(window.__oneTimePromptActive) return;

        // short cooldown guard to avoid multiple rapid triggers
        const last = window.__oneTimeLastTrigger || 0;
        if(Date.now() - last < COOLDOWN_MS) return;
        window.__oneTimeLastTrigger = Date.now();

        // call the existing prompt function once
        // if your page uses promptAndConsumeAccessCode, call that; otherwise call the fallback
        const fn = window.promptAndConsumeAccessCode || window.promptAndVerifyThenFinalize || window.verifyAndConsumeOneTime;
        if(typeof fn === 'function'){
          // call and ignore repeated resolves; the function itself prevents reentry
          fn().catch(()=>{/* ignore errors */});
        } else {
          // fallback: show prompt and call verify helper if available
          (async function(){
            const code = prompt('Enter one-time finalize access code');
            if(!code) return;
            if(typeof window.verifyAndConsumeOneTime === 'function'){
              const res = await window.verifyAndConsumeOneTime(code);
              if(res && res.ok){
                if(typeof window.applyFinalizedUI === 'function') window.applyFinalizedUI();
                alert('Access accepted ‚Äî finalized applied');
              } else {
                alert('Access code invalid or already used');
              }
            } else {
              alert('Verifier not available');
            }
          })();
        }
      } catch(e){
        console.error('delegatedOneTimeHandler error', e);
      }
    }, { capture: false, passive: false });

    window.__oneTimeDelegatedListenerInstalled = true;
    console.info('One-time delegated confirm handler installed');
  } else {
    console.info('Delegated handler already installed');
  }
})();

</script><script>

// Cart-scoped markItemsGold ‚Äî finalizes only items inside cart containers
(function(){
  if(window.__markItemsGoldCartScoped) return;
  window.__markItemsGoldCartScoped = true;

  // update this list to match your cart container(s)
  const CART_CONTAINERS = ['#checkoutPanel', '.checkout-cart', '.cart-list', '#cartPanel', '.floating-cart'];

  function _applyGoldToCartItem(el){
    if(!el || el.__goldAppliedCart) return;
    el.__goldAppliedCart = true;
    // only change classes/text inside the cart item
    el.classList.remove('pending','shimmer','status-pend');
    el.classList.add('finalized','gold');
    const status = el.querySelector('.status, .product-status, .badge');
    if(status) status.textContent = 'Verified';
    // counters inside card
    el.querySelectorAll('.counter, .price, .product-status').forEach(c=>{
      c.classList.remove('silver');
      c.classList.add('gold');
    });
    // visual tweak limited to this element
    try { el.style.boxShadow = el.style.boxShadow || '0 0 12px rgba(255,216,122,0.28)'; } catch(e){}
  }

  function markItemsGoldInCart(){
    const containers = CART_CONTAINERS.map(s => document.querySelector(s)).filter(Boolean);
    if(!containers.length) { console.info('markItemsGoldInCart: no cart containers found'); return false; }
    const nodes = new Set();
    containers.forEach(c => c.querySelectorAll('.cart-item, .cart-item.pending, .product-card').forEach(n => nodes.add(n)));
    if(!nodes.size) { console.info('markItemsGoldInCart: no cart items found'); return false; }
    nodes.forEach(_applyGoldToCartItem);
    console.info('markItemsGoldInCart: finalized', nodes.size, 'cart item(s).');
    return true;
  }

  // expose
  window.markItemsGoldInCart = markItemsGoldInCart;

  // auto-hook after verification (safe: only calls cart-scoped function)
  if(typeof window.promptAndConsumeAccessCode === 'function' && !window.__markItemsGoldCartHooked){
    const orig = window.promptAndConsumeAccessCode;
    window.promptAndConsumeAccessCode = async function(...args){
      const ok = await orig.apply(this, args);
      if(ok){
        setTimeout(()=> { try { window.markItemsGoldInCart(); } catch(e){ console.error(e); } }, 120);
      }
      return ok;
    };
    window.__markItemsGoldCartHooked = true;
  }

  console.info('markItemsGoldInCart installed ‚Äî call markItemsGoldInCart() to finalize cart items only.');
})();


</script><script>
// Cart-scoped updateVerificationText ‚Äî only updates status text inside cart containers
(function(){
  if(window.__updateVerificationTextCartScoped) return;
  window.__updateVerificationTextCartScoped = true;

  const CART_CONTAINERS = ['#checkoutPanel', '.checkout-cart', '.cart-list', '#cartPanel', '.floating-cart'];

  function updateVerificationTextInCart(){
    try {
      const containers = CART_CONTAINERS.map(s => document.querySelector(s)).filter(Boolean);
      if(!containers.length) { console.info('updateVerificationTextInCart: no cart containers found'); return false; }

      const statusSelectors = ['.status', '.product-status', '.object-status', '.badge', '[data-ledger-status]'];
      let changed = 0;

      containers.forEach(root => {
        statusSelectors.forEach(sel => {
          root.querySelectorAll(sel).forEach(el => {
            const text = (el.textContent || '').trim();
            if(/AWAITING|PENDING|VERIFICATION/i.test(text)){
              el.textContent = 'Verified';
              changed++;
            }
          });
        });

        // also replace inline text nodes inside the cart container only (defensive)
        const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null, false);
        const nodes = [];
        while(walker.nextNode()){
          const n = walker.currentNode;
          if(!n.nodeValue || !n.nodeValue.trim()) continue;
          if(/\bAWAITING\s+PRESTIGE\s+VERIFICATION\b/i.test(n.nodeValue) || /\bPENDING\b/i.test(n.nodeValue)){
            nodes.push(n);
          }
        }
        nodes.forEach(n => { n.nodeValue = n.nodeValue.replace(/\bAWAITING\s+PRESTIGE\s+VERIFICATION\b/gi, 'Verified').replace(/\bPENDING\b/gi, 'Verified'); changed++; });
      });

      console.info('updateVerificationTextInCart: updated', changed, 'node(s).');
      return changed > 0;
    } catch(e){
      console.error('updateVerificationTextInCart error', e);
      return false;
    }
  }

  // expose and auto-hook after verification
  window.updateVerificationTextInCart = updateVerificationTextInCart;
  if(typeof window.promptAndConsumeAccessCode === 'function' && !window.__updateVerificationTextCartHooked){
    const orig = window.promptAndConsumeAccessCode;
    window.promptAndConsumeAccessCode = async function(...args){
      const ok = await orig.apply(this, args);
      if(ok){
        setTimeout(()=> { try { window.updateVerificationTextInCart(); } catch(e){ console.error(e); } }, 80);
      }
      return ok;
    };
    window.__updateVerificationTextCartHooked = true;
  }

  console.info('updateVerificationTextInCart installed ‚Äî call updateVerificationTextInCart() to update cart-only verification text.');
})();

</script>
<script>
(function(){
  'use strict';
  document.addEventListener('DOMContentLoaded', () => {
    // CONFIG
    const PRESTIGE_NUMBER = window.PRESTIGE_NUMBER || '+16164391862';
    const SUPPORT_EMAIL = window.SUPPORT_EMAIL || 'orginator+store@icloud.com';
    const JITSI_BASE = window.JITSI_BASE || 'https://meet.jit.si';

    // DOM helpers
    const $id = id => document.getElementById(id);
    const $q = sel => document.querySelector(sel);

    // Hooks (robust fallbacks)
    const buzzer = $id('prestigeBuzzer') || $q('.prestige-buzzer') || $q('#prestigeSlotFinal .prestige-buzzer');
    const widget = $id('prestigeWidgetFinal') || $id('prestigeWidget') || $q('.prestige-widget-final') || $q('.prestige-widget');
    const nameInput = $id('pfName') || widget?.querySelector('input[placeholder*="name"]');
    const phoneInput = $id('pfPhone') || widget?.querySelector('input[placeholder*="Phone"]');
    const issueInput = $id('pfIssue') || widget?.querySelector('input[placeholder*="issue"], textarea');
    const smsBtn = $id('pfSendSms') || widget?.querySelector('#pfSendSms, .send, .prestige-send');
    const emailBtn = $id('pfSendEmail') || widget?.querySelector('#pfSendEmail, .send:nth-of-type(2), .prestige-send.ghost');

    // Modal and hidden staff reply
    let hiddenStaff = $id('prestigeHiddenStaffReply');
    if(!hiddenStaff){
      hiddenStaff = document.createElement('textarea');
      hiddenStaff.id = 'prestigeHiddenStaffReply';
      hiddenStaff.style.display = 'none';
      document.body.appendChild(hiddenStaff);
    }
    const modalEl = $id('prestigeModal') || $q('.prestige-modal');
    const smsTextarea = $id('prestigeSmsText') || (modalEl && modalEl.querySelector('textarea'));
    const copySmsBtn = $id('copySms') || (modalEl && modalEl.querySelector('#copySms'));
    const modalSendEmailBtn = $id('modalSendEmail') || (modalEl && modalEl.querySelector('#modalSendEmail'));
    const closeModalBtn = $id('closeModal') || (modalEl && modalEl.querySelector('#closeModal'));

    // Confirm UI
    const confirmEl = $id('prestigeConfirm') || $q('.prestige-confirm');
    const confirmProceed = $id('confirmProceed') || (confirmEl && confirmEl.querySelector('#confirmProceed'));
    const confirmCancel = $id('confirmCancel') || (confirmEl && confirmEl.querySelector('#confirmCancel'));

    // Basic warnings
    if(!smsBtn) console.warn('Prestige: SMS button not found (pfSendSms).');
    if(!buzzer) console.warn('Prestige: buzzer not found (prestigeBuzzer).');
    if(!widget) console.warn('Prestige: widget not found (prestigeWidgetFinal).');

    // Utility: generate room id
    function genRoom(prefix='prestige', len=8){
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let s = prefix + '-';
      for(let i=0;i<len;i++) s += chars[Math.floor(Math.random()*chars.length)];
      return s;
    }

    // Original simple cart reader (kept for compatibility)
    function collectCartSummaryLines(){
      const cart = document.querySelector('#cartList');
      const lines = [];
      if(!cart) return lines;
      const nodes = cart.querySelectorAll('.cart-item, .product-card, .cart-row, .cart-entry, .store-item, .item');
      nodes.forEach(node => {
        const title = (node.querySelector('.product-title, .title, .name, h4, h3')?.textContent || node.getAttribute('data-title') || '').trim();
        const price = (node.querySelector('.price, .product-cost, .item-price')?.textContent || node.getAttribute('data-price') || '').trim();
        const qty = (node.querySelector('.qty, .quantity')?.textContent || node.querySelector('input.qty')?.value || node.getAttribute('data-qty') || '').trim();
        if(title) lines.push([title, qty ? 'x'+qty : '', price].filter(Boolean).join(' ‚Ä¢ '));
      });
      return lines;
    }

    // Direct cart reader: reads live DOM and ignores visual-only nodes (preserves shimmer)
    function collectCartSummaryLinesDirect(){
      const container = document.querySelector('#cartList') || document.querySelector('.cart, .cart-list');
      const VISUAL = ['.shimmer','.skeleton','.pending','.visual-only','[data-shimmer]','[data-visual]'];
      const lines = [];
      if(!container) return lines;
      const items = container.querySelectorAll('.cart-item, .product-card, .cart-row, .cart-entry, .store-item, .item');
      items.forEach(node => {
        try {
          const walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null, false);
          let text = '', n;
          while(n = walker.nextNode()){
            let p = n.parentNode, skip = false;
            while(p && p !== document){
              for(const sel of VISUAL){ try{ if(p.matches && p.matches(sel)){ skip = true; break; } }catch(e){} }
              if(skip) break;
              p = p.parentNode;
            }
            if(skip) continue;
            const t = n.nodeValue.replace(/\s+/g,' ').trim();
            if(t) text += (text ? ' ' : '') + t;
          }
          const title = (node.querySelector('.product-title, .title, .name, h4, h3')?.textContent || text || node.getAttribute('data-title') || '').trim();
          const price = (node.querySelector('.price, .product-cost, .item-price')?.textContent || node.getAttribute('data-price') || '').trim();
          const qtyEl = node.querySelector('.qty, .quantity') || node.querySelector('input.qty');
          const qty = qtyEl ? ((qtyEl.value||qtyEl.textContent||'').trim()) : '';
          if(title){
            const parts = [ title.replace(/\b(shimmer|pending|awaiting)\b/ig,'').trim(), qty ? 'x'+qty : '', price ].filter(Boolean);
            lines.push(parts.join(' ‚Ä¢ '));
          }
        } catch(e){
          console.warn('collectCartSummaryLinesDirect parse error', e);
        }
      });
      return lines;
    }

    // Append cart (compatibility wrapper)
    function appendCart(body){
      const lines = collectCartSummaryLinesDirect();
      if(lines.length) body += '\n\nCart:\n' + lines.join('\n');
      return body;
    }

    // Build SMS preview text: includes form fields, cart summary, and always appends friendly message
   // Replace existing buildSmsPreview with this (no duplicate link)
function buildSmsPreview(){
  const name = (nameInput?.value || '').trim();
  const phone = (phoneInput?.value || '').trim();
  const issue = (issueInput?.value || '').trim();
  const room = genRoom('prestige',8);
  const roomLink = `${JITSI_BASE}/${room}`;
  const header = [];
  if(name) header.push(`Name: ${name}`);
  if(phone) header.push(`Phone: ${phone}`);
  if(issue) header.push(`Issue: ${issue}`);
  // single canonical link line
  header.push(`Join: ${roomLink}`);
  let body = header.join('\n');

  const cartLines = collectCartSummaryLinesDirect();
  if(cartLines && cartLines.length) body += '\n\nCart:\n' + cartLines.join('\n');

  // Friendly message should NOT repeat the link (refer to the Join line above)
  const friendly = `\n\nPrestige Care ‚Äî we can help verify your purchase and join a secure chatroom (see Join link above).\n\nIf you prefer, our team can also assist by email or call.`;
  body += friendly;

  const staffReply = `Hi ${name || '[name]'}, join here: ${roomLink} ‚Äî I‚Äôll join now.`;
  return { body, staffReply, roomLink };
}

    
    
    
    // Persist a short cart token in localStorage and return it
function ensureCartToken(){
  try {
    const KEY = 'prestigeCartToken';
    let token = localStorage.getItem(KEY);
    if(token && typeof token === 'string' && token.length >= 8) return token;
    token = 'cart_' + Math.random().toString(36).slice(2,10);
    localStorage.setItem(KEY, token);
    return token;
  } catch(e){
    console.warn('ensureCartToken failed', e);
    return 'cart_' + Math.random().toString(36).slice(2,10);
  }
}

// Optional helper to clear token when order completes
function clearCartToken(){
  try { localStorage.removeItem('prestigeCartToken'); } catch(e){ /* ignore */ }
  return true;
}

// Small helper to build a one-line cart summary for SMS (first N items)
function buildOneLineCartSummary(maxItems = 3){
  try {
    const lines = collectCartSummaryLinesDirect() || [];
    if(!lines.length) return '';
    const sample = lines.slice(0, maxItems).join('; ');
    return sample.length > 200 ? sample.slice(0,197) + '...' : sample;
  } catch(e){
    return '';
  }
}


    // POST cart + form snapshot to server and return short URL (or null)
    async function createSnapshotAndGetUrl(){
      try {
        const cartLines = collectCartSummaryLinesDirect();
       const payload = {
  token: ensureCartToken(),               // <-- added token
  name: (nameInput?.value || '').trim(),
  phone: (phoneInput?.value || '').trim(),
  issue: (issueInput?.value || '').trim(),
  cartLines,
  pageUrl: window.location.href,
  ts: Date.now()
};

        const res = await fetch('/api/prestige/snapshot', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if(!res.ok) { console.warn('snapshot POST failed', res.status); return null; }
        const json = await res.json();
        if(json.url) return json.url;
        if(json.token) return `${window.location.origin}/p/s/${json.token}`;
        return null;
      } catch(e){
        console.warn('createSnapshotAndGetUrl error', e);
        return null;
      }
    }

    // Robust SMS opener (share-first, then sms: variants, anchor, clipboard/modal)
    async function openPrestigeSms(prestigeNumber, messageText){
      const body = String(messageText || '').trim();
      const encoded = encodeURIComponent(body);
      const ua = navigator.userAgent || '';
      const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
      const isAndroid = /Android/.test(ua);
      const candidates = [];
      if(isIOS){
        candidates.push(`sms:${prestigeNumber}&body=${encoded}`);
        candidates.push(`sms:${prestigeNumber}?body=${encoded}`);
      } else if(isAndroid){
        candidates.push(`sms:${prestigeNumber}?body=${encoded}`);
        candidates.push(`sms:${prestigeNumber}&body=${encoded}`);
      } else {
        candidates.push(`sms:${prestigeNumber}?body=${encoded}`);
        candidates.push(`sms:${prestigeNumber}&body=${encoded}`);
      }
      function tryAnchor(uri){
        return new Promise((resolve) => {
          try {
            const a = document.createElement('a');
            a.href = uri;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            setTimeout(()=> { try{ a.remove(); }catch(e){}; resolve(true); }, 300);
          } catch(e){ resolve(false); }
        });
      }
      
      
      // ensure modal preview is populated immediately (insert near top of openPrestigeSms)
try {
  if(modalEl && smsTextarea){
    smsTextarea.value = String(messageText || '').trim() + '\n\nPrestige Care: ' + (prestigeNumber || PRESTIGE_NUMBER);
    // some UIs use a class to show modal; set both
    modalEl.classList.add('show');
    modalEl.style.display = 'block';
  }
} catch(e){ console.warn('modal populate failed', e); }

      // prefer native share on mobile
      if(navigator.share && (isIOS || isAndroid)){
        try { await navigator.share({ title:'Prestige Care', text: body }); } catch(e){ /* ignore */ }
      }
      for(const uri of candidates){
        const ok = await tryAnchor(uri);
        if(ok) return { status:'opened', uri };
      }
      // fallback: copy to clipboard and show modal
      try { await navigator.clipboard.writeText(`${body}\n\nPrestige Care: ${prestigeNumber}`); } catch(e){}
      if(modalEl){
        if(smsTextarea) smsTextarea.value = `${body}\n\nPrestige Care: ${prestigeNumber}`;
        modalEl.style.display = 'block';
      } else {
        alert(`${body}\n\nSend to: ${prestigeNumber}`);
      }
      return { status:'fallback' };
    }

    // Confirm helper
    function askConfirm(cb){
      if(!confirmEl || !confirmProceed || !confirmCancel){ cb(true); return; }
      confirmEl.style.display = 'block';
      function cleanup(){ confirmEl.style.display = 'none'; confirmProceed.removeEventListener('click', onProceed); confirmCancel.removeEventListener('click', onCancel); }
      function onProceed(){ cleanup(); cb(true); }
      function onCancel(){ cleanup(); cb(false); }
      confirmProceed.addEventListener('click', onProceed);
      confirmCancel.addEventListener('click', onCancel);
    }

    // Main SMS handler
    async function handleSms(){
      askConfirm(async (ok) => {
        if(!ok) return;
        try {
          const name = (nameInput?.value || '').trim();
          const phone = (phoneInput?.value || '').trim();
          const issue = (issueInput?.value || '').trim();
          const room = genRoom('prestige',8);
          const roomLink = `${JITSI_BASE}/${room}`;

          // Build preview (includes cart + friendly)
          const preview = buildSmsPreview();

          // Best-effort: create server snapshot and get short URL
          let snapshotUrl = null;
          if(typeof createSnapshotAndGetUrl === 'function'){
            try { snapshotUrl = await createSnapshotAndGetUrl(); } catch(e){ console.warn('snapshot failed', e); snapshotUrl = null; }
          }

          
          // Compose final message
let messageToSend = preview.body || (`Prestige Care ‚Äî join: ${roomLink}`);

// Prefer server snapshot URL when available; otherwise append CartID token
if(snapshotUrl){
  messageToSend += `\n\nDetails: ${snapshotUrl}`;
} else {
  // append short one-line cart summary and token so staff can look it up
  const token = ensureCartToken();
  const oneLine = buildOneLineCartSummary(3);
  if(oneLine) messageToSend += `\n\nItems: ${oneLine}`;
  messageToSend += `\n\nCartID: ${token}`;
}


          // Set hidden staff reply
          hiddenStaff.value = preview.staffReply || `Hi ${name || '[name]'}, join here: ${roomLink}`;

          // Open share/SMS
          if(typeof openPrestigeSms === 'function'){
            await openPrestigeSms(PRESTIGE_NUMBER, messageToSend);
          } else {
            try { await navigator.clipboard.writeText(`${messageToSend}\n\nPrestige Care: ${PRESTIGE_NUMBER}`); } catch(e){}
            if(modalEl){
              if(smsTextarea) smsTextarea.value = `${messageToSend}\n\nPrestige Care: ${PRESTIGE_NUMBER}`;
              modalEl.style.display = 'block';
            } else {
              alert(`${messageToSend}\n\nSend to: ${PRESTIGE_NUMBER}`);
            }
          }
        } catch(err){
          console.error('handleSms error', err);
          alert('An error occurred while preparing the SMS. Check console for details.');
        }
      });
    }

    // Email handler (keeps existing behavior)
    function handleEmail(){
      askConfirm((ok) => {
        if(!ok) return;
        const name = (nameInput?.value || '').trim();
        const phone = (phoneInput?.value || '').trim();
        const issue = (issueInput?.value || '').trim();
        const room = genRoom('prestige',8);
        const t = (typeof buildTemplates === 'function') ? buildTemplates(name, phone, issue, room) : {
          subjectStaff: `Prestige Help Request ‚Äî ${name || '[username]'}`,
          bodyStaff: `User: ${name}\nPhone: ${phone}\nIssue: ${issue}`
        };
        hiddenStaff.value = t.staffReply || `Hi ${name||'[name]'}, join here: ${JITSI_BASE}/${room} ‚Äî I‚Äôll join now.`;
        if(typeof openMailto === 'function'){
          openMailto(t.subjectStaff, t.bodyStaff);
        } else {
          const s = encodeURIComponent(t.subjectStaff);
          const b = encodeURIComponent(t.bodyStaff);
          window.location.href = `mailto:${encodeURIComponent(SUPPORT_EMAIL)}?subject=${s}&body=${b}`;
        }
        if(modalEl){ if(smsTextarea) smsTextarea.value = `${t.smsUser || ''}\n\nPrestige Care: ${PRESTIGE_NUMBER}`; modalEl.style.display = 'block'; }
      });
    }

    // Safe attach helper
    function safeAttach(btn, handler, name){
      if(!btn || !handler) return;
      if(btn._prestigeAttached) return;
      try { btn.type = btn.type || 'button'; } catch(e){}
      btn.addEventListener('click', function(e){
        if(e && typeof e.preventDefault === 'function') e.preventDefault();
        try {
          const res = handler();
          if(res && typeof res.then === 'function') res.catch(err => console.error(`${name} handler error`, err));
        } catch(err){ console.error(`${name} wrapper error`, err); }
      }, { passive:false });
      btn._prestigeAttached = true;
    }

    // Attach handlers idempotently
    safeAttach(smsBtn, handleSms, 'SMS');
    safeAttach(emailBtn, handleEmail, 'Email');
    if(buzzer && !buzzer._prestigeToggleInstalled){
      buzzer.addEventListener('click', () => { widget?.classList.toggle('prestige-hidden'); (nameInput || widget?.querySelector('input'))?.focus(); buzzer.classList.remove('pulse'); });
      buzzer._prestigeToggleInstalled = true;
    }

    // Modal actions
    if(copySmsBtn && smsTextarea && !copySmsBtn._prestigeAttached){
      copySmsBtn.addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(smsTextarea.value || ''); copySmsBtn.textContent = 'Copied'; setTimeout(()=> copySmsBtn.textContent = 'Copy SMS',1200); } catch(e){ copySmsBtn.textContent = 'Copy failed'; setTimeout(()=> copySmsBtn.textContent = 'Copy SMS',1200); }
      });
      copySmsBtn._prestigeAttached = true;
    }
    if(modalSendEmailBtn && !modalSendEmailBtn._prestigeAttached){
      modalSendEmailBtn.addEventListener('click', () => {
        const name = (nameInput?.value || '').trim();
        const phone = (phoneInput?.value || '').trim();
        const issue = (issueInput?.value || '').trim();
        const subject = `Prestige Help Request ‚Äî ${name || '[username]'}`;
        const body = `User: ${name || '[name]'}\nPhone: ${phone || '[number]'}\nIssue: ${issue || '[short description]'}\n\nPlease respond with Jitsi link via SMS.`;
        if(typeof openMailto === 'function') openMailto(subject, body);
        else window.location.href = `mailto:${encodeURIComponent(SUPPORT_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      });
      modalSendEmailBtn._prestigeAttached = true;
    }
    if(closeModalBtn && !closeModalBtn._prestigeAttached){
      closeModalBtn.addEventListener('click', () => { if(modalEl) modalEl.style.display = 'none'; });
      closeModalBtn._prestigeAttached = true;
    }

    // Expose small API for debugging or external calls
    window.prestige = window.prestige || {};
    window.prestige.collectCartSummaryLinesDirect = collectCartSummaryLinesDirect;
    window.prestige.buildSmsPreview = buildSmsPreview;
    window.prestige.createSnapshotAndGetUrl = createSnapshotAndGetUrl;
    window.prestige.openPrestigeSms = openPrestigeSms;

    console.log('Prestige: unified handlers attached.');
  });
})();
  
  
  
  // Persist a short cart token in localStorage and return it
function ensureCartToken(){
  try {
    const KEY = 'prestigeCartToken';
    let token = localStorage.getItem(KEY);
    if(token && typeof token === 'string' && token.length >= 8) return token;
    // generate compact token: 8 chars base36 (lowercase)
    token = 'cart_' + Math.random().toString(36).slice(2,10);
    localStorage.setItem(KEY, token);
    return token;
  } catch(e){
    console.warn('ensureCartToken failed', e);
    // fallback: ephemeral token
    return 'cart_' + Math.random().toString(36).slice(2,10);
  }
}

// Optional helper to clear token when order completes (call from order success flow)
function clearCartToken(){
  try { localStorage.removeItem('prestigeCartToken'); } catch(e){ /* ignore */ }
  return true;
}

// Small helper to build a one-line cart summary for SMS (first N items)
function buildOneLineCartSummary(maxItems = 3){
  try {
    const lines = collectCartSummaryLinesDirect() || [];
    if(!lines.length) return '';
    const sample = lines.slice(0, maxItems).join('; ');
    return sample.length > 200 ? sample.slice(0,197) + '...' : sample;
  } catch(e){
    return '';
  }
}

</script>



</body>
</html>
